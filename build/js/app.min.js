/*
 * Phaser JS Boilerplate
 * nameless
 *
 * @author olivierrr
 * @version 0.1.0
 * @copyright olivierrr
 * @license MIT licensed
 *
 * Made using Phaser JS Boilerplate <https://github.com/lukewilde/phaser-js-boilerplate>
 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){b.exports={name:"nameless-game",version:"0.1.0",description:"nameless",main:"build/js/app.min.js",scripts:{test:'echo "Error: no test specified" && exit 1'},repository:{type:"git",url:"git@github.com:olivierrr/nameless-game.git"},author:"olivierrr",license:"MIT",browser:{lodash:"./node_modules/lodash/dist/lodash.compat.js",Stats:"./src/js/lib/stats.min.js"},"browserify-shim":{lodash:{exports:"_"},Stats:{exports:"Stats"}},devDependencies:{browserify:"^4.1.5","browserify-shim":"^3.5.0",grunt:"^0.4.5","grunt-browserify":"^2.1.0","grunt-cache-bust":"^0.3.6","grunt-contrib-clean":"^0.5.0","grunt-contrib-connect":"^0.7.1","grunt-contrib-copy":"^0.5.0","grunt-contrib-jade":"^0.11.0","grunt-contrib-jshint":"^0.10.0","grunt-contrib-stylus":"^0.16.0","grunt-contrib-uglify":"^0.4.0","grunt-contrib-watch":"^0.6.1","grunt-open":"^0.2.3","grunt-pngmin":"^0.6.1"},dependencies:{"grunt-contrib-compress":"^0.9.1",lodash:"^2.4.1","node-static":"^0.7.6",phaser:"^2.1.1","socket.io":"^1.1.0"}}},{}],2:[function(a,b){function c(a,b){a.children.forEach(function(a){a.inputEnabled=!0,a.events.onInputDown.add(function(a){d.call(b,a.name)})})}function d(a){joint={head:"neckJoint",upperLeftArm:"leftShoulder",lowerLeftArm:"leftElbowJoint",upperRightArm:"rightShoulder",lowerRightArm:"rightElbowJoint",upperLeftLeg:"leftHipJoint",lowerLeftLeg:"leftKneeJoint",upperRightLeg:"rightHipJoint",lowerRightLeg:"rightKneeJoint",pelvis:"spineJoint",upperBody:"spineJoint"};var b,c=joint[a],d=this.turnHistory[this.turnHistory.length-1][c];b="expand"===d?"contract":"contract"===d?"relax":"relax"===d?"expand":"expand",console.log(b,c),this.newAction({jointName:c,type:b}),textures={expand:"redsquare",contract:"bluesquare",relax:"whitesquare"},this.shadowClone.children.filter(function(b){return b.name===a})[0].loadTexture(textures[b]),this.isResetingPlayback=!0}var e=a("./Ragdoll.js"),f=function(a,b,c){this.controller="dummy",this.game=a,this.ragdoll=e(a,b,c),this.isReady=!1,this.isAllowingInput=!0,this.turnHistory=[],this.currentPosition=[],this.initialPosition=[],this.health=100,this.isResetingPlayback=!1,this.savePosition(),this.initialPosition=this.currentPosition};f.prototype.newTurn=function(){this.turnHistory.push({}),this.ragdoll.children.forEach(function(a){a.loadTexture("whitesquare")}),this.isReady=!1},f.prototype.newAction=function(a){this.turnHistory[this.turnHistory.length-1][a.jointName]=a.type},f.prototype.savePosition=function(){this.currentPosition=this.ragdoll.children.map(function(a){var b=a.body.data;return{x:b.position[0],y:b.position[1],vx:b.velocity[0],vy:b.velocity[1],angle:b.angle,angularVelocity:b.angularVelocity}})},f.prototype.loadPosition=function(){var a=this.currentPosition;this.ragdoll.children.forEach(function(b,c){var d=b.body.data;d.position[0]=a[c].x,d.position[1]=a[c].y,d.angle=a[c].angle,d.angularVelocity=a[c].angularVelocity,d.velocity[0]=a[c].vx,d.velocity[1]=a[c].vy})},f.prototype.clone=function(){{var a=this.game.add.group();this.ragdoll.children.forEach(function(b){var c=a.create(b.position.x,b.position.y,b.key);c.width=b.width,c.height=b.height,c.rotation=b.rotation,c.anchor.x=b.anchor.x,c.anchor.y=b.anchor.y,c.name=b.name})}return a},f.prototype.shadow=function(){this.shadowClone&&this.shadowClone.destroy(!0),this.shadowClone=this.clone(),this.isAllowingInput&&c(this.shadowClone,this)},f.prototype.executeMove=function(a,b){switch(b){case"expand":this.ragdoll.flex(a);break;case"contract":this.ragdoll.contract(a);break;case"relax":this.ragdoll.relax(a);break;case"tense":this.ragdoll.tense(a)}},f.prototype.executeMoves=function(a,b){var c=this;c.ragdoll.alpha=b||1,Object.keys(a).forEach(function(b){c.executeMove(b,a[b])})},f.prototype.replayLastMove=function(a){this.shadowClone.destroy(),this.executeMove(a,1)},f.prototype.setController=function(a){this.controller=a,"dummy"===a&&(this.isAllowingInput=!1,this.isReady=!0),"network"===a&&(this.isAllowingInput=!1)},f.prototype.reset=function(){this.turnHistory=[],this.currentPosition=this.initialPosition,this.loadPosition(),this.shadow()},f.prototype.resetPlayback=function(){return this.isResetingPlayback===!0?(this.isResetingPlayback=!1,!0):!1},f.prototype.ready=function(){return this.isReady===!0?(this.isReady=!1,!0):!1},f.prototype.method0=function(){this.newTurn(),this.savePosition(),this.shadow()},f.prototype.method1=function(){this.ragdoll.relaxAll(),this.newTurn(),this.savePosition(),this.shadow()},f.prototype.method2=function(){this.loadPosition(),this.ragdoll.relaxAll(),this.executeMoves(this.turnHistory[this.turnHistory.length-1],.5)},b.exports=f},{"./Ragdoll.js":3}],3:[function(a,b){b.exports=function(a,b,c){var d=1e4,e=100,f={},g={},h={},i={};i.shouldersDistance=.4,i.upperArmLength=.5,i.lowerArmLength=.5,i.upperArmSize=.2,i.lowerArmSize=.2,i.neckLength=.1,i.headRadius=.15,i.upperBodyLength=.6,i.pelvisLength=.4,i.upperLegLength=.6,i.upperLegSize=.2,i.lowerLegSize=.2,i.lowerLegLength=.5,Object.keys(i).forEach(function(a){i[a]*=e}),h.lowerLeftLeg={x:-i.shouldersDistance/2,y:i.lowerLegLength/2,w:i.lowerLegSize,h:i.lowerLegLength,mass:.2},h.lowerRightLeg={x:i.shouldersDistance/2,y:i.lowerLegLength/2,w:i.lowerLegSize,h:i.lowerLegLength,mass:.2},h.upperLeftLeg={x:-i.shouldersDistance/2,y:h.lowerLeftLeg.y+i.lowerLegLength/2+i.upperLegLength/2,w:i.upperLegSize,h:i.upperLegLength,mass:1},h.upperRightLeg={x:i.shouldersDistance/2,y:h.lowerRightLeg.y+i.lowerLegLength/2+i.upperLegLength/2,w:i.upperLegSize,h:i.upperLegLength,mass:1},h.pelvis={x:0,y:h.upperLeftLeg.y+i.upperLegLength/2+i.pelvisLength/2,w:i.shouldersDistance,h:i.pelvisLength,mass:1},h.upperBody={x:0,y:h.pelvis.y+i.pelvisLength/2+i.upperBodyLength/2,w:i.shouldersDistance,h:i.upperBodyLength,mass:1},h.head={x:0,y:h.upperBody.y+i.upperBodyLength/2+i.headRadius+i.neckLength,w:2*i.headRadius,h:2*i.headRadius,mass:1},h.upperLeftArm={x:-i.shouldersDistance/2-i.upperArmLength/2,y:h.upperBody.y+i.upperBodyLength/2,w:i.upperArmLength,h:i.upperArmSize,mass:1},h.upperRightArm={x:i.shouldersDistance/2+i.upperArmLength/2,y:h.upperBody.y+i.upperBodyLength/2,w:i.upperArmLength,h:i.upperArmSize,mass:1},h.lowerLeftArm={x:h.upperLeftArm.x-i.lowerArmLength/2-i.upperArmLength/2,y:h.upperLeftArm.y,w:i.lowerArmLength,h:i.lowerArmSize,mass:1},h.lowerRightArm={x:h.upperRightArm.x+i.lowerArmLength/2+i.upperArmLength/2,y:h.upperRightArm.y,w:i.lowerArmLength,h:i.lowerArmSize,mass:1},g.neckJoint={a:"head",b:"upperBody",pivot_a:[0,-i.headRadius-i.neckLength/2],pivot_b:[0,i.upperBodyLength/2],limits:[-Math.PI/12,Math.PI/12]},g.leftKneeJoint={a:"lowerLeftLeg",b:"upperLeftLeg",pivot_a:[0,i.lowerLegLength/2],pivot_b:[0,-i.upperLegLength/2],limits:[-Math.PI/5,Math.PI/5]},g.rightKneeJoint={a:"lowerRightLeg",b:"upperRightLeg",pivot_a:[0,i.lowerLegLength/2],pivot_b:[0,-i.upperLegLength/2],limits:[-Math.PI/5,Math.PI/5]},g.leftHipJoint={a:"upperLeftLeg",b:"pelvis",pivot_a:[0,i.upperLegLength/2],pivot_b:[-i.shouldersDistance/2,-i.pelvisLength/2],limits:[-Math.PI/6,Math.PI/4]},g.rightHipJoint={a:"upperRightLeg",b:"pelvis",pivot_a:[0,i.upperLegLength/2],pivot_b:[i.shouldersDistance/2,-i.pelvisLength/2],limits:[-Math.PI/4,Math.PI/6]},g.spineJoint={a:"pelvis",b:"upperBody",pivot_a:[0,i.pelvisLength/2],pivot_b:[0,-i.upperBodyLength/2],limits:[-Math.PI/5,Math.PI/5]},g.leftShoulder={a:"upperBody",b:"upperLeftArm",pivot_a:[-i.shouldersDistance/2,i.upperBodyLength/2],pivot_b:[i.upperArmLength/2,0],limits:[-Math.PI/2,Math.PI/2]},g.rightShoulder={a:"upperBody",b:"upperRightArm",pivot_a:[i.shouldersDistance/2,i.upperBodyLength/2],pivot_b:[-i.upperArmLength/2,0],limits:[-Math.PI/2,Math.PI/2]},g.leftElbowJoint={a:"lowerLeftArm",b:"upperLeftArm",pivot_a:[i.lowerArmLength/2,0],pivot_b:[-i.upperArmLength/2,0],limits:[-Math.PI/4,Math.PI/4]},g.rightElbowJoint={a:"lowerRightArm",b:"upperRightArm",pivot_a:[-i.lowerArmLength/2,0],pivot_b:[i.upperArmLength/2,0],limits:[-Math.PI/4,Math.PI/4]};var j=a.add.group(null,null,"ragdoll");return Object.keys(h).forEach(function(d){var e=h[d].x+b,g=h[d].y+c,i=h[d].w,k=h[d].h,l=j.create(e,g,"whitesquare");l.width=i,l.height=k,l.name=d,a.physics.p2.enable(l),f[d]=l}),Object.keys(g).forEach(function(b){var c=g[b],e=a.physics.p2.createRevoluteConstraint(f[c.a],c.pivot_a,f[c.b],c.pivot_b,d);e.setLimits(c.limits[0],c.limits[1]),e.collideConnected=!1,j.joints||(j.joints={}),j.joints[b]=e}),j.flex=function(a){var b=this.joints[a];b.enableMotor(),b.setMotorSpeed(3)},j.contract=function(a){var b=this.joints[a];b.enableMotor(),b.setMotorSpeed(-3)},j.relaxAll=function(){var a=this;Object.keys(a.joints).forEach(function(b){a.relax(b)})},j.relax=function(a){var b=j.joints[a];b.disableMotor()},j}},{}],4:[function(a){var b=a("./properties"),c={boot:a("./states/boot.js"),preloader:a("./states/preloader.js"),mainmenu:a("./states/mainmenu.js"),singleplayermenu:a("./states/singleplayermenu.js"),multiplayermenu:a("./states/multiplayermenu.js"),settingsmenu:a("./states/settingsmenu.js"),train:a("./states/train.js"),quickmatch:a("./states/quickmatch.js")};window.onload=function(){var a=window.Phaser,d=(window.io,new a.Game(b.size.x,b.size.y,a.AUTO,"game"));d.state.add("boot",c.boot(d)),d.state.add("preloader",c.preloader(d)),d.state.add("mainmenu",c.mainmenu(d)),d.state.add("singleplayermenu",c.singleplayermenu(d)),d.state.add("multiplayermenu",c.multiplayermenu(d)),d.state.add("settingsmenu",c.settingsmenu(d)),d.state.add("train",c.train(d)),d.state.add("quickmatch",c.quickmatch(d)),d.state.start("boot")}},{"./properties":5,"./states/boot.js":6,"./states/mainmenu.js":7,"./states/multiplayermenu.js":8,"./states/preloader.js":9,"./states/quickmatch.js":10,"./states/settingsmenu.js":11,"./states/singleplayermenu.js":12,"./states/train.js":13}],5:[function(a,b){var c=a("../../../package.json");b.exports={title:"Phaser JS Boilerplate",description:c.description,port:3017,liveReloadPort:3018,showStats:!0,size:{x:800,y:600},analyticsId:""}},{"../../../package.json":1}],6:[function(a,b){var c=a("Stats"),d=a("../properties");b.exports=function(a){function b(){var a=new c;a.setMode(0),a.domElement.style.position="absolute",a.domElement.style.left="0px",a.domElement.style.top="0px",document.body.appendChild(a.domElement),setInterval(function(){a.begin(),a.end()},1e3/60)}var e={};return e.preload=function(){a.stage.disableVisibilityChange=!0},e.create=function(){d.showStats&&b(),a.scale.pageAlignHorizontally=!0,a.scale.pageAlignVertically=!0,a.scale.refresh(),a.state.start("preloader")},e}},{"../properties":5,Stats:14}],7:[function(a,b){b.exports=function(a){var b={};return b.preload=function(){a.stage.disableVisibilityChange=!0},b.create=function(){var b=a.add.sprite(a.world.centerX,200,"logo");b.anchor.setTo(.5,.5);var c={font:"40px Arial",fill:"#ffffff",align:"center"},d=a.add.text(a.world.centerX,450,"single player",c);d.anchor.setTo(.5,.5),d.inputEnabled=!0,d.events.onInputDown.add(function(){a.state.start("singleplayermenu")});var e=a.add.text(a.world.centerX,500,"multi player",c);e.anchor.setTo(.5,.5),e.inputEnabled=!0,e.events.onInputDown.add(function(){a.state.start("multiplayermenu")});var f=a.add.text(a.world.centerX,550,"settings",c);f.anchor.setTo(.5,.5),f.inputEnabled=!0,f.events.onInputDown.add(function(){a.state.start("settingsmenu")})},b.update=function(){},b}},{}],8:[function(a,b){b.exports=function(a){var b={};return b.preload=function(){a.stage.disableVisibilityChange=!0},b.create=function(){var b={font:"40px Arial",fill:"#ffffff",align:"center"},c=a.add.text(100,50,"back",b);c.anchor.setTo(.5,.5),c.inputEnabled=!0,c.events.onInputDown.add(function(){a.state.start("mainmenu")});var d=a.add.text(a.world.centerX,300,"quickmatch",b);d.anchor.setTo(.5,.5),d.inputEnabled=!0,d.events.onInputDown.add(function(){a.state.start("quickmatch")})},b}},{}],9:[function(a,b){b.exports=function(a){var b={};return b.preload=function(){a.stage.disableVisibilityChange=!0,a.load.image("logo","images/phaser.png#grunt-cache-bust"),a.load.image("redsquare","images/redsquare.png#grunt-cache-bust"),a.load.image("bluesquare","images/bluesquare.jpg#grunt-cache-bust"),a.load.image("whitesquare","images/whitesquare.png#grunt-cache-bust")},b.create=function(){a.state.start("mainmenu")},b}},{}],10:[function(a,b){var c,d=a("../Player.js");b.exports=function(a){var b,e,f,g,h,i,j={},k=0,l=!1,m=!1,n=!1;return j.preload=function(){a.stage.disableVisibilityChange=!0},j.create=function(){c=io("http://localhost:9000"),a.physics.startSystem(Phaser.Physics.P2JS),a.physics.p2.gravity.y=200;var j={font:"40px Arial",fill:"#ffffff",align:"center"},k=a.add.text(100,50,"back",j);k.anchor.setTo(.5,.5),k.inputEnabled=!0,k.events.onInputDown.add(function(){a.state.start("multiplayermenu")}),b=new d(a,200,200),b.method0(),e=new d(a,600,200),e.method0(),c.emit("join-lobby"),c.on("id",function(a){console.log("id",a),h=a}),c.on("players-list",function(b){i=[],b.forEach(function(b,c){var b=a.add.text(550,20*(c+1),b,{fill:"#ffffff",font:"16px Arial"});i.push(b)})}),c.on("new-game",function(a){console.log("new-game",a),a.p1===h?(f=!0,b.setController("me"),console.log("you are p1")):(g=!1,b.setController("network")),a.p2===h?(g=!0,e.setController("me"),console.log("you are p2")):(g=!1,e.setController("network")),b.reset(),b.method0(),e.reset(),e.method0(),c.on("turn",function(a){b.turnHistory[b.turnHistory.length-1]=a.p1,e.turnHistory[b.turnHistory.length-1]=a.p2,l=!0,n=!1})}),window.socket=c,window.game=a,window.p1=b,window.p2=e},j.update=function(){if(b&&e&&(k++,(b.resetPlayback()||e.resetPlayback())&&(b.method2(),e.method2(),k=0),1===k&&l===!0&&(b.executeMoves(b.turnHistory[b.turnHistory.length-1],.5),e.executeMoves(e.turnHistory[e.turnHistory.length-1],.5),m=!0),100===k&&(l&&m?(b.method1(),e.method1(),l=!1,m=!1,k=0,console.log("method1")):(console.log("method2"),k=0,b.method2(),e.method2())),a.input.keyboard.justPressed(Phaser.Keyboard.SPACEBAR)&&(f||g)&&!n)){var d=f?b:e;c.emit("action",d.turnHistory[d.turnHistory.length-1]),n=!0}},j.shutdown=function(){c.emit("leave-lobby"),b.ragdoll.destroy(),e.ragdoll.destroy(),b=null,e=null},j}},{"../Player.js":2}],11:[function(a,b){b.exports=function(a){var b={};return b.preload=function(){a.stage.disableVisibilityChange=!0},b.create=function(){var b={font:"40px Arial",fill:"#ffffff",align:"center"},c=a.add.text(100,50,"back",b);c.anchor.setTo(.5,.5),c.inputEnabled=!0,c.events.onInputDown.add(function(){a.state.start("mainmenu")})},b}},{}],12:[function(a,b){b.exports=function(a){var b={};return b.preload=function(){a.stage.disableVisibilityChange=!0},b.create=function(){var b={font:"40px Arial",fill:"#ffffff",align:"center"},c=a.add.text(100,50,"back",b);c.anchor.setTo(.5,.5),c.inputEnabled=!0,c.events.onInputDown.add(function(){a.state.start("mainmenu")});var d=a.add.text(a.world.centerX,300,"train",b);d.anchor.setTo(.5,.5),d.inputEnabled=!0,d.events.onInputDown.add(function(){a.state.start("train")})},b}},{}],13:[function(a,b){var c=a("../Player.js");b.exports=function(a){var b,d,e={};e.preload=function(){a.stage.disableVisibilityChange=!0},e.create=function(){var e={font:"40px Arial",fill:"#ffffff",align:"center"},f=a.add.text(100,50,"back",e);f.anchor.setTo(.5,.5),f.inputEnabled=!0,f.events.onInputDown.add(function(){a.state.start("singleplayermenu")}),a.physics.startSystem(Phaser.Physics.P2JS),a.physics.p2.gravity.y=200,b=new c(a,200,200),b.setController("me"),b.method0(),d=new c(a,600,200),d.setController("dummy"),d.method0(),window.game=a,window.p1=b,window.p2=d};var f=0;return e.update=function(){f++,(b.resetPlayback()||d.resetPlayback())&&(b.method2(),d.method2(),f=0),100===f&&(f=0,b.ready()&&d.ready()?(b.method1(),d.method1()):(b.method2(),d.method2())),a.input.keyboard.justPressed(Phaser.Keyboard.SPACEBAR)&&(b.isReady=!0,d.isReady=!0)},e.shutdown=function(){b.ragdoll.destroy(),d.ragdoll.destroy(),b=null,d=null},e}},{"../Player.js":2}],14:[function(a,b){(function(c){__browserify_shim_require__=a,function(a,b,c,d,e){var f=function(){var a=Date.now(),b=a,c=0,d=1/0,e=0,f=0,g=1/0,h=0,i=0,j=0,k=document.createElement("div");k.id="stats",k.addEventListener("mousedown",function(a){a.preventDefault(),s(++j%2)},!1),k.style.cssText="width:80px;opacity:0.9;cursor:pointer";var l=document.createElement("div");l.id="fps",l.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",k.appendChild(l);var m=document.createElement("div");m.id="fpsText",m.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",m.innerHTML="FPS",l.appendChild(m);var n=document.createElement("div");for(n.id="fpsGraph",n.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",l.appendChild(n);74>n.children.length;){var o=document.createElement("span");o.style.cssText="width:1px;height:30px;float:left;background-color:#113",n.appendChild(o)}var p=document.createElement("div");p.id="ms",p.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",k.appendChild(p);var q=document.createElement("div");q.id="msText",q.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",q.innerHTML="MS",p.appendChild(q);var r=document.createElement("div");for(r.id="msGraph",r.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",p.appendChild(r);74>r.children.length;)o=document.createElement("span"),o.style.cssText="width:1px;height:30px;float:left;background-color:#131",r.appendChild(o);var s=function(a){switch(j=a){case 0:l.style.display="block",p.style.display="none";break;case 1:l.style.display="none",p.style.display="block"}};return{REVISION:11,domElement:k,setMode:s,begin:function(){a=Date.now()},end:function(){var j=Date.now();c=j-a,d=Math.min(d,c),e=Math.max(e,c),q.textContent=c+" MS ("+d+"-"+e+")";var k=Math.min(30,30-30*(c/200));return r.appendChild(r.firstChild).style.height=k+"px",i++,j>b+1e3&&(f=Math.round(1e3*i/(j-b)),g=Math.min(g,f),h=Math.max(h,f),m.textContent=f+" FPS ("+g+"-"+h+")",k=Math.min(30,30-30*(f/100)),n.appendChild(n.firstChild).style.height=k+"px",b=j,i=0),j},update:function(){a=this.end()}}};e("undefined"!=typeof f?f:window.Stats)}.call(c,void 0,void 0,void 0,void 0,function(a){b.exports=a})}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[4]);