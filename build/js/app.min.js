(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports={
  "name": "nameless-game",
  "version": "0.1.0",
  "description": "nameless",
  "main": "build/js/app.min.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "repository": {
    "type": "git",
    "url": "git@github.com:olivierrr/nameless-game.git"
  },
  "author": "olivierrr",
  "license": "MIT",
  "browser": {
    "lodash": "./node_modules/lodash/dist/lodash.compat.js",
    "Stats": "./src/js/lib/stats.min.js"
  },
  "browserify-shim": {
    "lodash": {
      "exports": "_"
    },
    "Stats": {
      "exports": "Stats"
    }
  },
  "devDependencies": {
    "browserify": "^4.1.5",
    "browserify-shim": "^3.5.0",
    "grunt": "^0.4.5",
    "grunt-browserify": "^2.1.0",
    "grunt-cache-bust": "^0.3.6",
    "grunt-contrib-clean": "^0.5.0",
    "grunt-contrib-connect": "^0.7.1",
    "grunt-contrib-copy": "^0.5.0",
    "grunt-contrib-jade": "^0.11.0",
    "grunt-contrib-jshint": "^0.10.0",
    "grunt-contrib-stylus": "^0.16.0",
    "grunt-contrib-uglify": "^0.4.0",
    "grunt-contrib-watch": "^0.6.1",
    "grunt-open": "^0.2.3",
    "grunt-pngmin": "^0.6.1"
  },
  "dependencies": {
    "grunt-contrib-compress": "^0.9.1",
    "lodash": "^2.4.1",
    "phaser": "^2.1.1"
  }
}

},{}],2:[function(require,module,exports){
var Ragdoll = require('./Ragdoll.js')

/*
 * Player class
 *
 * @extends Ragdoll
 * @constructor Player
 */
var Player = function (game, x, y) {

  /**
   * available controllers: 
   *  'me'      - controlled by users input
   *  'dummy'   - no conroller
   *  'network' - controller over network
   *
   * @property {String} controller
   * @default 'dummy'
   */
  this.controller = 'dummy'

	/**
	 * @reference {Phaser.game} game
	 */
	this.game = game

	/**
 	 * @Object {Phaser.group} ragdoll
	 */
	this.ragdoll = Ragdoll(game, x, y)

	/**
	 * @property {Boolean} isReady
	 */
	this.isReady = false

	/** 
   * @property {Boolen} isAllowingInput
   */
  this.isAllowingInput = true

  /**
   * a turn is an Array of actions
   * an 'action' is a joint event - ex: {jointName:'neck', type:'relax'}
   *
   * @property {Array} turnHistory
   */
  this.turnHistory = []

  /**
   * @property {Array} currentPosition
   */
  this.currentPosition = []

  /**
   * @property {Number} health
   */
  this.health = 100

  //TEST
  this.isResetingPlayback = false

}

/**
 * pushes an empty turn Object to turnHistory
 * ragdoll.newAction will push moves to newly pushed Object
 *
 * @method newTurn
 */
Player.prototype.newTurn = function () {
  this.turnHistory.push({})

  // this shouldn't be here
  this.ragdoll.children.forEach(function (part) {
    part.loadTexture('whitesquare')
  })

  this.isReady = false
}

/**
 * register a new move to latest turn on turnHistory
 *
 * @method newAction
 * @param {Object} move
 */
Player.prototype.newAction = function (move) {
  this.turnHistory[this.turnHistory.length-1][move.jointName] = move.type
}

/**
 * save current position and velocity
 * 
 * @method savePosition
*/
Player.prototype.savePosition = function () {

  this.currentPosition = this.ragdoll.children.map( function (part) {
    var data = part.body.data
    return {
      x: data.position[0], 
      y: data.position[1],
      vx: data.velocity[0],
      vy: data.velocity[1],
      angle: data.angle,
      angularVelocity: data.angularVelocity
    }
  })
}

/**
 * move ragdoll to last position on postision history
 * 
 * @method loadPosition
 */
Player.prototype.loadPosition = function () {

  var pos = this.currentPosition
  this.ragdoll.children.forEach(function(part, i) {
    var data = part.body.data
    data.position[0] = pos[i].x
    data.position[1] = pos[i].y
    data.angle = pos[i].angle,
    data.angularVelocity = pos[i].angularVelocity,
    data.velocity[0] = pos[i].vx,
    data.velocity[1] = pos[i].vy
  })
}

/**
 * create shallow copy of ragdoll with no physics
 *
 * @method clone
 * @return {Phaser.Group} a copy of ragdoll
*/
Player.prototype.clone = function () {
  var ragdollClone = this.game.add.group()

  var parts = this.ragdoll.children.forEach(function(part) {
    var clone = ragdollClone.create(part.position.x, part.position.y, part.key)
    clone.width = part.width
    clone.height = part.height
    clone.rotation = part.rotation
    clone.anchor.x = part.anchor.x
    clone.anchor.y = part.anchor.y
    clone.name = part.name
  })
  return ragdollClone
}

/**
 * singleton clone
 *
 * @method shadow
 */
Player.prototype.shadow = function () {

  if(this.shadowClone) this.shadowClone.destroy(true)

  this.shadowClone = this.clone()
  
  // TODO
  if(this.isAllowingInput) attachEvents(this.shadowClone, this)
}

/**
 * move ragdoll
 *
 * @method executeMove
 * @param {String} jointName
 * @param {String} type
 */
Player.prototype.executeMove = function (jointName, type) {
  switch (type) {
    case 'expand'  : this.ragdoll.flex(jointName)     ;break 
    case 'contract': this.ragdoll.contract(jointName) ;break 
    case 'relax'   : this.ragdoll.relax(jointName)    ;break 
    case 'tense'   : this.ragdoll.tense(jointName)    ;break 
  }
}

/**
 * a turn is an array of moves
 *
 * @method executeMoves
 * @param {Array} turn
 */
Player.prototype.executeMoves = function (turn, alpha) {
  var _this = this

  _this.ragdoll.alpha = alpha || 1 

  Object.keys(turn).forEach(function (jointName) {
    _this.executeMove(jointName, turn[jointName])
  })
}

/**
 * -todo
 */
Player.prototype.replayLastMove = function (turn) {

  this.shadowClone.destroy()

  this.executeMove(turn, 1)
}

//// TODO ////

// TEMP - TODO
function attachEvents (ragdoll, ctx) {
	ragdoll.children.forEach(function(part){
    part.inputEnabled = true
    part.events.onInputDown.add(function(e) {
      muscleClick.call(ctx, e.name)
    })
  })
}

// TEMP - TODO
function muscleClick (muscleName) {

  joint = {
    'head'         : 'neckJoint',
    'upperLeftArm' : 'leftShoulder',
    'lowerLeftArm' : 'leftElbowJoint',
    'upperRightArm': 'rightShoulder',
    'lowerRightArm': 'rightElbowJoint',
    'upperLeftLeg' : 'leftHipJoint',   
    'lowerLeftLeg' : 'leftKneeJoint',  
    'upperRightLeg': 'rightHipJoint', 
    'lowerRightLeg': 'rightKneeJoint', 
    'pelvis'       : 'spineJoint',     
    'upperBody'    : 'spineJoint'
  }

  var jointName = joint[muscleName]
  var jointState = this.turnHistory[this.turnHistory.length-1][jointName]
  var action

  if(jointState === 'expand') action = 'contract'
  else if(jointState === 'contract') action = 'relax'
  else if(jointState === 'relax') action = 'expand'
  else action = 'expand'

  console.log(action, jointName)

  this.newAction({
  	jointName: jointName, 
  	type: action
  })

  textures = {
    'expand'  : 'redsquare',
    'contract': 'bluesquare',
    'relax'   : 'whitesquare'
  }

  this.shadowClone.children.filter(function (part) {
    return part.name === muscleName
  })[0].loadTexture(textures[action])

  this.isResetingPlayback = true
}

Player.prototype.setController = function(controller) {
  this.controller = controller

  if(controller === 'dummy') {
    this.isAllowingInput = false
    this.isReady = true
  }
  if(controller === 'network') {
    this.isAllowingInput = false
  }
  if(controller === 'me') {

  }

}

Player.prototype.reset = function() {
  this.turnHistory = []
  this.currentPosition = [] 
}

Player.prototype.resetPlayback = function () {
  if(this.isResetingPlayback === true) {
    this.isResetingPlayback = false
    return true
  }
  else return false
}

Player.prototype.ready = function() {
  if(this.isReady === true) {
    this.isReady = false
    return true
  }
  else return false
}

// -todo
Player.prototype.method0 = function () {
  this.newTurn()
  this.savePosition()
  this.shadow()
}
// -todo
Player.prototype.method1 = function () {
	this.ragdoll.relaxAll()
  this.newTurn()
  this.savePosition()
  this.shadow()
}
// -todo
Player.prototype.method2 = function () {
	this.loadPosition()
  this.ragdoll.relaxAll()
  this.executeMoves(this.turnHistory[this.turnHistory.length-1], 0.5)
}


module.exports = Player
},{"./Ragdoll.js":3}],3:[function(require,module,exports){
module.exports = function(game, offsetX, offsetY) {

  var FORCE = 10000
  var M = 100 // scale

  var bodySprites = {}
  var bodyJoints = {}
  var bodyParts = {}

  // normalized scales
  var sizes = {}
  sizes.shouldersDistance = 0.4
  sizes.upperArmLength = 0.5
  sizes.lowerArmLength = 0.5
  sizes.upperArmSize = 0.2
  sizes.lowerArmSize = 0.2
  sizes.neckLength = 0.1
  sizes.headRadius = 0.15
  sizes.upperBodyLength = 0.6
  sizes.pelvisLength = 0.4
  sizes.upperLegLength = 0.6
  sizes.upperLegSize = 0.2
  sizes.lowerLegSize = 0.2
  sizes.lowerLegLength = 0.5

  // apply scale multiplier
  Object.keys(sizes).forEach(function(key) {
    sizes[key] *= M
  })

  // Lower legs
  bodyParts.lowerLeftLeg = {
    x: -sizes.shouldersDistance / 2,
    y: sizes.lowerLegLength / 2,
    w: sizes.lowerLegSize,
    h: sizes.lowerLegLength,
    mass: 0.2
  }
  bodyParts.lowerRightLeg = {
    x: sizes.shouldersDistance / 2,
    y: sizes.lowerLegLength / 2,
    w: sizes.lowerLegSize,
    h: sizes.lowerLegLength,
    mass: 0.2
  }
  // Upper legs
  bodyParts.upperLeftLeg = {
    x: -sizes.shouldersDistance / 2,
    y: bodyParts.lowerLeftLeg.y + sizes.lowerLegLength / 2 + sizes.upperLegLength / 2,
    w: sizes.upperLegSize,
    h: sizes.upperLegLength,
    mass: 1
  }
  bodyParts.upperRightLeg = {
    x: sizes.shouldersDistance / 2,
    y: bodyParts.lowerRightLeg.y + sizes.lowerLegLength / 2 + sizes.upperLegLength / 2,
    w: sizes.upperLegSize,
    h: sizes.upperLegLength,
    mass: 1
  }
  // Pelvis
  bodyParts.pelvis = {
    x: 0,
    y: bodyParts.upperLeftLeg.y + sizes.upperLegLength / 2 + sizes.pelvisLength / 2,
    w: sizes.shouldersDistance,
    h: sizes.pelvisLength,
    mass: 1
  }
  // Upper body
  bodyParts.upperBody = {
    x: 0,
    y: bodyParts.pelvis.y + sizes.pelvisLength / 2 + sizes.upperBodyLength / 2,
    w: sizes.shouldersDistance,
    h: sizes.upperBodyLength,
    mass: 1
  }
  // Head
  bodyParts.head = {
    x: 0,
    y: bodyParts.upperBody.y + sizes.upperBodyLength / 2 + sizes.headRadius + sizes.neckLength,
    w: sizes.headRadius * 2,
    h: sizes.headRadius * 2,
    mass: 1
  }
  // Upper arms
  bodyParts.upperLeftArm = {
    x: -sizes.shouldersDistance / 2 - sizes.upperArmLength / 2,
    y: bodyParts.upperBody.y + sizes.upperBodyLength / 2,
    w: sizes.upperArmLength,
    h: sizes.upperArmSize,
    mass: 1
  }
  bodyParts.upperRightArm = {
    x: sizes.shouldersDistance / 2 + sizes.upperArmLength / 2,
    y: bodyParts.upperBody.y + sizes.upperBodyLength / 2,
    w: sizes.upperArmLength,
    h: sizes.upperArmSize,
    mass: 1
  }
  // lower arms
  bodyParts.lowerLeftArm = {
    x: bodyParts.upperLeftArm.x - sizes.lowerArmLength / 2 - sizes.upperArmLength / 2,
    y: bodyParts.upperLeftArm.y,
    w: sizes.lowerArmLength,
    h: sizes.lowerArmSize,
    mass: 1
  }
  bodyParts.lowerRightArm = {
    x: bodyParts.upperRightArm.x + sizes.lowerArmLength / 2 + sizes.upperArmLength / 2,
    y: bodyParts.upperRightArm.y,
    w: sizes.lowerArmLength,
    h: sizes.lowerArmSize,
    mass: 1
  }
  // Neck
  bodyJoints.neckJoint = {
    a: 'head',
    b: 'upperBody',
    pivot_a: [0, -sizes.headRadius - sizes.neckLength / 2],
    pivot_b: [0, sizes.upperBodyLength / 2],
    limits: [-Math.PI/12, Math.PI/12]
  }
  // Knees
  bodyJoints.leftKneeJoint = {
    a: 'lowerLeftLeg',
    b: 'upperLeftLeg',
    pivot_a: [0, sizes.lowerLegLength / 2],
    pivot_b: [0, -sizes.upperLegLength / 2],
    limits: [-Math.PI/5, Math.PI/5]
  }
  bodyJoints.rightKneeJoint = {
    a: 'lowerRightLeg',
    b: 'upperRightLeg',
    pivot_a: [0, sizes.lowerLegLength / 2],
    pivot_b: [0, -sizes.upperLegLength / 2],
    limits: [-Math.PI/5, Math.PI/5]
  }
  // Hips
  bodyJoints.leftHipJoint = {
    a: 'upperLeftLeg',
    b: 'pelvis',
    pivot_a: [0, sizes.upperLegLength / 2],
    pivot_b: [-sizes.shouldersDistance / 2, -sizes.pelvisLength / 2],
    limits: [-Math.PI/6, Math.PI/4]
  }
  bodyJoints.rightHipJoint = {
    a: 'upperRightLeg',
    b: 'pelvis',
    pivot_a: [0, sizes.upperLegLength / 2],
    pivot_b: [sizes.shouldersDistance / 2, -sizes.pelvisLength / 2],
    limits: [-Math.PI/4, Math.PI/6]
  }
    // Spine
  bodyJoints.spineJoint = {
    a: 'pelvis',
    b: 'upperBody',
    pivot_a: [0, sizes.pelvisLength / 2],
    pivot_b: [0, -sizes.upperBodyLength / 2],
    limits: [-Math.PI/5, Math.PI/5]
  }
    // Shoulders
  bodyJoints.leftShoulder = {
    a: 'upperBody',
    b: 'upperLeftArm',
    pivot_a: [-sizes.shouldersDistance / 2, sizes.upperBodyLength / 2],
    pivot_b: [sizes.upperArmLength / 2, 0],
    limits: [-Math.PI/2, Math.PI/2]
  }
  bodyJoints.rightShoulder = {
    a: 'upperBody',
    b: 'upperRightArm',
    pivot_a: [sizes.shouldersDistance / 2, sizes.upperBodyLength / 2],
    pivot_b: [-sizes.upperArmLength / 2, 0],
    limits: [-Math.PI/2, Math.PI/2]
  }
    // Elbows
  bodyJoints.leftElbowJoint = {
    a: 'lowerLeftArm',
    b: 'upperLeftArm',
    pivot_a: [sizes.lowerArmLength / 2, 0],
    pivot_b: [-sizes.upperArmLength / 2, 0],
    limits: [-Math.PI/4, Math.PI/4]
  }
  bodyJoints.rightElbowJoint = {
    a: 'lowerRightArm',
    b: 'upperRightArm',
    pivot_a: [-sizes.lowerArmLength / 2, 0],
    pivot_b: [sizes.upperArmLength / 2, 0],
    limits: [-Math.PI/4, Math.PI/4]
  }

  //

  var ragdoll = game.add.group(null, null, 'ragdoll')

  /**
   * create muscles
   */
  Object.keys(bodyParts).forEach(function(key) {

    var x = bodyParts[key].x + offsetX
    var y = bodyParts[key].y + offsetY
    var w = bodyParts[key].w
    var h = bodyParts[key].h

    var part = ragdoll.create(x, y, 'whitesquare')

    part.width = w
    part.height = h

    part.name = key

    game.physics.p2.enable(part)

    bodySprites[key] = part
  })

  /**
   * create joints
   */
  Object.keys(bodyJoints).forEach(function(key) {

    var joint = bodyJoints[key]
    
    var constraint = game.physics.p2.createRevoluteConstraint
      (
        bodySprites[joint.a], 
        joint.pivot_a, 
        bodySprites[joint.b], 
        joint.pivot_b, 
        FORCE
      )

    constraint.setLimits(joint.limits[0], joint.limits[1])
    constraint.collideConnected = false

    if(!ragdoll.joints) ragdoll.joints = {}
    ragdoll.joints[key] = constraint
  })

  /**
   * enable joint motor
   * 
   * @method flex
   * @param {String} jointName
   */
  ragdoll.flex = function (jointName) {
    var joint = this.joints[jointName]
    joint.enableMotor()
    joint.setMotorSpeed(3)
  }

  /**
   * enable joint motor
   * 
   * @method contract
   * @param {String} jointName
   */
  ragdoll.contract = function (jointName) {
    var joint = this.joints[jointName]
    joint.enableMotor()
    joint.setMotorSpeed(-3)
  }

  /**
   * disabling motor on all joints
   *
   * @method relaxAll
   */
  ragdoll.relaxAll = function() {
    var _this = this
    Object.keys(_this.joints).forEach(function(joint) {
      _this.relax(joint)
    })
  }

  /**
   * disable joint motor
   *
   * @method relax
   * @param {String} jointName
   */
  ragdoll.relax = function(jointName) {
    var joint = ragdoll.joints[jointName]
    joint.disableMotor()
  }

  return ragdoll
}
},{}],4:[function(require,module,exports){

var properties = require('./properties')

var states = { 
	boot: require('./states/boot.js'),
	preloader: require('./states/preloader.js'),
	mainmenu: require('./states/mainmenu.js'),
	singleplayermenu: require('./states/singleplayermenu.js'),
	multiplayermenu: require('./states/multiplayermenu.js'),
	settingsmenu: require('./states/settingsmenu.js'),
	train: require('./states/train.js'),
	quickmatch: require('./states/quickmatch.js')
}

window.onload = function() {

	var Phaser = window.Phaser // hack
	var io = window.io // hack

	var game = new Phaser.Game(properties.size.x, properties.size.y, Phaser.AUTO, 'game')

	game.state.add('boot', states.boot(game))
	game.state.add('preloader', states.preloader(game))
	game.state.add('mainmenu', states.mainmenu(game))
	game.state.add('singleplayermenu', states.singleplayermenu(game))
	game.state.add('multiplayermenu', states.multiplayermenu(game))
	game.state.add('settingsmenu', states.settingsmenu(game))
	game.state.add('train', states.train(game))
	game.state.add('quickmatch', states.quickmatch(game))

	game.state.start('boot')
}
},{"./properties":5,"./states/boot.js":6,"./states/mainmenu.js":7,"./states/multiplayermenu.js":8,"./states/preloader.js":9,"./states/quickmatch.js":10,"./states/settingsmenu.js":11,"./states/singleplayermenu.js":12,"./states/train.js":13}],5:[function(require,module,exports){
var npmProperties = require('../../../package.json')

module.exports = { 

  title: 'Phaser JS Boilerplate',

  description: npmProperties.description,

  port: 3017,

  liveReloadPort: 3018,

  showStats: true,

  size: { 
    x: 800,
    y: 600
  }, 
  
  analyticsId: ''
}

},{"../../../package.json":1}],6:[function(require,module,exports){
var Stats = require('Stats')
  , properties = require('../properties')

module.exports = function(game) {

  // FPS counter
  function addStats() {
    var stats = new Stats()
    stats.setMode(0)
    stats.domElement.style.position = 'absolute'
    stats.domElement.style.left = '0px'
    stats.domElement.style.top = '0px'
    document.body.appendChild(stats.domElement)
    setInterval(function () {
      stats.begin()
      stats.end()
    }, 1000 / 60)
  }

  var boot = {}

  boot.create = function () {

    if (properties.showStats) addStats()

    game.scale.pageAlignHorizontally = true
    game.scale.pageAlignVertically = true
    game.scale.refresh()

    game.state.start('preloader')
  }

  return boot
}

},{"../properties":5,"Stats":14}],7:[function(require,module,exports){
module.exports = function(game) {

  var gameState = {}

  gameState.create = function () {

    var logo = game.add.sprite(game.world.centerX, 200, 'logo')
    logo.anchor.setTo(0.5, 0.5)

    var style = { font: '40px Arial', fill: '#ffffff', align: 'center'}

    var singlePlayerButton = game.add.text(game.world.centerX, 450, 'single player', style)
    singlePlayerButton.anchor.setTo(0.5, 0.5)
    singlePlayerButton.inputEnabled = true
    singlePlayerButton.events.onInputDown.add(function() {
			game.state.start('singleplayermenu')
    })

    var multiPlayerButton = game.add.text(game.world.centerX, 500, 'multi player', style)
    multiPlayerButton.anchor.setTo(0.5, 0.5)
    multiPlayerButton.inputEnabled = true
    multiPlayerButton.events.onInputDown.add(function() {
			game.state.start('multiplayermenu')
    })

    var settingsButton = game.add.text(game.world.centerX, 550, 'settings', style)
    settingsButton.anchor.setTo(0.5, 0.5)
    settingsButton.inputEnabled = true
    settingsButton.events.onInputDown.add(function() {
    	game.state.start('settingsmenu')
    })

  }

  gameState.update = function() {
  	
  }

  return gameState
}

},{}],8:[function(require,module,exports){
module.exports = function(game) {

  var gameState = {}

  gameState.create = function () {

  	var style = { font: '40px Arial', fill: '#ffffff', align: 'center'}
  	var mainMenuButton = game.add.text(100, 50, 'back', style)
    mainMenuButton.anchor.setTo(0.5, 0.5)
    mainMenuButton.inputEnabled = true
    mainMenuButton.events.onInputDown.add(function() {
			game.state.start('mainmenu')
    })

    var train = game.add.text(game.world.centerX, 300, 'quickmatch', style)
    train.anchor.setTo(0.5, 0.5)
    train.inputEnabled = true
    train.events.onInputDown.add(function() {
      game.state.start('quickmatch')
    })

  }

  return gameState
}
},{}],9:[function(require,module,exports){
module.exports = function(game) {

  var preloader = {}

  preloader.preload = function () {
    game.load.image('logo', 'images/phaser.png#grunt-cache-bust')
    game.load.image('redsquare', 'images/redsquare.png#grunt-cache-bust')
    game.load.image('bluesquare', 'images/bluesquare.jpg#grunt-cache-bust')
    game.load.image('whitesquare', 'images/whitesquare.png#grunt-cache-bust')
  }

  preloader.create = function () {
    game.state.start('mainmenu')
  }

  return preloader
}

},{}],10:[function(require,module,exports){
var Player = require('../Player.js')

var socket

module.exports = function(game) {

  var gameState = {}

  var p1, p2, isP1, isP2

  var isPlaying = false

  var id

  var game = game

  gameState.create = function () {

    socket = window.socket = io('http://localhost:9000')

    game.physics.startSystem(Phaser.Physics.P2JS)
    game.physics.p2.gravity.y = 200

  	var style = { font: '40px Arial', fill: '#ffffff', align: 'center'}
  	var mainMenuButton = game.add.text(100, 50, 'back', style)
    mainMenuButton.anchor.setTo(0.5, 0.5)
    mainMenuButton.inputEnabled = true
    mainMenuButton.events.onInputDown.add(function() {
      socket.emit('leave-lobby')
			game.state.start('multiplayermenu')

      if(p1&&p2) {
        p1.ragdoll.destroy()
        p2.ragdoll.destroy()
        p1 = null
        p2 = null
      }
    })

    p1 = new Player(game, 200, 200)
    p1.method0()
    p2 = new Player(game, 600, 200)
    p2.method0()

    socket.emit('join-lobby')

    socket.on('id', function(socketId) {
      console.log('id', socketId)
      id = socketId
    })

    socket.on('players-list', function (playerList) {
      console.log(playerList)
      playerList.forEach(function(player, i) {
        game.add.text(550, 20*(i+1), player, {fill: '#ffffff', font: '16px Arial'})
      })
    })

    socket.on('new-game', function (players) {

      console.log(players)

      isP1 = false
      isP2 = false

      if(players.p1 === id) {
        isP1 = true
        p1.setController('me')
        p1.reset()
        p1.method0()
        console.log('you are p1')
      } else {
        isP2 = false
        p1.setController('dummy')
        p1.reset()
        p1.method0()
      }

      if(players.p2 === id) {
        isP2 = true
        p2.setController('me')
        p2.reset()
        p2.method0()
        console.log('you are p2')
      } else {
        isP2 = false
        p2.setController('dummy')
        p2.reset()
        p2.method0()
      }

      var p1id = players.p1
      var p2id = players.p2

      socket.on('turn', function (turn) {
        if(isP2) {
          p1.turnHistory.push(turn.p1)
        } 
        else if(isP1) {
          p2.turnHistory.push(turn.p2)
        }
        else {
          p1.turnHistory.push(turn.p1)
          p2.turnHistory.push(turn.p2)
        }

        p1.method1()
        p2.method1()

        console.log(turn)
      })
    })
    
    // debug
    window.game = game
    window.p1 = p1
    window.p2 = p2

  }

  var frameCount = 0
  var newTurn = false

  gameState.update = function () {

    if(p1 && p2) {

      frameCount++

      if(p1.resetPlayback() || p2.resetPlayback()) {
        p1.method2()
        p2.method2()
        frameCount = 0
      }

      if(frameCount === 100) {
        frameCount = 0
        p1.method2()
        p2.method2()
      }

      if(game.input.keyboard.justPressed(Phaser.Keyboard.SPACEBAR)) {
        if(isP1 || isP2) {
          socket.emit('action', id)
        }
      }
    }

  }

  return gameState
}
},{"../Player.js":2}],11:[function(require,module,exports){
module.exports = function(game) {

  var gameState = {}

  gameState.create = function () {
  	
  	var style = { font: '40px Arial', fill: '#ffffff', align: 'center'}
  	var mainMenuButton = game.add.text(100, 50, 'back', style)
    mainMenuButton.anchor.setTo(0.5, 0.5)
    mainMenuButton.inputEnabled = true
    mainMenuButton.events.onInputDown.add(function() {
			game.state.start('mainmenu')
    })
  }

  return gameState
}
},{}],12:[function(require,module,exports){
module.exports = function(game) {

  var gameState = {}

  gameState.create = function () {

  	var style = { font: '40px Arial', fill: '#ffffff', align: 'center'}
  	var mainMenuButton = game.add.text(100, 50, 'back', style)
    mainMenuButton.anchor.setTo(0.5, 0.5)
    mainMenuButton.inputEnabled = true
    mainMenuButton.events.onInputDown.add(function() {
			game.state.start('mainmenu')
    })

  	var train = game.add.text(game.world.centerX, 300, 'train', style)
    train.anchor.setTo(0.5, 0.5)
    train.inputEnabled = true
    train.events.onInputDown.add(function() {
			game.state.start('train')
    })
  }

  return gameState
}

},{}],13:[function(require,module,exports){
var Player = require('../Player.js')

module.exports = function(game) {

  var gameState = {}

  var p1, p2

  gameState.create = function () {

  	var style = { font: '40px Arial', fill: '#ffffff', align: 'center'}
  	var mainMenuButton = game.add.text(100, 50, 'back', style)
    mainMenuButton.anchor.setTo(0.5, 0.5)
    mainMenuButton.inputEnabled = true
    mainMenuButton.events.onInputDown.add(function() {
			game.state.start('singleplayermenu')
      if(p1&&p2) {
        p1.ragdoll.destroy()
        p2.ragdoll.destroy()
        p1 = null
        p2 = null
      }
    })

    game.physics.startSystem(Phaser.Physics.P2JS)
    game.physics.p2.gravity.y = 200

    p1 = new Player(game, 200, 200)
    p1.setController('me')
    p1.method0()

    p2 = new Player(game, 600, 200)
    p2.setController('dummy')
    p2.method0()
    
    // debug
    window.game = game
    window.p1 = p1
    window.p2 = p2
  }

  var frameCount = 0
  var newTurn = false

  gameState.update = function () {

    frameCount++

    if(p1.resetPlayback() || p2.resetPlayback()) {
      p1.method2()
      p2.method2()
      frameCount = 0
    }

    if(frameCount === 100) {
      frameCount = 0

      if(p1.ready() && p2.ready()) {
        p1.method1()
        p2.method1()
      } else {
        p1.method2()
        p2.method2()
      }
    }

    if(game.input.keyboard.justPressed(Phaser.Keyboard.SPACEBAR)) {
      p1.isReady = true
      p2.isReady = true
    }
  }

  return gameState
}
},{"../Player.js":2}],14:[function(require,module,exports){
(function (global){
;__browserify_shim_require__=require;(function browserifyShim(module, exports, require, define, browserify_shim__define__module__export__) {
// stats.js - http://github.com/mrdoob/stats.js
var Stats=function(){var l=Date.now(),m=l,g=0,n=Infinity,o=0,h=0,p=Infinity,q=0,r=0,s=0,f=document.createElement("div");f.id="stats";f.addEventListener("mousedown",function(b){b.preventDefault();t(++s%2)},!1);f.style.cssText="width:80px;opacity:0.9;cursor:pointer";var a=document.createElement("div");a.id="fps";a.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002";f.appendChild(a);var i=document.createElement("div");i.id="fpsText";i.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";
i.innerHTML="FPS";a.appendChild(i);var c=document.createElement("div");c.id="fpsGraph";c.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(a.appendChild(c);74>c.children.length;){var j=document.createElement("span");j.style.cssText="width:1px;height:30px;float:left;background-color:#113";c.appendChild(j)}var d=document.createElement("div");d.id="ms";d.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";f.appendChild(d);var k=document.createElement("div");
k.id="msText";k.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";k.innerHTML="MS";d.appendChild(k);var e=document.createElement("div");e.id="msGraph";e.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";for(d.appendChild(e);74>e.children.length;)j=document.createElement("span"),j.style.cssText="width:1px;height:30px;float:left;background-color:#131",e.appendChild(j);var t=function(b){s=b;switch(s){case 0:a.style.display=
"block";d.style.display="none";break;case 1:a.style.display="none",d.style.display="block"}};return{REVISION:11,domElement:f,setMode:t,begin:function(){l=Date.now()},end:function(){var b=Date.now();g=b-l;n=Math.min(n,g);o=Math.max(o,g);k.textContent=g+" MS ("+n+"-"+o+")";var a=Math.min(30,30-30*(g/200));e.appendChild(e.firstChild).style.height=a+"px";r++;b>m+1E3&&(h=Math.round(1E3*r/(b-m)),p=Math.min(p,h),q=Math.max(q,h),i.textContent=h+" FPS ("+p+"-"+q+")",a=Math.min(30,30-30*(h/100)),c.appendChild(c.firstChild).style.height=
a+"px",m=b,r=0);return b},update:function(){l=this.end()}}};
; browserify_shim__define__module__export__(typeof Stats != "undefined" ? Stats : window.Stats);

}).call(global, undefined, undefined, undefined, undefined, function defineExport(ex) { module.exports = ex; });

}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}]},{},[4])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL29saXZpZXIvRG9jdW1lbnRzL3Byb2dyYW1pbmcvZ2FtZXMvbmFtZWxlc3MtZ2FtZS9ub2RlX21vZHVsZXMvYnJvd3NlcmlmeS9ub2RlX21vZHVsZXMvYnJvd3Nlci1wYWNrL19wcmVsdWRlLmpzIiwiL2hvbWUvb2xpdmllci9Eb2N1bWVudHMvcHJvZ3JhbWluZy9nYW1lcy9uYW1lbGVzcy1nYW1lL3BhY2thZ2UuanNvbiIsIi9ob21lL29saXZpZXIvRG9jdW1lbnRzL3Byb2dyYW1pbmcvZ2FtZXMvbmFtZWxlc3MtZ2FtZS9zcmMvanMvZ2FtZS9QbGF5ZXIuanMiLCIvaG9tZS9vbGl2aWVyL0RvY3VtZW50cy9wcm9ncmFtaW5nL2dhbWVzL25hbWVsZXNzLWdhbWUvc3JjL2pzL2dhbWUvUmFnZG9sbC5qcyIsIi9ob21lL29saXZpZXIvRG9jdW1lbnRzL3Byb2dyYW1pbmcvZ2FtZXMvbmFtZWxlc3MtZ2FtZS9zcmMvanMvZ2FtZS9hcHAuanMiLCIvaG9tZS9vbGl2aWVyL0RvY3VtZW50cy9wcm9ncmFtaW5nL2dhbWVzL25hbWVsZXNzLWdhbWUvc3JjL2pzL2dhbWUvcHJvcGVydGllcy5qcyIsIi9ob21lL29saXZpZXIvRG9jdW1lbnRzL3Byb2dyYW1pbmcvZ2FtZXMvbmFtZWxlc3MtZ2FtZS9zcmMvanMvZ2FtZS9zdGF0ZXMvYm9vdC5qcyIsIi9ob21lL29saXZpZXIvRG9jdW1lbnRzL3Byb2dyYW1pbmcvZ2FtZXMvbmFtZWxlc3MtZ2FtZS9zcmMvanMvZ2FtZS9zdGF0ZXMvbWFpbm1lbnUuanMiLCIvaG9tZS9vbGl2aWVyL0RvY3VtZW50cy9wcm9ncmFtaW5nL2dhbWVzL25hbWVsZXNzLWdhbWUvc3JjL2pzL2dhbWUvc3RhdGVzL211bHRpcGxheWVybWVudS5qcyIsIi9ob21lL29saXZpZXIvRG9jdW1lbnRzL3Byb2dyYW1pbmcvZ2FtZXMvbmFtZWxlc3MtZ2FtZS9zcmMvanMvZ2FtZS9zdGF0ZXMvcHJlbG9hZGVyLmpzIiwiL2hvbWUvb2xpdmllci9Eb2N1bWVudHMvcHJvZ3JhbWluZy9nYW1lcy9uYW1lbGVzcy1nYW1lL3NyYy9qcy9nYW1lL3N0YXRlcy9xdWlja21hdGNoLmpzIiwiL2hvbWUvb2xpdmllci9Eb2N1bWVudHMvcHJvZ3JhbWluZy9nYW1lcy9uYW1lbGVzcy1nYW1lL3NyYy9qcy9nYW1lL3N0YXRlcy9zZXR0aW5nc21lbnUuanMiLCIvaG9tZS9vbGl2aWVyL0RvY3VtZW50cy9wcm9ncmFtaW5nL2dhbWVzL25hbWVsZXNzLWdhbWUvc3JjL2pzL2dhbWUvc3RhdGVzL3NpbmdsZXBsYXllcm1lbnUuanMiLCIvaG9tZS9vbGl2aWVyL0RvY3VtZW50cy9wcm9ncmFtaW5nL2dhbWVzL25hbWVsZXNzLWdhbWUvc3JjL2pzL2dhbWUvc3RhdGVzL3RyYWluLmpzIiwiL2hvbWUvb2xpdmllci9Eb2N1bWVudHMvcHJvZ3JhbWluZy9nYW1lcy9uYW1lbGVzcy1nYW1lL3NyYy9qcy9saWIvc3RhdHMubWluLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcFVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3Rocm93IG5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIil9dmFyIGY9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGYuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sZixmLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIm1vZHVsZS5leHBvcnRzPXtcbiAgXCJuYW1lXCI6IFwibmFtZWxlc3MtZ2FtZVwiLFxuICBcInZlcnNpb25cIjogXCIwLjEuMFwiLFxuICBcImRlc2NyaXB0aW9uXCI6IFwibmFtZWxlc3NcIixcbiAgXCJtYWluXCI6IFwiYnVpbGQvanMvYXBwLm1pbi5qc1wiLFxuICBcInNjcmlwdHNcIjoge1xuICAgIFwidGVzdFwiOiBcImVjaG8gXFxcIkVycm9yOiBubyB0ZXN0IHNwZWNpZmllZFxcXCIgJiYgZXhpdCAxXCJcbiAgfSxcbiAgXCJyZXBvc2l0b3J5XCI6IHtcbiAgICBcInR5cGVcIjogXCJnaXRcIixcbiAgICBcInVybFwiOiBcImdpdEBnaXRodWIuY29tOm9saXZpZXJyci9uYW1lbGVzcy1nYW1lLmdpdFwiXG4gIH0sXG4gIFwiYXV0aG9yXCI6IFwib2xpdmllcnJyXCIsXG4gIFwibGljZW5zZVwiOiBcIk1JVFwiLFxuICBcImJyb3dzZXJcIjoge1xuICAgIFwibG9kYXNoXCI6IFwiLi9ub2RlX21vZHVsZXMvbG9kYXNoL2Rpc3QvbG9kYXNoLmNvbXBhdC5qc1wiLFxuICAgIFwiU3RhdHNcIjogXCIuL3NyYy9qcy9saWIvc3RhdHMubWluLmpzXCJcbiAgfSxcbiAgXCJicm93c2VyaWZ5LXNoaW1cIjoge1xuICAgIFwibG9kYXNoXCI6IHtcbiAgICAgIFwiZXhwb3J0c1wiOiBcIl9cIlxuICAgIH0sXG4gICAgXCJTdGF0c1wiOiB7XG4gICAgICBcImV4cG9ydHNcIjogXCJTdGF0c1wiXG4gICAgfVxuICB9LFxuICBcImRldkRlcGVuZGVuY2llc1wiOiB7XG4gICAgXCJicm93c2VyaWZ5XCI6IFwiXjQuMS41XCIsXG4gICAgXCJicm93c2VyaWZ5LXNoaW1cIjogXCJeMy41LjBcIixcbiAgICBcImdydW50XCI6IFwiXjAuNC41XCIsXG4gICAgXCJncnVudC1icm93c2VyaWZ5XCI6IFwiXjIuMS4wXCIsXG4gICAgXCJncnVudC1jYWNoZS1idXN0XCI6IFwiXjAuMy42XCIsXG4gICAgXCJncnVudC1jb250cmliLWNsZWFuXCI6IFwiXjAuNS4wXCIsXG4gICAgXCJncnVudC1jb250cmliLWNvbm5lY3RcIjogXCJeMC43LjFcIixcbiAgICBcImdydW50LWNvbnRyaWItY29weVwiOiBcIl4wLjUuMFwiLFxuICAgIFwiZ3J1bnQtY29udHJpYi1qYWRlXCI6IFwiXjAuMTEuMFwiLFxuICAgIFwiZ3J1bnQtY29udHJpYi1qc2hpbnRcIjogXCJeMC4xMC4wXCIsXG4gICAgXCJncnVudC1jb250cmliLXN0eWx1c1wiOiBcIl4wLjE2LjBcIixcbiAgICBcImdydW50LWNvbnRyaWItdWdsaWZ5XCI6IFwiXjAuNC4wXCIsXG4gICAgXCJncnVudC1jb250cmliLXdhdGNoXCI6IFwiXjAuNi4xXCIsXG4gICAgXCJncnVudC1vcGVuXCI6IFwiXjAuMi4zXCIsXG4gICAgXCJncnVudC1wbmdtaW5cIjogXCJeMC42LjFcIlxuICB9LFxuICBcImRlcGVuZGVuY2llc1wiOiB7XG4gICAgXCJncnVudC1jb250cmliLWNvbXByZXNzXCI6IFwiXjAuOS4xXCIsXG4gICAgXCJsb2Rhc2hcIjogXCJeMi40LjFcIixcbiAgICBcInBoYXNlclwiOiBcIl4yLjEuMVwiXG4gIH1cbn1cbiIsInZhciBSYWdkb2xsID0gcmVxdWlyZSgnLi9SYWdkb2xsLmpzJylcblxuLypcbiAqIFBsYXllciBjbGFzc1xuICpcbiAqIEBleHRlbmRzIFJhZ2RvbGxcbiAqIEBjb25zdHJ1Y3RvciBQbGF5ZXJcbiAqL1xudmFyIFBsYXllciA9IGZ1bmN0aW9uIChnYW1lLCB4LCB5KSB7XG5cbiAgLyoqXG4gICAqIGF2YWlsYWJsZSBjb250cm9sbGVyczogXG4gICAqICAnbWUnICAgICAgLSBjb250cm9sbGVkIGJ5IHVzZXJzIGlucHV0XG4gICAqICAnZHVtbXknICAgLSBubyBjb25yb2xsZXJcbiAgICogICduZXR3b3JrJyAtIGNvbnRyb2xsZXIgb3ZlciBuZXR3b3JrXG4gICAqXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBjb250cm9sbGVyXG4gICAqIEBkZWZhdWx0ICdkdW1teSdcbiAgICovXG4gIHRoaXMuY29udHJvbGxlciA9ICdkdW1teSdcblxuXHQvKipcblx0ICogQHJlZmVyZW5jZSB7UGhhc2VyLmdhbWV9IGdhbWVcblx0ICovXG5cdHRoaXMuZ2FtZSA9IGdhbWVcblxuXHQvKipcbiBcdCAqIEBPYmplY3Qge1BoYXNlci5ncm91cH0gcmFnZG9sbFxuXHQgKi9cblx0dGhpcy5yYWdkb2xsID0gUmFnZG9sbChnYW1lLCB4LCB5KVxuXG5cdC8qKlxuXHQgKiBAcHJvcGVydHkge0Jvb2xlYW59IGlzUmVhZHlcblx0ICovXG5cdHRoaXMuaXNSZWFkeSA9IGZhbHNlXG5cblx0LyoqIFxuICAgKiBAcHJvcGVydHkge0Jvb2xlbn0gaXNBbGxvd2luZ0lucHV0XG4gICAqL1xuICB0aGlzLmlzQWxsb3dpbmdJbnB1dCA9IHRydWVcblxuICAvKipcbiAgICogYSB0dXJuIGlzIGFuIEFycmF5IG9mIGFjdGlvbnNcbiAgICogYW4gJ2FjdGlvbicgaXMgYSBqb2ludCBldmVudCAtIGV4OiB7am9pbnROYW1lOiduZWNrJywgdHlwZToncmVsYXgnfVxuICAgKlxuICAgKiBAcHJvcGVydHkge0FycmF5fSB0dXJuSGlzdG9yeVxuICAgKi9cbiAgdGhpcy50dXJuSGlzdG9yeSA9IFtdXG5cbiAgLyoqXG4gICAqIEBwcm9wZXJ0eSB7QXJyYXl9IGN1cnJlbnRQb3NpdGlvblxuICAgKi9cbiAgdGhpcy5jdXJyZW50UG9zaXRpb24gPSBbXVxuXG4gIC8qKlxuICAgKiBAcHJvcGVydHkge051bWJlcn0gaGVhbHRoXG4gICAqL1xuICB0aGlzLmhlYWx0aCA9IDEwMFxuXG4gIC8vVEVTVFxuICB0aGlzLmlzUmVzZXRpbmdQbGF5YmFjayA9IGZhbHNlXG5cbn1cblxuLyoqXG4gKiBwdXNoZXMgYW4gZW1wdHkgdHVybiBPYmplY3QgdG8gdHVybkhpc3RvcnlcbiAqIHJhZ2RvbGwubmV3QWN0aW9uIHdpbGwgcHVzaCBtb3ZlcyB0byBuZXdseSBwdXNoZWQgT2JqZWN0XG4gKlxuICogQG1ldGhvZCBuZXdUdXJuXG4gKi9cblBsYXllci5wcm90b3R5cGUubmV3VHVybiA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy50dXJuSGlzdG9yeS5wdXNoKHt9KVxuXG4gIC8vIHRoaXMgc2hvdWxkbid0IGJlIGhlcmVcbiAgdGhpcy5yYWdkb2xsLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKHBhcnQpIHtcbiAgICBwYXJ0LmxvYWRUZXh0dXJlKCd3aGl0ZXNxdWFyZScpXG4gIH0pXG5cbiAgdGhpcy5pc1JlYWR5ID0gZmFsc2Vcbn1cblxuLyoqXG4gKiByZWdpc3RlciBhIG5ldyBtb3ZlIHRvIGxhdGVzdCB0dXJuIG9uIHR1cm5IaXN0b3J5XG4gKlxuICogQG1ldGhvZCBuZXdBY3Rpb25cbiAqIEBwYXJhbSB7T2JqZWN0fSBtb3ZlXG4gKi9cblBsYXllci5wcm90b3R5cGUubmV3QWN0aW9uID0gZnVuY3Rpb24gKG1vdmUpIHtcbiAgdGhpcy50dXJuSGlzdG9yeVt0aGlzLnR1cm5IaXN0b3J5Lmxlbmd0aC0xXVttb3ZlLmpvaW50TmFtZV0gPSBtb3ZlLnR5cGVcbn1cblxuLyoqXG4gKiBzYXZlIGN1cnJlbnQgcG9zaXRpb24gYW5kIHZlbG9jaXR5XG4gKiBcbiAqIEBtZXRob2Qgc2F2ZVBvc2l0aW9uXG4qL1xuUGxheWVyLnByb3RvdHlwZS5zYXZlUG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7XG5cbiAgdGhpcy5jdXJyZW50UG9zaXRpb24gPSB0aGlzLnJhZ2RvbGwuY2hpbGRyZW4ubWFwKCBmdW5jdGlvbiAocGFydCkge1xuICAgIHZhciBkYXRhID0gcGFydC5ib2R5LmRhdGFcbiAgICByZXR1cm4ge1xuICAgICAgeDogZGF0YS5wb3NpdGlvblswXSwgXG4gICAgICB5OiBkYXRhLnBvc2l0aW9uWzFdLFxuICAgICAgdng6IGRhdGEudmVsb2NpdHlbMF0sXG4gICAgICB2eTogZGF0YS52ZWxvY2l0eVsxXSxcbiAgICAgIGFuZ2xlOiBkYXRhLmFuZ2xlLFxuICAgICAgYW5ndWxhclZlbG9jaXR5OiBkYXRhLmFuZ3VsYXJWZWxvY2l0eVxuICAgIH1cbiAgfSlcbn1cblxuLyoqXG4gKiBtb3ZlIHJhZ2RvbGwgdG8gbGFzdCBwb3NpdGlvbiBvbiBwb3N0aXNpb24gaGlzdG9yeVxuICogXG4gKiBAbWV0aG9kIGxvYWRQb3NpdGlvblxuICovXG5QbGF5ZXIucHJvdG90eXBlLmxvYWRQb3NpdGlvbiA9IGZ1bmN0aW9uICgpIHtcblxuICB2YXIgcG9zID0gdGhpcy5jdXJyZW50UG9zaXRpb25cbiAgdGhpcy5yYWdkb2xsLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24ocGFydCwgaSkge1xuICAgIHZhciBkYXRhID0gcGFydC5ib2R5LmRhdGFcbiAgICBkYXRhLnBvc2l0aW9uWzBdID0gcG9zW2ldLnhcbiAgICBkYXRhLnBvc2l0aW9uWzFdID0gcG9zW2ldLnlcbiAgICBkYXRhLmFuZ2xlID0gcG9zW2ldLmFuZ2xlLFxuICAgIGRhdGEuYW5ndWxhclZlbG9jaXR5ID0gcG9zW2ldLmFuZ3VsYXJWZWxvY2l0eSxcbiAgICBkYXRhLnZlbG9jaXR5WzBdID0gcG9zW2ldLnZ4LFxuICAgIGRhdGEudmVsb2NpdHlbMV0gPSBwb3NbaV0udnlcbiAgfSlcbn1cblxuLyoqXG4gKiBjcmVhdGUgc2hhbGxvdyBjb3B5IG9mIHJhZ2RvbGwgd2l0aCBubyBwaHlzaWNzXG4gKlxuICogQG1ldGhvZCBjbG9uZVxuICogQHJldHVybiB7UGhhc2VyLkdyb3VwfSBhIGNvcHkgb2YgcmFnZG9sbFxuKi9cblBsYXllci5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciByYWdkb2xsQ2xvbmUgPSB0aGlzLmdhbWUuYWRkLmdyb3VwKClcblxuICB2YXIgcGFydHMgPSB0aGlzLnJhZ2RvbGwuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihwYXJ0KSB7XG4gICAgdmFyIGNsb25lID0gcmFnZG9sbENsb25lLmNyZWF0ZShwYXJ0LnBvc2l0aW9uLngsIHBhcnQucG9zaXRpb24ueSwgcGFydC5rZXkpXG4gICAgY2xvbmUud2lkdGggPSBwYXJ0LndpZHRoXG4gICAgY2xvbmUuaGVpZ2h0ID0gcGFydC5oZWlnaHRcbiAgICBjbG9uZS5yb3RhdGlvbiA9IHBhcnQucm90YXRpb25cbiAgICBjbG9uZS5hbmNob3IueCA9IHBhcnQuYW5jaG9yLnhcbiAgICBjbG9uZS5hbmNob3IueSA9IHBhcnQuYW5jaG9yLnlcbiAgICBjbG9uZS5uYW1lID0gcGFydC5uYW1lXG4gIH0pXG4gIHJldHVybiByYWdkb2xsQ2xvbmVcbn1cblxuLyoqXG4gKiBzaW5nbGV0b24gY2xvbmVcbiAqXG4gKiBAbWV0aG9kIHNoYWRvd1xuICovXG5QbGF5ZXIucHJvdG90eXBlLnNoYWRvdyA9IGZ1bmN0aW9uICgpIHtcblxuICBpZih0aGlzLnNoYWRvd0Nsb25lKSB0aGlzLnNoYWRvd0Nsb25lLmRlc3Ryb3kodHJ1ZSlcblxuICB0aGlzLnNoYWRvd0Nsb25lID0gdGhpcy5jbG9uZSgpXG4gIFxuICAvLyBUT0RPXG4gIGlmKHRoaXMuaXNBbGxvd2luZ0lucHV0KSBhdHRhY2hFdmVudHModGhpcy5zaGFkb3dDbG9uZSwgdGhpcylcbn1cblxuLyoqXG4gKiBtb3ZlIHJhZ2RvbGxcbiAqXG4gKiBAbWV0aG9kIGV4ZWN1dGVNb3ZlXG4gKiBAcGFyYW0ge1N0cmluZ30gam9pbnROYW1lXG4gKiBAcGFyYW0ge1N0cmluZ30gdHlwZVxuICovXG5QbGF5ZXIucHJvdG90eXBlLmV4ZWN1dGVNb3ZlID0gZnVuY3Rpb24gKGpvaW50TmFtZSwgdHlwZSkge1xuICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlICdleHBhbmQnICA6IHRoaXMucmFnZG9sbC5mbGV4KGpvaW50TmFtZSkgICAgIDticmVhayBcbiAgICBjYXNlICdjb250cmFjdCc6IHRoaXMucmFnZG9sbC5jb250cmFjdChqb2ludE5hbWUpIDticmVhayBcbiAgICBjYXNlICdyZWxheCcgICA6IHRoaXMucmFnZG9sbC5yZWxheChqb2ludE5hbWUpICAgIDticmVhayBcbiAgICBjYXNlICd0ZW5zZScgICA6IHRoaXMucmFnZG9sbC50ZW5zZShqb2ludE5hbWUpICAgIDticmVhayBcbiAgfVxufVxuXG4vKipcbiAqIGEgdHVybiBpcyBhbiBhcnJheSBvZiBtb3Zlc1xuICpcbiAqIEBtZXRob2QgZXhlY3V0ZU1vdmVzXG4gKiBAcGFyYW0ge0FycmF5fSB0dXJuXG4gKi9cblBsYXllci5wcm90b3R5cGUuZXhlY3V0ZU1vdmVzID0gZnVuY3Rpb24gKHR1cm4sIGFscGhhKSB7XG4gIHZhciBfdGhpcyA9IHRoaXNcblxuICBfdGhpcy5yYWdkb2xsLmFscGhhID0gYWxwaGEgfHwgMSBcblxuICBPYmplY3Qua2V5cyh0dXJuKS5mb3JFYWNoKGZ1bmN0aW9uIChqb2ludE5hbWUpIHtcbiAgICBfdGhpcy5leGVjdXRlTW92ZShqb2ludE5hbWUsIHR1cm5bam9pbnROYW1lXSlcbiAgfSlcbn1cblxuLyoqXG4gKiAtdG9kb1xuICovXG5QbGF5ZXIucHJvdG90eXBlLnJlcGxheUxhc3RNb3ZlID0gZnVuY3Rpb24gKHR1cm4pIHtcblxuICB0aGlzLnNoYWRvd0Nsb25lLmRlc3Ryb3koKVxuXG4gIHRoaXMuZXhlY3V0ZU1vdmUodHVybiwgMSlcbn1cblxuLy8vLyBUT0RPIC8vLy9cblxuLy8gVEVNUCAtIFRPRE9cbmZ1bmN0aW9uIGF0dGFjaEV2ZW50cyAocmFnZG9sbCwgY3R4KSB7XG5cdHJhZ2RvbGwuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihwYXJ0KXtcbiAgICBwYXJ0LmlucHV0RW5hYmxlZCA9IHRydWVcbiAgICBwYXJ0LmV2ZW50cy5vbklucHV0RG93bi5hZGQoZnVuY3Rpb24oZSkge1xuICAgICAgbXVzY2xlQ2xpY2suY2FsbChjdHgsIGUubmFtZSlcbiAgICB9KVxuICB9KVxufVxuXG4vLyBURU1QIC0gVE9ET1xuZnVuY3Rpb24gbXVzY2xlQ2xpY2sgKG11c2NsZU5hbWUpIHtcblxuICBqb2ludCA9IHtcbiAgICAnaGVhZCcgICAgICAgICA6ICduZWNrSm9pbnQnLFxuICAgICd1cHBlckxlZnRBcm0nIDogJ2xlZnRTaG91bGRlcicsXG4gICAgJ2xvd2VyTGVmdEFybScgOiAnbGVmdEVsYm93Sm9pbnQnLFxuICAgICd1cHBlclJpZ2h0QXJtJzogJ3JpZ2h0U2hvdWxkZXInLFxuICAgICdsb3dlclJpZ2h0QXJtJzogJ3JpZ2h0RWxib3dKb2ludCcsXG4gICAgJ3VwcGVyTGVmdExlZycgOiAnbGVmdEhpcEpvaW50JywgICBcbiAgICAnbG93ZXJMZWZ0TGVnJyA6ICdsZWZ0S25lZUpvaW50JywgIFxuICAgICd1cHBlclJpZ2h0TGVnJzogJ3JpZ2h0SGlwSm9pbnQnLCBcbiAgICAnbG93ZXJSaWdodExlZyc6ICdyaWdodEtuZWVKb2ludCcsIFxuICAgICdwZWx2aXMnICAgICAgIDogJ3NwaW5lSm9pbnQnLCAgICAgXG4gICAgJ3VwcGVyQm9keScgICAgOiAnc3BpbmVKb2ludCdcbiAgfVxuXG4gIHZhciBqb2ludE5hbWUgPSBqb2ludFttdXNjbGVOYW1lXVxuICB2YXIgam9pbnRTdGF0ZSA9IHRoaXMudHVybkhpc3RvcnlbdGhpcy50dXJuSGlzdG9yeS5sZW5ndGgtMV1bam9pbnROYW1lXVxuICB2YXIgYWN0aW9uXG5cbiAgaWYoam9pbnRTdGF0ZSA9PT0gJ2V4cGFuZCcpIGFjdGlvbiA9ICdjb250cmFjdCdcbiAgZWxzZSBpZihqb2ludFN0YXRlID09PSAnY29udHJhY3QnKSBhY3Rpb24gPSAncmVsYXgnXG4gIGVsc2UgaWYoam9pbnRTdGF0ZSA9PT0gJ3JlbGF4JykgYWN0aW9uID0gJ2V4cGFuZCdcbiAgZWxzZSBhY3Rpb24gPSAnZXhwYW5kJ1xuXG4gIGNvbnNvbGUubG9nKGFjdGlvbiwgam9pbnROYW1lKVxuXG4gIHRoaXMubmV3QWN0aW9uKHtcbiAgXHRqb2ludE5hbWU6IGpvaW50TmFtZSwgXG4gIFx0dHlwZTogYWN0aW9uXG4gIH0pXG5cbiAgdGV4dHVyZXMgPSB7XG4gICAgJ2V4cGFuZCcgIDogJ3JlZHNxdWFyZScsXG4gICAgJ2NvbnRyYWN0JzogJ2JsdWVzcXVhcmUnLFxuICAgICdyZWxheCcgICA6ICd3aGl0ZXNxdWFyZSdcbiAgfVxuXG4gIHRoaXMuc2hhZG93Q2xvbmUuY2hpbGRyZW4uZmlsdGVyKGZ1bmN0aW9uIChwYXJ0KSB7XG4gICAgcmV0dXJuIHBhcnQubmFtZSA9PT0gbXVzY2xlTmFtZVxuICB9KVswXS5sb2FkVGV4dHVyZSh0ZXh0dXJlc1thY3Rpb25dKVxuXG4gIHRoaXMuaXNSZXNldGluZ1BsYXliYWNrID0gdHJ1ZVxufVxuXG5QbGF5ZXIucHJvdG90eXBlLnNldENvbnRyb2xsZXIgPSBmdW5jdGlvbihjb250cm9sbGVyKSB7XG4gIHRoaXMuY29udHJvbGxlciA9IGNvbnRyb2xsZXJcblxuICBpZihjb250cm9sbGVyID09PSAnZHVtbXknKSB7XG4gICAgdGhpcy5pc0FsbG93aW5nSW5wdXQgPSBmYWxzZVxuICAgIHRoaXMuaXNSZWFkeSA9IHRydWVcbiAgfVxuICBpZihjb250cm9sbGVyID09PSAnbmV0d29yaycpIHtcbiAgICB0aGlzLmlzQWxsb3dpbmdJbnB1dCA9IGZhbHNlXG4gIH1cbiAgaWYoY29udHJvbGxlciA9PT0gJ21lJykge1xuXG4gIH1cblxufVxuXG5QbGF5ZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMudHVybkhpc3RvcnkgPSBbXVxuICB0aGlzLmN1cnJlbnRQb3NpdGlvbiA9IFtdIFxufVxuXG5QbGF5ZXIucHJvdG90eXBlLnJlc2V0UGxheWJhY2sgPSBmdW5jdGlvbiAoKSB7XG4gIGlmKHRoaXMuaXNSZXNldGluZ1BsYXliYWNrID09PSB0cnVlKSB7XG4gICAgdGhpcy5pc1Jlc2V0aW5nUGxheWJhY2sgPSBmYWxzZVxuICAgIHJldHVybiB0cnVlXG4gIH1cbiAgZWxzZSByZXR1cm4gZmFsc2Vcbn1cblxuUGxheWVyLnByb3RvdHlwZS5yZWFkeSA9IGZ1bmN0aW9uKCkge1xuICBpZih0aGlzLmlzUmVhZHkgPT09IHRydWUpIHtcbiAgICB0aGlzLmlzUmVhZHkgPSBmYWxzZVxuICAgIHJldHVybiB0cnVlXG4gIH1cbiAgZWxzZSByZXR1cm4gZmFsc2Vcbn1cblxuLy8gLXRvZG9cblBsYXllci5wcm90b3R5cGUubWV0aG9kMCA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy5uZXdUdXJuKClcbiAgdGhpcy5zYXZlUG9zaXRpb24oKVxuICB0aGlzLnNoYWRvdygpXG59XG4vLyAtdG9kb1xuUGxheWVyLnByb3RvdHlwZS5tZXRob2QxID0gZnVuY3Rpb24gKCkge1xuXHR0aGlzLnJhZ2RvbGwucmVsYXhBbGwoKVxuICB0aGlzLm5ld1R1cm4oKVxuICB0aGlzLnNhdmVQb3NpdGlvbigpXG4gIHRoaXMuc2hhZG93KClcbn1cbi8vIC10b2RvXG5QbGF5ZXIucHJvdG90eXBlLm1ldGhvZDIgPSBmdW5jdGlvbiAoKSB7XG5cdHRoaXMubG9hZFBvc2l0aW9uKClcbiAgdGhpcy5yYWdkb2xsLnJlbGF4QWxsKClcbiAgdGhpcy5leGVjdXRlTW92ZXModGhpcy50dXJuSGlzdG9yeVt0aGlzLnR1cm5IaXN0b3J5Lmxlbmd0aC0xXSwgMC41KVxufVxuXG5cbm1vZHVsZS5leHBvcnRzID0gUGxheWVyIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihnYW1lLCBvZmZzZXRYLCBvZmZzZXRZKSB7XG5cbiAgdmFyIEZPUkNFID0gMTAwMDBcbiAgdmFyIE0gPSAxMDAgLy8gc2NhbGVcblxuICB2YXIgYm9keVNwcml0ZXMgPSB7fVxuICB2YXIgYm9keUpvaW50cyA9IHt9XG4gIHZhciBib2R5UGFydHMgPSB7fVxuXG4gIC8vIG5vcm1hbGl6ZWQgc2NhbGVzXG4gIHZhciBzaXplcyA9IHt9XG4gIHNpemVzLnNob3VsZGVyc0Rpc3RhbmNlID0gMC40XG4gIHNpemVzLnVwcGVyQXJtTGVuZ3RoID0gMC41XG4gIHNpemVzLmxvd2VyQXJtTGVuZ3RoID0gMC41XG4gIHNpemVzLnVwcGVyQXJtU2l6ZSA9IDAuMlxuICBzaXplcy5sb3dlckFybVNpemUgPSAwLjJcbiAgc2l6ZXMubmVja0xlbmd0aCA9IDAuMVxuICBzaXplcy5oZWFkUmFkaXVzID0gMC4xNVxuICBzaXplcy51cHBlckJvZHlMZW5ndGggPSAwLjZcbiAgc2l6ZXMucGVsdmlzTGVuZ3RoID0gMC40XG4gIHNpemVzLnVwcGVyTGVnTGVuZ3RoID0gMC42XG4gIHNpemVzLnVwcGVyTGVnU2l6ZSA9IDAuMlxuICBzaXplcy5sb3dlckxlZ1NpemUgPSAwLjJcbiAgc2l6ZXMubG93ZXJMZWdMZW5ndGggPSAwLjVcblxuICAvLyBhcHBseSBzY2FsZSBtdWx0aXBsaWVyXG4gIE9iamVjdC5rZXlzKHNpemVzKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgIHNpemVzW2tleV0gKj0gTVxuICB9KVxuXG4gIC8vIExvd2VyIGxlZ3NcbiAgYm9keVBhcnRzLmxvd2VyTGVmdExlZyA9IHtcbiAgICB4OiAtc2l6ZXMuc2hvdWxkZXJzRGlzdGFuY2UgLyAyLFxuICAgIHk6IHNpemVzLmxvd2VyTGVnTGVuZ3RoIC8gMixcbiAgICB3OiBzaXplcy5sb3dlckxlZ1NpemUsXG4gICAgaDogc2l6ZXMubG93ZXJMZWdMZW5ndGgsXG4gICAgbWFzczogMC4yXG4gIH1cbiAgYm9keVBhcnRzLmxvd2VyUmlnaHRMZWcgPSB7XG4gICAgeDogc2l6ZXMuc2hvdWxkZXJzRGlzdGFuY2UgLyAyLFxuICAgIHk6IHNpemVzLmxvd2VyTGVnTGVuZ3RoIC8gMixcbiAgICB3OiBzaXplcy5sb3dlckxlZ1NpemUsXG4gICAgaDogc2l6ZXMubG93ZXJMZWdMZW5ndGgsXG4gICAgbWFzczogMC4yXG4gIH1cbiAgLy8gVXBwZXIgbGVnc1xuICBib2R5UGFydHMudXBwZXJMZWZ0TGVnID0ge1xuICAgIHg6IC1zaXplcy5zaG91bGRlcnNEaXN0YW5jZSAvIDIsXG4gICAgeTogYm9keVBhcnRzLmxvd2VyTGVmdExlZy55ICsgc2l6ZXMubG93ZXJMZWdMZW5ndGggLyAyICsgc2l6ZXMudXBwZXJMZWdMZW5ndGggLyAyLFxuICAgIHc6IHNpemVzLnVwcGVyTGVnU2l6ZSxcbiAgICBoOiBzaXplcy51cHBlckxlZ0xlbmd0aCxcbiAgICBtYXNzOiAxXG4gIH1cbiAgYm9keVBhcnRzLnVwcGVyUmlnaHRMZWcgPSB7XG4gICAgeDogc2l6ZXMuc2hvdWxkZXJzRGlzdGFuY2UgLyAyLFxuICAgIHk6IGJvZHlQYXJ0cy5sb3dlclJpZ2h0TGVnLnkgKyBzaXplcy5sb3dlckxlZ0xlbmd0aCAvIDIgKyBzaXplcy51cHBlckxlZ0xlbmd0aCAvIDIsXG4gICAgdzogc2l6ZXMudXBwZXJMZWdTaXplLFxuICAgIGg6IHNpemVzLnVwcGVyTGVnTGVuZ3RoLFxuICAgIG1hc3M6IDFcbiAgfVxuICAvLyBQZWx2aXNcbiAgYm9keVBhcnRzLnBlbHZpcyA9IHtcbiAgICB4OiAwLFxuICAgIHk6IGJvZHlQYXJ0cy51cHBlckxlZnRMZWcueSArIHNpemVzLnVwcGVyTGVnTGVuZ3RoIC8gMiArIHNpemVzLnBlbHZpc0xlbmd0aCAvIDIsXG4gICAgdzogc2l6ZXMuc2hvdWxkZXJzRGlzdGFuY2UsXG4gICAgaDogc2l6ZXMucGVsdmlzTGVuZ3RoLFxuICAgIG1hc3M6IDFcbiAgfVxuICAvLyBVcHBlciBib2R5XG4gIGJvZHlQYXJ0cy51cHBlckJvZHkgPSB7XG4gICAgeDogMCxcbiAgICB5OiBib2R5UGFydHMucGVsdmlzLnkgKyBzaXplcy5wZWx2aXNMZW5ndGggLyAyICsgc2l6ZXMudXBwZXJCb2R5TGVuZ3RoIC8gMixcbiAgICB3OiBzaXplcy5zaG91bGRlcnNEaXN0YW5jZSxcbiAgICBoOiBzaXplcy51cHBlckJvZHlMZW5ndGgsXG4gICAgbWFzczogMVxuICB9XG4gIC8vIEhlYWRcbiAgYm9keVBhcnRzLmhlYWQgPSB7XG4gICAgeDogMCxcbiAgICB5OiBib2R5UGFydHMudXBwZXJCb2R5LnkgKyBzaXplcy51cHBlckJvZHlMZW5ndGggLyAyICsgc2l6ZXMuaGVhZFJhZGl1cyArIHNpemVzLm5lY2tMZW5ndGgsXG4gICAgdzogc2l6ZXMuaGVhZFJhZGl1cyAqIDIsXG4gICAgaDogc2l6ZXMuaGVhZFJhZGl1cyAqIDIsXG4gICAgbWFzczogMVxuICB9XG4gIC8vIFVwcGVyIGFybXNcbiAgYm9keVBhcnRzLnVwcGVyTGVmdEFybSA9IHtcbiAgICB4OiAtc2l6ZXMuc2hvdWxkZXJzRGlzdGFuY2UgLyAyIC0gc2l6ZXMudXBwZXJBcm1MZW5ndGggLyAyLFxuICAgIHk6IGJvZHlQYXJ0cy51cHBlckJvZHkueSArIHNpemVzLnVwcGVyQm9keUxlbmd0aCAvIDIsXG4gICAgdzogc2l6ZXMudXBwZXJBcm1MZW5ndGgsXG4gICAgaDogc2l6ZXMudXBwZXJBcm1TaXplLFxuICAgIG1hc3M6IDFcbiAgfVxuICBib2R5UGFydHMudXBwZXJSaWdodEFybSA9IHtcbiAgICB4OiBzaXplcy5zaG91bGRlcnNEaXN0YW5jZSAvIDIgKyBzaXplcy51cHBlckFybUxlbmd0aCAvIDIsXG4gICAgeTogYm9keVBhcnRzLnVwcGVyQm9keS55ICsgc2l6ZXMudXBwZXJCb2R5TGVuZ3RoIC8gMixcbiAgICB3OiBzaXplcy51cHBlckFybUxlbmd0aCxcbiAgICBoOiBzaXplcy51cHBlckFybVNpemUsXG4gICAgbWFzczogMVxuICB9XG4gIC8vIGxvd2VyIGFybXNcbiAgYm9keVBhcnRzLmxvd2VyTGVmdEFybSA9IHtcbiAgICB4OiBib2R5UGFydHMudXBwZXJMZWZ0QXJtLnggLSBzaXplcy5sb3dlckFybUxlbmd0aCAvIDIgLSBzaXplcy51cHBlckFybUxlbmd0aCAvIDIsXG4gICAgeTogYm9keVBhcnRzLnVwcGVyTGVmdEFybS55LFxuICAgIHc6IHNpemVzLmxvd2VyQXJtTGVuZ3RoLFxuICAgIGg6IHNpemVzLmxvd2VyQXJtU2l6ZSxcbiAgICBtYXNzOiAxXG4gIH1cbiAgYm9keVBhcnRzLmxvd2VyUmlnaHRBcm0gPSB7XG4gICAgeDogYm9keVBhcnRzLnVwcGVyUmlnaHRBcm0ueCArIHNpemVzLmxvd2VyQXJtTGVuZ3RoIC8gMiArIHNpemVzLnVwcGVyQXJtTGVuZ3RoIC8gMixcbiAgICB5OiBib2R5UGFydHMudXBwZXJSaWdodEFybS55LFxuICAgIHc6IHNpemVzLmxvd2VyQXJtTGVuZ3RoLFxuICAgIGg6IHNpemVzLmxvd2VyQXJtU2l6ZSxcbiAgICBtYXNzOiAxXG4gIH1cbiAgLy8gTmVja1xuICBib2R5Sm9pbnRzLm5lY2tKb2ludCA9IHtcbiAgICBhOiAnaGVhZCcsXG4gICAgYjogJ3VwcGVyQm9keScsXG4gICAgcGl2b3RfYTogWzAsIC1zaXplcy5oZWFkUmFkaXVzIC0gc2l6ZXMubmVja0xlbmd0aCAvIDJdLFxuICAgIHBpdm90X2I6IFswLCBzaXplcy51cHBlckJvZHlMZW5ndGggLyAyXSxcbiAgICBsaW1pdHM6IFstTWF0aC5QSS8xMiwgTWF0aC5QSS8xMl1cbiAgfVxuICAvLyBLbmVlc1xuICBib2R5Sm9pbnRzLmxlZnRLbmVlSm9pbnQgPSB7XG4gICAgYTogJ2xvd2VyTGVmdExlZycsXG4gICAgYjogJ3VwcGVyTGVmdExlZycsXG4gICAgcGl2b3RfYTogWzAsIHNpemVzLmxvd2VyTGVnTGVuZ3RoIC8gMl0sXG4gICAgcGl2b3RfYjogWzAsIC1zaXplcy51cHBlckxlZ0xlbmd0aCAvIDJdLFxuICAgIGxpbWl0czogWy1NYXRoLlBJLzUsIE1hdGguUEkvNV1cbiAgfVxuICBib2R5Sm9pbnRzLnJpZ2h0S25lZUpvaW50ID0ge1xuICAgIGE6ICdsb3dlclJpZ2h0TGVnJyxcbiAgICBiOiAndXBwZXJSaWdodExlZycsXG4gICAgcGl2b3RfYTogWzAsIHNpemVzLmxvd2VyTGVnTGVuZ3RoIC8gMl0sXG4gICAgcGl2b3RfYjogWzAsIC1zaXplcy51cHBlckxlZ0xlbmd0aCAvIDJdLFxuICAgIGxpbWl0czogWy1NYXRoLlBJLzUsIE1hdGguUEkvNV1cbiAgfVxuICAvLyBIaXBzXG4gIGJvZHlKb2ludHMubGVmdEhpcEpvaW50ID0ge1xuICAgIGE6ICd1cHBlckxlZnRMZWcnLFxuICAgIGI6ICdwZWx2aXMnLFxuICAgIHBpdm90X2E6IFswLCBzaXplcy51cHBlckxlZ0xlbmd0aCAvIDJdLFxuICAgIHBpdm90X2I6IFstc2l6ZXMuc2hvdWxkZXJzRGlzdGFuY2UgLyAyLCAtc2l6ZXMucGVsdmlzTGVuZ3RoIC8gMl0sXG4gICAgbGltaXRzOiBbLU1hdGguUEkvNiwgTWF0aC5QSS80XVxuICB9XG4gIGJvZHlKb2ludHMucmlnaHRIaXBKb2ludCA9IHtcbiAgICBhOiAndXBwZXJSaWdodExlZycsXG4gICAgYjogJ3BlbHZpcycsXG4gICAgcGl2b3RfYTogWzAsIHNpemVzLnVwcGVyTGVnTGVuZ3RoIC8gMl0sXG4gICAgcGl2b3RfYjogW3NpemVzLnNob3VsZGVyc0Rpc3RhbmNlIC8gMiwgLXNpemVzLnBlbHZpc0xlbmd0aCAvIDJdLFxuICAgIGxpbWl0czogWy1NYXRoLlBJLzQsIE1hdGguUEkvNl1cbiAgfVxuICAgIC8vIFNwaW5lXG4gIGJvZHlKb2ludHMuc3BpbmVKb2ludCA9IHtcbiAgICBhOiAncGVsdmlzJyxcbiAgICBiOiAndXBwZXJCb2R5JyxcbiAgICBwaXZvdF9hOiBbMCwgc2l6ZXMucGVsdmlzTGVuZ3RoIC8gMl0sXG4gICAgcGl2b3RfYjogWzAsIC1zaXplcy51cHBlckJvZHlMZW5ndGggLyAyXSxcbiAgICBsaW1pdHM6IFstTWF0aC5QSS81LCBNYXRoLlBJLzVdXG4gIH1cbiAgICAvLyBTaG91bGRlcnNcbiAgYm9keUpvaW50cy5sZWZ0U2hvdWxkZXIgPSB7XG4gICAgYTogJ3VwcGVyQm9keScsXG4gICAgYjogJ3VwcGVyTGVmdEFybScsXG4gICAgcGl2b3RfYTogWy1zaXplcy5zaG91bGRlcnNEaXN0YW5jZSAvIDIsIHNpemVzLnVwcGVyQm9keUxlbmd0aCAvIDJdLFxuICAgIHBpdm90X2I6IFtzaXplcy51cHBlckFybUxlbmd0aCAvIDIsIDBdLFxuICAgIGxpbWl0czogWy1NYXRoLlBJLzIsIE1hdGguUEkvMl1cbiAgfVxuICBib2R5Sm9pbnRzLnJpZ2h0U2hvdWxkZXIgPSB7XG4gICAgYTogJ3VwcGVyQm9keScsXG4gICAgYjogJ3VwcGVyUmlnaHRBcm0nLFxuICAgIHBpdm90X2E6IFtzaXplcy5zaG91bGRlcnNEaXN0YW5jZSAvIDIsIHNpemVzLnVwcGVyQm9keUxlbmd0aCAvIDJdLFxuICAgIHBpdm90X2I6IFstc2l6ZXMudXBwZXJBcm1MZW5ndGggLyAyLCAwXSxcbiAgICBsaW1pdHM6IFstTWF0aC5QSS8yLCBNYXRoLlBJLzJdXG4gIH1cbiAgICAvLyBFbGJvd3NcbiAgYm9keUpvaW50cy5sZWZ0RWxib3dKb2ludCA9IHtcbiAgICBhOiAnbG93ZXJMZWZ0QXJtJyxcbiAgICBiOiAndXBwZXJMZWZ0QXJtJyxcbiAgICBwaXZvdF9hOiBbc2l6ZXMubG93ZXJBcm1MZW5ndGggLyAyLCAwXSxcbiAgICBwaXZvdF9iOiBbLXNpemVzLnVwcGVyQXJtTGVuZ3RoIC8gMiwgMF0sXG4gICAgbGltaXRzOiBbLU1hdGguUEkvNCwgTWF0aC5QSS80XVxuICB9XG4gIGJvZHlKb2ludHMucmlnaHRFbGJvd0pvaW50ID0ge1xuICAgIGE6ICdsb3dlclJpZ2h0QXJtJyxcbiAgICBiOiAndXBwZXJSaWdodEFybScsXG4gICAgcGl2b3RfYTogWy1zaXplcy5sb3dlckFybUxlbmd0aCAvIDIsIDBdLFxuICAgIHBpdm90X2I6IFtzaXplcy51cHBlckFybUxlbmd0aCAvIDIsIDBdLFxuICAgIGxpbWl0czogWy1NYXRoLlBJLzQsIE1hdGguUEkvNF1cbiAgfVxuXG4gIC8vXG5cbiAgdmFyIHJhZ2RvbGwgPSBnYW1lLmFkZC5ncm91cChudWxsLCBudWxsLCAncmFnZG9sbCcpXG5cbiAgLyoqXG4gICAqIGNyZWF0ZSBtdXNjbGVzXG4gICAqL1xuICBPYmplY3Qua2V5cyhib2R5UGFydHMpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG5cbiAgICB2YXIgeCA9IGJvZHlQYXJ0c1trZXldLnggKyBvZmZzZXRYXG4gICAgdmFyIHkgPSBib2R5UGFydHNba2V5XS55ICsgb2Zmc2V0WVxuICAgIHZhciB3ID0gYm9keVBhcnRzW2tleV0ud1xuICAgIHZhciBoID0gYm9keVBhcnRzW2tleV0uaFxuXG4gICAgdmFyIHBhcnQgPSByYWdkb2xsLmNyZWF0ZSh4LCB5LCAnd2hpdGVzcXVhcmUnKVxuXG4gICAgcGFydC53aWR0aCA9IHdcbiAgICBwYXJ0LmhlaWdodCA9IGhcblxuICAgIHBhcnQubmFtZSA9IGtleVxuXG4gICAgZ2FtZS5waHlzaWNzLnAyLmVuYWJsZShwYXJ0KVxuXG4gICAgYm9keVNwcml0ZXNba2V5XSA9IHBhcnRcbiAgfSlcblxuICAvKipcbiAgICogY3JlYXRlIGpvaW50c1xuICAgKi9cbiAgT2JqZWN0LmtleXMoYm9keUpvaW50cykuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcblxuICAgIHZhciBqb2ludCA9IGJvZHlKb2ludHNba2V5XVxuICAgIFxuICAgIHZhciBjb25zdHJhaW50ID0gZ2FtZS5waHlzaWNzLnAyLmNyZWF0ZVJldm9sdXRlQ29uc3RyYWludFxuICAgICAgKFxuICAgICAgICBib2R5U3ByaXRlc1tqb2ludC5hXSwgXG4gICAgICAgIGpvaW50LnBpdm90X2EsIFxuICAgICAgICBib2R5U3ByaXRlc1tqb2ludC5iXSwgXG4gICAgICAgIGpvaW50LnBpdm90X2IsIFxuICAgICAgICBGT1JDRVxuICAgICAgKVxuXG4gICAgY29uc3RyYWludC5zZXRMaW1pdHMoam9pbnQubGltaXRzWzBdLCBqb2ludC5saW1pdHNbMV0pXG4gICAgY29uc3RyYWludC5jb2xsaWRlQ29ubmVjdGVkID0gZmFsc2VcblxuICAgIGlmKCFyYWdkb2xsLmpvaW50cykgcmFnZG9sbC5qb2ludHMgPSB7fVxuICAgIHJhZ2RvbGwuam9pbnRzW2tleV0gPSBjb25zdHJhaW50XG4gIH0pXG5cbiAgLyoqXG4gICAqIGVuYWJsZSBqb2ludCBtb3RvclxuICAgKiBcbiAgICogQG1ldGhvZCBmbGV4XG4gICAqIEBwYXJhbSB7U3RyaW5nfSBqb2ludE5hbWVcbiAgICovXG4gIHJhZ2RvbGwuZmxleCA9IGZ1bmN0aW9uIChqb2ludE5hbWUpIHtcbiAgICB2YXIgam9pbnQgPSB0aGlzLmpvaW50c1tqb2ludE5hbWVdXG4gICAgam9pbnQuZW5hYmxlTW90b3IoKVxuICAgIGpvaW50LnNldE1vdG9yU3BlZWQoMylcbiAgfVxuXG4gIC8qKlxuICAgKiBlbmFibGUgam9pbnQgbW90b3JcbiAgICogXG4gICAqIEBtZXRob2QgY29udHJhY3RcbiAgICogQHBhcmFtIHtTdHJpbmd9IGpvaW50TmFtZVxuICAgKi9cbiAgcmFnZG9sbC5jb250cmFjdCA9IGZ1bmN0aW9uIChqb2ludE5hbWUpIHtcbiAgICB2YXIgam9pbnQgPSB0aGlzLmpvaW50c1tqb2ludE5hbWVdXG4gICAgam9pbnQuZW5hYmxlTW90b3IoKVxuICAgIGpvaW50LnNldE1vdG9yU3BlZWQoLTMpXG4gIH1cblxuICAvKipcbiAgICogZGlzYWJsaW5nIG1vdG9yIG9uIGFsbCBqb2ludHNcbiAgICpcbiAgICogQG1ldGhvZCByZWxheEFsbFxuICAgKi9cbiAgcmFnZG9sbC5yZWxheEFsbCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBfdGhpcyA9IHRoaXNcbiAgICBPYmplY3Qua2V5cyhfdGhpcy5qb2ludHMpLmZvckVhY2goZnVuY3Rpb24oam9pbnQpIHtcbiAgICAgIF90aGlzLnJlbGF4KGpvaW50KVxuICAgIH0pXG4gIH1cblxuICAvKipcbiAgICogZGlzYWJsZSBqb2ludCBtb3RvclxuICAgKlxuICAgKiBAbWV0aG9kIHJlbGF4XG4gICAqIEBwYXJhbSB7U3RyaW5nfSBqb2ludE5hbWVcbiAgICovXG4gIHJhZ2RvbGwucmVsYXggPSBmdW5jdGlvbihqb2ludE5hbWUpIHtcbiAgICB2YXIgam9pbnQgPSByYWdkb2xsLmpvaW50c1tqb2ludE5hbWVdXG4gICAgam9pbnQuZGlzYWJsZU1vdG9yKClcbiAgfVxuXG4gIHJldHVybiByYWdkb2xsXG59IiwiXG52YXIgcHJvcGVydGllcyA9IHJlcXVpcmUoJy4vcHJvcGVydGllcycpXG5cbnZhciBzdGF0ZXMgPSB7IFxuXHRib290OiByZXF1aXJlKCcuL3N0YXRlcy9ib290LmpzJyksXG5cdHByZWxvYWRlcjogcmVxdWlyZSgnLi9zdGF0ZXMvcHJlbG9hZGVyLmpzJyksXG5cdG1haW5tZW51OiByZXF1aXJlKCcuL3N0YXRlcy9tYWlubWVudS5qcycpLFxuXHRzaW5nbGVwbGF5ZXJtZW51OiByZXF1aXJlKCcuL3N0YXRlcy9zaW5nbGVwbGF5ZXJtZW51LmpzJyksXG5cdG11bHRpcGxheWVybWVudTogcmVxdWlyZSgnLi9zdGF0ZXMvbXVsdGlwbGF5ZXJtZW51LmpzJyksXG5cdHNldHRpbmdzbWVudTogcmVxdWlyZSgnLi9zdGF0ZXMvc2V0dGluZ3NtZW51LmpzJyksXG5cdHRyYWluOiByZXF1aXJlKCcuL3N0YXRlcy90cmFpbi5qcycpLFxuXHRxdWlja21hdGNoOiByZXF1aXJlKCcuL3N0YXRlcy9xdWlja21hdGNoLmpzJylcbn1cblxud2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuXG5cdHZhciBQaGFzZXIgPSB3aW5kb3cuUGhhc2VyIC8vIGhhY2tcblx0dmFyIGlvID0gd2luZG93LmlvIC8vIGhhY2tcblxuXHR2YXIgZ2FtZSA9IG5ldyBQaGFzZXIuR2FtZShwcm9wZXJ0aWVzLnNpemUueCwgcHJvcGVydGllcy5zaXplLnksIFBoYXNlci5BVVRPLCAnZ2FtZScpXG5cblx0Z2FtZS5zdGF0ZS5hZGQoJ2Jvb3QnLCBzdGF0ZXMuYm9vdChnYW1lKSlcblx0Z2FtZS5zdGF0ZS5hZGQoJ3ByZWxvYWRlcicsIHN0YXRlcy5wcmVsb2FkZXIoZ2FtZSkpXG5cdGdhbWUuc3RhdGUuYWRkKCdtYWlubWVudScsIHN0YXRlcy5tYWlubWVudShnYW1lKSlcblx0Z2FtZS5zdGF0ZS5hZGQoJ3NpbmdsZXBsYXllcm1lbnUnLCBzdGF0ZXMuc2luZ2xlcGxheWVybWVudShnYW1lKSlcblx0Z2FtZS5zdGF0ZS5hZGQoJ211bHRpcGxheWVybWVudScsIHN0YXRlcy5tdWx0aXBsYXllcm1lbnUoZ2FtZSkpXG5cdGdhbWUuc3RhdGUuYWRkKCdzZXR0aW5nc21lbnUnLCBzdGF0ZXMuc2V0dGluZ3NtZW51KGdhbWUpKVxuXHRnYW1lLnN0YXRlLmFkZCgndHJhaW4nLCBzdGF0ZXMudHJhaW4oZ2FtZSkpXG5cdGdhbWUuc3RhdGUuYWRkKCdxdWlja21hdGNoJywgc3RhdGVzLnF1aWNrbWF0Y2goZ2FtZSkpXG5cblx0Z2FtZS5zdGF0ZS5zdGFydCgnYm9vdCcpXG59IiwidmFyIG5wbVByb3BlcnRpZXMgPSByZXF1aXJlKCcuLi8uLi8uLi9wYWNrYWdlLmpzb24nKVxuXG5tb2R1bGUuZXhwb3J0cyA9IHsgXG5cbiAgdGl0bGU6ICdQaGFzZXIgSlMgQm9pbGVycGxhdGUnLFxuXG4gIGRlc2NyaXB0aW9uOiBucG1Qcm9wZXJ0aWVzLmRlc2NyaXB0aW9uLFxuXG4gIHBvcnQ6IDMwMTcsXG5cbiAgbGl2ZVJlbG9hZFBvcnQ6IDMwMTgsXG5cbiAgc2hvd1N0YXRzOiB0cnVlLFxuXG4gIHNpemU6IHsgXG4gICAgeDogODAwLFxuICAgIHk6IDYwMFxuICB9LCBcbiAgXG4gIGFuYWx5dGljc0lkOiAnJ1xufVxuIiwidmFyIFN0YXRzID0gcmVxdWlyZSgnU3RhdHMnKVxuICAsIHByb3BlcnRpZXMgPSByZXF1aXJlKCcuLi9wcm9wZXJ0aWVzJylcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihnYW1lKSB7XG5cbiAgLy8gRlBTIGNvdW50ZXJcbiAgZnVuY3Rpb24gYWRkU3RhdHMoKSB7XG4gICAgdmFyIHN0YXRzID0gbmV3IFN0YXRzKClcbiAgICBzdGF0cy5zZXRNb2RlKDApXG4gICAgc3RhdHMuZG9tRWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSdcbiAgICBzdGF0cy5kb21FbGVtZW50LnN0eWxlLmxlZnQgPSAnMHB4J1xuICAgIHN0YXRzLmRvbUVsZW1lbnQuc3R5bGUudG9wID0gJzBweCdcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHN0YXRzLmRvbUVsZW1lbnQpXG4gICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgc3RhdHMuYmVnaW4oKVxuICAgICAgc3RhdHMuZW5kKClcbiAgICB9LCAxMDAwIC8gNjApXG4gIH1cblxuICB2YXIgYm9vdCA9IHt9XG5cbiAgYm9vdC5jcmVhdGUgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICBpZiAocHJvcGVydGllcy5zaG93U3RhdHMpIGFkZFN0YXRzKClcblxuICAgIGdhbWUuc2NhbGUucGFnZUFsaWduSG9yaXpvbnRhbGx5ID0gdHJ1ZVxuICAgIGdhbWUuc2NhbGUucGFnZUFsaWduVmVydGljYWxseSA9IHRydWVcbiAgICBnYW1lLnNjYWxlLnJlZnJlc2goKVxuXG4gICAgZ2FtZS5zdGF0ZS5zdGFydCgncHJlbG9hZGVyJylcbiAgfVxuXG4gIHJldHVybiBib290XG59XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGdhbWUpIHtcblxuICB2YXIgZ2FtZVN0YXRlID0ge31cblxuICBnYW1lU3RhdGUuY3JlYXRlID0gZnVuY3Rpb24gKCkge1xuXG4gICAgdmFyIGxvZ28gPSBnYW1lLmFkZC5zcHJpdGUoZ2FtZS53b3JsZC5jZW50ZXJYLCAyMDAsICdsb2dvJylcbiAgICBsb2dvLmFuY2hvci5zZXRUbygwLjUsIDAuNSlcblxuICAgIHZhciBzdHlsZSA9IHsgZm9udDogJzQwcHggQXJpYWwnLCBmaWxsOiAnI2ZmZmZmZicsIGFsaWduOiAnY2VudGVyJ31cblxuICAgIHZhciBzaW5nbGVQbGF5ZXJCdXR0b24gPSBnYW1lLmFkZC50ZXh0KGdhbWUud29ybGQuY2VudGVyWCwgNDUwLCAnc2luZ2xlIHBsYXllcicsIHN0eWxlKVxuICAgIHNpbmdsZVBsYXllckJ1dHRvbi5hbmNob3Iuc2V0VG8oMC41LCAwLjUpXG4gICAgc2luZ2xlUGxheWVyQnV0dG9uLmlucHV0RW5hYmxlZCA9IHRydWVcbiAgICBzaW5nbGVQbGF5ZXJCdXR0b24uZXZlbnRzLm9uSW5wdXREb3duLmFkZChmdW5jdGlvbigpIHtcblx0XHRcdGdhbWUuc3RhdGUuc3RhcnQoJ3NpbmdsZXBsYXllcm1lbnUnKVxuICAgIH0pXG5cbiAgICB2YXIgbXVsdGlQbGF5ZXJCdXR0b24gPSBnYW1lLmFkZC50ZXh0KGdhbWUud29ybGQuY2VudGVyWCwgNTAwLCAnbXVsdGkgcGxheWVyJywgc3R5bGUpXG4gICAgbXVsdGlQbGF5ZXJCdXR0b24uYW5jaG9yLnNldFRvKDAuNSwgMC41KVxuICAgIG11bHRpUGxheWVyQnV0dG9uLmlucHV0RW5hYmxlZCA9IHRydWVcbiAgICBtdWx0aVBsYXllckJ1dHRvbi5ldmVudHMub25JbnB1dERvd24uYWRkKGZ1bmN0aW9uKCkge1xuXHRcdFx0Z2FtZS5zdGF0ZS5zdGFydCgnbXVsdGlwbGF5ZXJtZW51JylcbiAgICB9KVxuXG4gICAgdmFyIHNldHRpbmdzQnV0dG9uID0gZ2FtZS5hZGQudGV4dChnYW1lLndvcmxkLmNlbnRlclgsIDU1MCwgJ3NldHRpbmdzJywgc3R5bGUpXG4gICAgc2V0dGluZ3NCdXR0b24uYW5jaG9yLnNldFRvKDAuNSwgMC41KVxuICAgIHNldHRpbmdzQnV0dG9uLmlucHV0RW5hYmxlZCA9IHRydWVcbiAgICBzZXR0aW5nc0J1dHRvbi5ldmVudHMub25JbnB1dERvd24uYWRkKGZ1bmN0aW9uKCkge1xuICAgIFx0Z2FtZS5zdGF0ZS5zdGFydCgnc2V0dGluZ3NtZW51JylcbiAgICB9KVxuXG4gIH1cblxuICBnYW1lU3RhdGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gIFx0XG4gIH1cblxuICByZXR1cm4gZ2FtZVN0YXRlXG59XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGdhbWUpIHtcblxuICB2YXIgZ2FtZVN0YXRlID0ge31cblxuICBnYW1lU3RhdGUuY3JlYXRlID0gZnVuY3Rpb24gKCkge1xuXG4gIFx0dmFyIHN0eWxlID0geyBmb250OiAnNDBweCBBcmlhbCcsIGZpbGw6ICcjZmZmZmZmJywgYWxpZ246ICdjZW50ZXInfVxuICBcdHZhciBtYWluTWVudUJ1dHRvbiA9IGdhbWUuYWRkLnRleHQoMTAwLCA1MCwgJ2JhY2snLCBzdHlsZSlcbiAgICBtYWluTWVudUJ1dHRvbi5hbmNob3Iuc2V0VG8oMC41LCAwLjUpXG4gICAgbWFpbk1lbnVCdXR0b24uaW5wdXRFbmFibGVkID0gdHJ1ZVxuICAgIG1haW5NZW51QnV0dG9uLmV2ZW50cy5vbklucHV0RG93bi5hZGQoZnVuY3Rpb24oKSB7XG5cdFx0XHRnYW1lLnN0YXRlLnN0YXJ0KCdtYWlubWVudScpXG4gICAgfSlcblxuICAgIHZhciB0cmFpbiA9IGdhbWUuYWRkLnRleHQoZ2FtZS53b3JsZC5jZW50ZXJYLCAzMDAsICdxdWlja21hdGNoJywgc3R5bGUpXG4gICAgdHJhaW4uYW5jaG9yLnNldFRvKDAuNSwgMC41KVxuICAgIHRyYWluLmlucHV0RW5hYmxlZCA9IHRydWVcbiAgICB0cmFpbi5ldmVudHMub25JbnB1dERvd24uYWRkKGZ1bmN0aW9uKCkge1xuICAgICAgZ2FtZS5zdGF0ZS5zdGFydCgncXVpY2ttYXRjaCcpXG4gICAgfSlcblxuICB9XG5cbiAgcmV0dXJuIGdhbWVTdGF0ZVxufSIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZ2FtZSkge1xuXG4gIHZhciBwcmVsb2FkZXIgPSB7fVxuXG4gIHByZWxvYWRlci5wcmVsb2FkID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUubG9hZC5pbWFnZSgnbG9nbycsICdpbWFnZXMvcGhhc2VyLnBuZyNncnVudC1jYWNoZS1idXN0JylcbiAgICBnYW1lLmxvYWQuaW1hZ2UoJ3JlZHNxdWFyZScsICdpbWFnZXMvcmVkc3F1YXJlLnBuZyNncnVudC1jYWNoZS1idXN0JylcbiAgICBnYW1lLmxvYWQuaW1hZ2UoJ2JsdWVzcXVhcmUnLCAnaW1hZ2VzL2JsdWVzcXVhcmUuanBnI2dydW50LWNhY2hlLWJ1c3QnKVxuICAgIGdhbWUubG9hZC5pbWFnZSgnd2hpdGVzcXVhcmUnLCAnaW1hZ2VzL3doaXRlc3F1YXJlLnBuZyNncnVudC1jYWNoZS1idXN0JylcbiAgfVxuXG4gIHByZWxvYWRlci5jcmVhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgZ2FtZS5zdGF0ZS5zdGFydCgnbWFpbm1lbnUnKVxuICB9XG5cbiAgcmV0dXJuIHByZWxvYWRlclxufVxuIiwidmFyIFBsYXllciA9IHJlcXVpcmUoJy4uL1BsYXllci5qcycpXG5cbnZhciBzb2NrZXRcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihnYW1lKSB7XG5cbiAgdmFyIGdhbWVTdGF0ZSA9IHt9XG5cbiAgdmFyIHAxLCBwMiwgaXNQMSwgaXNQMlxuXG4gIHZhciBpc1BsYXlpbmcgPSBmYWxzZVxuXG4gIHZhciBpZFxuXG4gIHZhciBnYW1lID0gZ2FtZVxuXG4gIGdhbWVTdGF0ZS5jcmVhdGUgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICBzb2NrZXQgPSB3aW5kb3cuc29ja2V0ID0gaW8oJ2h0dHA6Ly9sb2NhbGhvc3Q6OTAwMCcpXG5cbiAgICBnYW1lLnBoeXNpY3Muc3RhcnRTeXN0ZW0oUGhhc2VyLlBoeXNpY3MuUDJKUylcbiAgICBnYW1lLnBoeXNpY3MucDIuZ3Jhdml0eS55ID0gMjAwXG5cbiAgXHR2YXIgc3R5bGUgPSB7IGZvbnQ6ICc0MHB4IEFyaWFsJywgZmlsbDogJyNmZmZmZmYnLCBhbGlnbjogJ2NlbnRlcid9XG4gIFx0dmFyIG1haW5NZW51QnV0dG9uID0gZ2FtZS5hZGQudGV4dCgxMDAsIDUwLCAnYmFjaycsIHN0eWxlKVxuICAgIG1haW5NZW51QnV0dG9uLmFuY2hvci5zZXRUbygwLjUsIDAuNSlcbiAgICBtYWluTWVudUJ1dHRvbi5pbnB1dEVuYWJsZWQgPSB0cnVlXG4gICAgbWFpbk1lbnVCdXR0b24uZXZlbnRzLm9uSW5wdXREb3duLmFkZChmdW5jdGlvbigpIHtcbiAgICAgIHNvY2tldC5lbWl0KCdsZWF2ZS1sb2JieScpXG5cdFx0XHRnYW1lLnN0YXRlLnN0YXJ0KCdtdWx0aXBsYXllcm1lbnUnKVxuXG4gICAgICBpZihwMSYmcDIpIHtcbiAgICAgICAgcDEucmFnZG9sbC5kZXN0cm95KClcbiAgICAgICAgcDIucmFnZG9sbC5kZXN0cm95KClcbiAgICAgICAgcDEgPSBudWxsXG4gICAgICAgIHAyID0gbnVsbFxuICAgICAgfVxuICAgIH0pXG5cbiAgICBwMSA9IG5ldyBQbGF5ZXIoZ2FtZSwgMjAwLCAyMDApXG4gICAgcDEubWV0aG9kMCgpXG4gICAgcDIgPSBuZXcgUGxheWVyKGdhbWUsIDYwMCwgMjAwKVxuICAgIHAyLm1ldGhvZDAoKVxuXG4gICAgc29ja2V0LmVtaXQoJ2pvaW4tbG9iYnknKVxuXG4gICAgc29ja2V0Lm9uKCdpZCcsIGZ1bmN0aW9uKHNvY2tldElkKSB7XG4gICAgICBjb25zb2xlLmxvZygnaWQnLCBzb2NrZXRJZClcbiAgICAgIGlkID0gc29ja2V0SWRcbiAgICB9KVxuXG4gICAgc29ja2V0Lm9uKCdwbGF5ZXJzLWxpc3QnLCBmdW5jdGlvbiAocGxheWVyTGlzdCkge1xuICAgICAgY29uc29sZS5sb2cocGxheWVyTGlzdClcbiAgICAgIHBsYXllckxpc3QuZm9yRWFjaChmdW5jdGlvbihwbGF5ZXIsIGkpIHtcbiAgICAgICAgZ2FtZS5hZGQudGV4dCg1NTAsIDIwKihpKzEpLCBwbGF5ZXIsIHtmaWxsOiAnI2ZmZmZmZicsIGZvbnQ6ICcxNnB4IEFyaWFsJ30pXG4gICAgICB9KVxuICAgIH0pXG5cbiAgICBzb2NrZXQub24oJ25ldy1nYW1lJywgZnVuY3Rpb24gKHBsYXllcnMpIHtcblxuICAgICAgY29uc29sZS5sb2cocGxheWVycylcblxuICAgICAgaXNQMSA9IGZhbHNlXG4gICAgICBpc1AyID0gZmFsc2VcblxuICAgICAgaWYocGxheWVycy5wMSA9PT0gaWQpIHtcbiAgICAgICAgaXNQMSA9IHRydWVcbiAgICAgICAgcDEuc2V0Q29udHJvbGxlcignbWUnKVxuICAgICAgICBwMS5yZXNldCgpXG4gICAgICAgIHAxLm1ldGhvZDAoKVxuICAgICAgICBjb25zb2xlLmxvZygneW91IGFyZSBwMScpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpc1AyID0gZmFsc2VcbiAgICAgICAgcDEuc2V0Q29udHJvbGxlcignZHVtbXknKVxuICAgICAgICBwMS5yZXNldCgpXG4gICAgICAgIHAxLm1ldGhvZDAoKVxuICAgICAgfVxuXG4gICAgICBpZihwbGF5ZXJzLnAyID09PSBpZCkge1xuICAgICAgICBpc1AyID0gdHJ1ZVxuICAgICAgICBwMi5zZXRDb250cm9sbGVyKCdtZScpXG4gICAgICAgIHAyLnJlc2V0KClcbiAgICAgICAgcDIubWV0aG9kMCgpXG4gICAgICAgIGNvbnNvbGUubG9nKCd5b3UgYXJlIHAyJylcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlzUDIgPSBmYWxzZVxuICAgICAgICBwMi5zZXRDb250cm9sbGVyKCdkdW1teScpXG4gICAgICAgIHAyLnJlc2V0KClcbiAgICAgICAgcDIubWV0aG9kMCgpXG4gICAgICB9XG5cbiAgICAgIHZhciBwMWlkID0gcGxheWVycy5wMVxuICAgICAgdmFyIHAyaWQgPSBwbGF5ZXJzLnAyXG5cbiAgICAgIHNvY2tldC5vbigndHVybicsIGZ1bmN0aW9uICh0dXJuKSB7XG4gICAgICAgIGlmKGlzUDIpIHtcbiAgICAgICAgICBwMS50dXJuSGlzdG9yeS5wdXNoKHR1cm4ucDEpXG4gICAgICAgIH0gXG4gICAgICAgIGVsc2UgaWYoaXNQMSkge1xuICAgICAgICAgIHAyLnR1cm5IaXN0b3J5LnB1c2godHVybi5wMilcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBwMS50dXJuSGlzdG9yeS5wdXNoKHR1cm4ucDEpXG4gICAgICAgICAgcDIudHVybkhpc3RvcnkucHVzaCh0dXJuLnAyKVxuICAgICAgICB9XG5cbiAgICAgICAgcDEubWV0aG9kMSgpXG4gICAgICAgIHAyLm1ldGhvZDEoKVxuXG4gICAgICAgIGNvbnNvbGUubG9nKHR1cm4pXG4gICAgICB9KVxuICAgIH0pXG4gICAgXG4gICAgLy8gZGVidWdcbiAgICB3aW5kb3cuZ2FtZSA9IGdhbWVcbiAgICB3aW5kb3cucDEgPSBwMVxuICAgIHdpbmRvdy5wMiA9IHAyXG5cbiAgfVxuXG4gIHZhciBmcmFtZUNvdW50ID0gMFxuICB2YXIgbmV3VHVybiA9IGZhbHNlXG5cbiAgZ2FtZVN0YXRlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgIGlmKHAxICYmIHAyKSB7XG5cbiAgICAgIGZyYW1lQ291bnQrK1xuXG4gICAgICBpZihwMS5yZXNldFBsYXliYWNrKCkgfHwgcDIucmVzZXRQbGF5YmFjaygpKSB7XG4gICAgICAgIHAxLm1ldGhvZDIoKVxuICAgICAgICBwMi5tZXRob2QyKClcbiAgICAgICAgZnJhbWVDb3VudCA9IDBcbiAgICAgIH1cblxuICAgICAgaWYoZnJhbWVDb3VudCA9PT0gMTAwKSB7XG4gICAgICAgIGZyYW1lQ291bnQgPSAwXG4gICAgICAgIHAxLm1ldGhvZDIoKVxuICAgICAgICBwMi5tZXRob2QyKClcbiAgICAgIH1cblxuICAgICAgaWYoZ2FtZS5pbnB1dC5rZXlib2FyZC5qdXN0UHJlc3NlZChQaGFzZXIuS2V5Ym9hcmQuU1BBQ0VCQVIpKSB7XG4gICAgICAgIGlmKGlzUDEgfHwgaXNQMikge1xuICAgICAgICAgIHNvY2tldC5lbWl0KCdhY3Rpb24nLCBpZClcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICB9XG5cbiAgcmV0dXJuIGdhbWVTdGF0ZVxufSIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZ2FtZSkge1xuXG4gIHZhciBnYW1lU3RhdGUgPSB7fVxuXG4gIGdhbWVTdGF0ZS5jcmVhdGUgPSBmdW5jdGlvbiAoKSB7XG4gIFx0XG4gIFx0dmFyIHN0eWxlID0geyBmb250OiAnNDBweCBBcmlhbCcsIGZpbGw6ICcjZmZmZmZmJywgYWxpZ246ICdjZW50ZXInfVxuICBcdHZhciBtYWluTWVudUJ1dHRvbiA9IGdhbWUuYWRkLnRleHQoMTAwLCA1MCwgJ2JhY2snLCBzdHlsZSlcbiAgICBtYWluTWVudUJ1dHRvbi5hbmNob3Iuc2V0VG8oMC41LCAwLjUpXG4gICAgbWFpbk1lbnVCdXR0b24uaW5wdXRFbmFibGVkID0gdHJ1ZVxuICAgIG1haW5NZW51QnV0dG9uLmV2ZW50cy5vbklucHV0RG93bi5hZGQoZnVuY3Rpb24oKSB7XG5cdFx0XHRnYW1lLnN0YXRlLnN0YXJ0KCdtYWlubWVudScpXG4gICAgfSlcbiAgfVxuXG4gIHJldHVybiBnYW1lU3RhdGVcbn0iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGdhbWUpIHtcblxuICB2YXIgZ2FtZVN0YXRlID0ge31cblxuICBnYW1lU3RhdGUuY3JlYXRlID0gZnVuY3Rpb24gKCkge1xuXG4gIFx0dmFyIHN0eWxlID0geyBmb250OiAnNDBweCBBcmlhbCcsIGZpbGw6ICcjZmZmZmZmJywgYWxpZ246ICdjZW50ZXInfVxuICBcdHZhciBtYWluTWVudUJ1dHRvbiA9IGdhbWUuYWRkLnRleHQoMTAwLCA1MCwgJ2JhY2snLCBzdHlsZSlcbiAgICBtYWluTWVudUJ1dHRvbi5hbmNob3Iuc2V0VG8oMC41LCAwLjUpXG4gICAgbWFpbk1lbnVCdXR0b24uaW5wdXRFbmFibGVkID0gdHJ1ZVxuICAgIG1haW5NZW51QnV0dG9uLmV2ZW50cy5vbklucHV0RG93bi5hZGQoZnVuY3Rpb24oKSB7XG5cdFx0XHRnYW1lLnN0YXRlLnN0YXJ0KCdtYWlubWVudScpXG4gICAgfSlcblxuICBcdHZhciB0cmFpbiA9IGdhbWUuYWRkLnRleHQoZ2FtZS53b3JsZC5jZW50ZXJYLCAzMDAsICd0cmFpbicsIHN0eWxlKVxuICAgIHRyYWluLmFuY2hvci5zZXRUbygwLjUsIDAuNSlcbiAgICB0cmFpbi5pbnB1dEVuYWJsZWQgPSB0cnVlXG4gICAgdHJhaW4uZXZlbnRzLm9uSW5wdXREb3duLmFkZChmdW5jdGlvbigpIHtcblx0XHRcdGdhbWUuc3RhdGUuc3RhcnQoJ3RyYWluJylcbiAgICB9KVxuICB9XG5cbiAgcmV0dXJuIGdhbWVTdGF0ZVxufVxuIiwidmFyIFBsYXllciA9IHJlcXVpcmUoJy4uL1BsYXllci5qcycpXG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZ2FtZSkge1xuXG4gIHZhciBnYW1lU3RhdGUgPSB7fVxuXG4gIHZhciBwMSwgcDJcblxuICBnYW1lU3RhdGUuY3JlYXRlID0gZnVuY3Rpb24gKCkge1xuXG4gIFx0dmFyIHN0eWxlID0geyBmb250OiAnNDBweCBBcmlhbCcsIGZpbGw6ICcjZmZmZmZmJywgYWxpZ246ICdjZW50ZXInfVxuICBcdHZhciBtYWluTWVudUJ1dHRvbiA9IGdhbWUuYWRkLnRleHQoMTAwLCA1MCwgJ2JhY2snLCBzdHlsZSlcbiAgICBtYWluTWVudUJ1dHRvbi5hbmNob3Iuc2V0VG8oMC41LCAwLjUpXG4gICAgbWFpbk1lbnVCdXR0b24uaW5wdXRFbmFibGVkID0gdHJ1ZVxuICAgIG1haW5NZW51QnV0dG9uLmV2ZW50cy5vbklucHV0RG93bi5hZGQoZnVuY3Rpb24oKSB7XG5cdFx0XHRnYW1lLnN0YXRlLnN0YXJ0KCdzaW5nbGVwbGF5ZXJtZW51JylcbiAgICAgIGlmKHAxJiZwMikge1xuICAgICAgICBwMS5yYWdkb2xsLmRlc3Ryb3koKVxuICAgICAgICBwMi5yYWdkb2xsLmRlc3Ryb3koKVxuICAgICAgICBwMSA9IG51bGxcbiAgICAgICAgcDIgPSBudWxsXG4gICAgICB9XG4gICAgfSlcblxuICAgIGdhbWUucGh5c2ljcy5zdGFydFN5c3RlbShQaGFzZXIuUGh5c2ljcy5QMkpTKVxuICAgIGdhbWUucGh5c2ljcy5wMi5ncmF2aXR5LnkgPSAyMDBcblxuICAgIHAxID0gbmV3IFBsYXllcihnYW1lLCAyMDAsIDIwMClcbiAgICBwMS5zZXRDb250cm9sbGVyKCdtZScpXG4gICAgcDEubWV0aG9kMCgpXG5cbiAgICBwMiA9IG5ldyBQbGF5ZXIoZ2FtZSwgNjAwLCAyMDApXG4gICAgcDIuc2V0Q29udHJvbGxlcignZHVtbXknKVxuICAgIHAyLm1ldGhvZDAoKVxuICAgIFxuICAgIC8vIGRlYnVnXG4gICAgd2luZG93LmdhbWUgPSBnYW1lXG4gICAgd2luZG93LnAxID0gcDFcbiAgICB3aW5kb3cucDIgPSBwMlxuICB9XG5cbiAgdmFyIGZyYW1lQ291bnQgPSAwXG4gIHZhciBuZXdUdXJuID0gZmFsc2VcblxuICBnYW1lU3RhdGUudXBkYXRlID0gZnVuY3Rpb24gKCkge1xuXG4gICAgZnJhbWVDb3VudCsrXG5cbiAgICBpZihwMS5yZXNldFBsYXliYWNrKCkgfHwgcDIucmVzZXRQbGF5YmFjaygpKSB7XG4gICAgICBwMS5tZXRob2QyKClcbiAgICAgIHAyLm1ldGhvZDIoKVxuICAgICAgZnJhbWVDb3VudCA9IDBcbiAgICB9XG5cbiAgICBpZihmcmFtZUNvdW50ID09PSAxMDApIHtcbiAgICAgIGZyYW1lQ291bnQgPSAwXG5cbiAgICAgIGlmKHAxLnJlYWR5KCkgJiYgcDIucmVhZHkoKSkge1xuICAgICAgICBwMS5tZXRob2QxKClcbiAgICAgICAgcDIubWV0aG9kMSgpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwMS5tZXRob2QyKClcbiAgICAgICAgcDIubWV0aG9kMigpXG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYoZ2FtZS5pbnB1dC5rZXlib2FyZC5qdXN0UHJlc3NlZChQaGFzZXIuS2V5Ym9hcmQuU1BBQ0VCQVIpKSB7XG4gICAgICBwMS5pc1JlYWR5ID0gdHJ1ZVxuICAgICAgcDIuaXNSZWFkeSA9IHRydWVcbiAgICB9XG4gIH1cblxuICByZXR1cm4gZ2FtZVN0YXRlXG59IiwiKGZ1bmN0aW9uIChnbG9iYWwpe1xuO19fYnJvd3NlcmlmeV9zaGltX3JlcXVpcmVfXz1yZXF1aXJlOyhmdW5jdGlvbiBicm93c2VyaWZ5U2hpbShtb2R1bGUsIGV4cG9ydHMsIHJlcXVpcmUsIGRlZmluZSwgYnJvd3NlcmlmeV9zaGltX19kZWZpbmVfX21vZHVsZV9fZXhwb3J0X18pIHtcbi8vIHN0YXRzLmpzIC0gaHR0cDovL2dpdGh1Yi5jb20vbXJkb29iL3N0YXRzLmpzXG52YXIgU3RhdHM9ZnVuY3Rpb24oKXt2YXIgbD1EYXRlLm5vdygpLG09bCxnPTAsbj1JbmZpbml0eSxvPTAsaD0wLHA9SW5maW5pdHkscT0wLHI9MCxzPTAsZj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO2YuaWQ9XCJzdGF0c1wiO2YuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLGZ1bmN0aW9uKGIpe2IucHJldmVudERlZmF1bHQoKTt0KCsrcyUyKX0sITEpO2Yuc3R5bGUuY3NzVGV4dD1cIndpZHRoOjgwcHg7b3BhY2l0eTowLjk7Y3Vyc29yOnBvaW50ZXJcIjt2YXIgYT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO2EuaWQ9XCJmcHNcIjthLnN0eWxlLmNzc1RleHQ9XCJwYWRkaW5nOjAgMCAzcHggM3B4O3RleHQtYWxpZ246bGVmdDtiYWNrZ3JvdW5kLWNvbG9yOiMwMDJcIjtmLmFwcGVuZENoaWxkKGEpO3ZhciBpPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7aS5pZD1cImZwc1RleHRcIjtpLnN0eWxlLmNzc1RleHQ9XCJjb2xvcjojMGZmO2ZvbnQtZmFtaWx5OkhlbHZldGljYSxBcmlhbCxzYW5zLXNlcmlmO2ZvbnQtc2l6ZTo5cHg7Zm9udC13ZWlnaHQ6Ym9sZDtsaW5lLWhlaWdodDoxNXB4XCI7XG5pLmlubmVySFRNTD1cIkZQU1wiO2EuYXBwZW5kQ2hpbGQoaSk7dmFyIGM9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtjLmlkPVwiZnBzR3JhcGhcIjtjLnN0eWxlLmNzc1RleHQ9XCJwb3NpdGlvbjpyZWxhdGl2ZTt3aWR0aDo3NHB4O2hlaWdodDozMHB4O2JhY2tncm91bmQtY29sb3I6IzBmZlwiO2ZvcihhLmFwcGVuZENoaWxkKGMpOzc0PmMuY2hpbGRyZW4ubGVuZ3RoOyl7dmFyIGo9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7ai5zdHlsZS5jc3NUZXh0PVwid2lkdGg6MXB4O2hlaWdodDozMHB4O2Zsb2F0OmxlZnQ7YmFja2dyb3VuZC1jb2xvcjojMTEzXCI7Yy5hcHBlbmRDaGlsZChqKX12YXIgZD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO2QuaWQ9XCJtc1wiO2Quc3R5bGUuY3NzVGV4dD1cInBhZGRpbmc6MCAwIDNweCAzcHg7dGV4dC1hbGlnbjpsZWZ0O2JhY2tncm91bmQtY29sb3I6IzAyMDtkaXNwbGF5Om5vbmVcIjtmLmFwcGVuZENoaWxkKGQpO3ZhciBrPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5rLmlkPVwibXNUZXh0XCI7ay5zdHlsZS5jc3NUZXh0PVwiY29sb3I6IzBmMDtmb250LWZhbWlseTpIZWx2ZXRpY2EsQXJpYWwsc2Fucy1zZXJpZjtmb250LXNpemU6OXB4O2ZvbnQtd2VpZ2h0OmJvbGQ7bGluZS1oZWlnaHQ6MTVweFwiO2suaW5uZXJIVE1MPVwiTVNcIjtkLmFwcGVuZENoaWxkKGspO3ZhciBlPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7ZS5pZD1cIm1zR3JhcGhcIjtlLnN0eWxlLmNzc1RleHQ9XCJwb3NpdGlvbjpyZWxhdGl2ZTt3aWR0aDo3NHB4O2hlaWdodDozMHB4O2JhY2tncm91bmQtY29sb3I6IzBmMFwiO2ZvcihkLmFwcGVuZENoaWxkKGUpOzc0PmUuY2hpbGRyZW4ubGVuZ3RoOylqPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpLGouc3R5bGUuY3NzVGV4dD1cIndpZHRoOjFweDtoZWlnaHQ6MzBweDtmbG9hdDpsZWZ0O2JhY2tncm91bmQtY29sb3I6IzEzMVwiLGUuYXBwZW5kQ2hpbGQoaik7dmFyIHQ9ZnVuY3Rpb24oYil7cz1iO3N3aXRjaChzKXtjYXNlIDA6YS5zdHlsZS5kaXNwbGF5PVxuXCJibG9ja1wiO2Quc3R5bGUuZGlzcGxheT1cIm5vbmVcIjticmVhaztjYXNlIDE6YS5zdHlsZS5kaXNwbGF5PVwibm9uZVwiLGQuc3R5bGUuZGlzcGxheT1cImJsb2NrXCJ9fTtyZXR1cm57UkVWSVNJT046MTEsZG9tRWxlbWVudDpmLHNldE1vZGU6dCxiZWdpbjpmdW5jdGlvbigpe2w9RGF0ZS5ub3coKX0sZW5kOmZ1bmN0aW9uKCl7dmFyIGI9RGF0ZS5ub3coKTtnPWItbDtuPU1hdGgubWluKG4sZyk7bz1NYXRoLm1heChvLGcpO2sudGV4dENvbnRlbnQ9ZytcIiBNUyAoXCIrbitcIi1cIitvK1wiKVwiO3ZhciBhPU1hdGgubWluKDMwLDMwLTMwKihnLzIwMCkpO2UuYXBwZW5kQ2hpbGQoZS5maXJzdENoaWxkKS5zdHlsZS5oZWlnaHQ9YStcInB4XCI7cisrO2I+bSsxRTMmJihoPU1hdGgucm91bmQoMUUzKnIvKGItbSkpLHA9TWF0aC5taW4ocCxoKSxxPU1hdGgubWF4KHEsaCksaS50ZXh0Q29udGVudD1oK1wiIEZQUyAoXCIrcCtcIi1cIitxK1wiKVwiLGE9TWF0aC5taW4oMzAsMzAtMzAqKGgvMTAwKSksYy5hcHBlbmRDaGlsZChjLmZpcnN0Q2hpbGQpLnN0eWxlLmhlaWdodD1cbmErXCJweFwiLG09YixyPTApO3JldHVybiBifSx1cGRhdGU6ZnVuY3Rpb24oKXtsPXRoaXMuZW5kKCl9fX07XG47IGJyb3dzZXJpZnlfc2hpbV9fZGVmaW5lX19tb2R1bGVfX2V4cG9ydF9fKHR5cGVvZiBTdGF0cyAhPSBcInVuZGVmaW5lZFwiID8gU3RhdHMgOiB3aW5kb3cuU3RhdHMpO1xuXG59KS5jYWxsKGdsb2JhbCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBmdW5jdGlvbiBkZWZpbmVFeHBvcnQoZXgpIHsgbW9kdWxlLmV4cG9ydHMgPSBleDsgfSk7XG5cbn0pLmNhbGwodGhpcyx0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiID8gd2luZG93IDoge30pIl19
