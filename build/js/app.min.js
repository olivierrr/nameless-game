(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports={
  "name": "nameless-game",
  "version": "0.1.0",
  "description": "nameless",
  "main": "build/js/app.min.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "repository": {
    "type": "git",
    "url": "git@github.com:olivierrr/nameless-game.git"
  },
  "author": "olivierrr",
  "license": "MIT",
  "browser": {
    "lodash": "./node_modules/lodash/dist/lodash.compat.js",
    "Stats": "./src/js/lib/stats.min.js"
  },
  "browserify-shim": {
    "lodash": {
      "exports": "_"
    },
    "Stats": {
      "exports": "Stats"
    }
  },
  "devDependencies": {
    "browserify": "^4.1.5",
    "browserify-shim": "^3.5.0",
    "grunt": "^0.4.5",
    "grunt-browserify": "^2.1.0",
    "grunt-cache-bust": "^0.3.6",
    "grunt-contrib-clean": "^0.5.0",
    "grunt-contrib-connect": "^0.7.1",
    "grunt-contrib-copy": "^0.5.0",
    "grunt-contrib-jade": "^0.11.0",
    "grunt-contrib-jshint": "^0.10.0",
    "grunt-contrib-stylus": "^0.16.0",
    "grunt-contrib-uglify": "^0.4.0",
    "grunt-contrib-watch": "^0.6.1",
    "grunt-open": "^0.2.3",
    "grunt-pngmin": "^0.6.1"
  },
  "dependencies": {
    "grunt-contrib-compress": "^0.9.1",
    "lodash": "^2.4.1",
    "phaser": "^2.1.1"
  }
}

},{}],2:[function(require,module,exports){
var Ragdoll = require('./Ragdoll.js')

/*
 * Player class
 *
 * @extends Ragdoll
 * @constructor Player
 */
var Player = function (controller, game, x, y) {

  /**
   * available controllers: 
   *  'me'      - controlled by users input
   *  'dummy'   - no conroller
   *  'network' - controller over network
   *
   * @property {String} controller
   * @default 'dummy'
   */
  this.controller = controller || 'dummy'

	/**
	 * @reference {Phaser.game} game
	 */
	this.game = game

	/**
 	 * @Object {Phaser.group} ragdoll
	 */
	this.ragdoll = Ragdoll(game, x, y)

	/**
	 * @property {Boolean} isReady
	 */
	this.isReady = false

	/** 
   * @property {Boolen} isAllowingInput
   */
  this.isAllowingInput = true

  /**
   * a turn is an Array of actions
   * an 'action' is a joint event - ex: {jointName:'neck', type:'relax'}
   *
   * @property {Array} turnHistory
   */
  this.turnHistory = []

  /**
   * @property {Array} currentPosition
   */
  this.currentPosition = []

  /**
   * @property {Number} health
   */
  this.health = 100

  //TEST
  this.isResetingPlayback = false

  if(controller === 'dummy') {
    this.isAllowingInput = false
    this.isReady = true
  }
  if(controller === 'network') {
    this.isAllowingInput = false
  }
  if(controller === 'me') {

  }
}

/**
 * pushes an empty turn Object to turnHistory
 * ragdoll.newAction will push moves to newly pushed Object
 *
 * @method newTurn
 */
Player.prototype.newTurn = function () {
  this.turnHistory.push({})

  // this shouldn't be here
  this.ragdoll.children.forEach(function (part) {
    part.loadTexture('whitesquare')
  })

  this.isReady = false
}

/**
 * register a new move to latest turn on turnHistory
 *
 * @method newAction
 * @param {Object} move
 */
Player.prototype.newAction = function (move) {
  this.turnHistory[this.turnHistory.length-1][move.jointName] = move.type
}

/**
 * save current position and velocity
 * 
 * @method savePosition
*/
Player.prototype.savePosition = function () {

  this.currentPosition = this.ragdoll.children.map( function (part) {
    var data = part.body.data
    return {
      x: data.position[0], 
      y: data.position[1],
      vx: data.velocity[0],
      vy: data.velocity[1],
      angle: data.angle,
      angularVelocity: data.angularVelocity
    }
  })
}

/**
 * move ragdoll to last position on postision history
 * 
 * @method loadPosition
 */
Player.prototype.loadPosition = function () {

  var pos = this.currentPosition
  this.ragdoll.children.forEach(function(part, i) {
    var data = part.body.data
    data.position[0] = pos[i].x
    data.position[1] = pos[i].y
    data.angle = pos[i].angle,
    data.angularVelocity = pos[i].angularVelocity,
    data.velocity[0] = pos[i].vx,
    data.velocity[1] = pos[i].vy
  })
}

/**
 * create shallow copy of ragdoll with no physics
 *
 * @method clone
 * @return {Phaser.Group} a copy of ragdoll
*/
Player.prototype.clone = function () {
  var ragdollClone = this.game.add.group()

  var parts = this.ragdoll.children.forEach(function(part) {
    var clone = ragdollClone.create(part.position.x, part.position.y, part.key)
    clone.width = part.width
    clone.height = part.height
    clone.rotation = part.rotation
    clone.anchor.x = part.anchor.x
    clone.anchor.y = part.anchor.y
    clone.name = part.name
  })
  return ragdollClone
}

/**
 * singleton clone
 *
 * @method shadow
 */
Player.prototype.shadow = function () {

  if(this.shadowClone) this.shadowClone.destroy(true)

  this.shadowClone = this.clone()
  
  // TODO
  if(this.isAllowingInput) attachEvents(this.shadowClone, this)
}

/**
 * move ragdoll
 *
 * @method executeMove
 * @param {String} jointName
 * @param {String} type
 */
Player.prototype.executeMove = function (jointName, type) {
  switch (type) {
    case 'expand'  : this.ragdoll.flex(jointName)     ;break 
    case 'contract': this.ragdoll.contract(jointName) ;break 
    case 'relax'   : this.ragdoll.relax(jointName)    ;break 
    case 'tense'   : this.ragdoll.tense(jointName)    ;break 
  }
}

/**
 * a turn is an array of moves
 *
 * @method executeMoves
 * @param {Array} turn
 */
Player.prototype.executeMoves = function (turn, alpha) {
  var _this = this

  _this.ragdoll.alpha = alpha || 1 

  Object.keys(turn).forEach(function (jointName) {
    _this.executeMove(jointName, turn[jointName])
  })
}

/**
 * -todo
 */
Player.prototype.replayLastMove = function (turn) {

  this.shadowClone.destroy()

  this.executeMove(turn, 1)
}

//// TODO ////

// TEMP - TODO
function attachEvents (ragdoll, ctx) {
	ragdoll.children.forEach(function(part){
    part.inputEnabled = true
    part.events.onInputDown.add(function(e) {
      muscleClick.call(ctx, e.name)
    })
  })
}

// TEMP - TODO
function muscleClick (muscleName) {

  joint = {
    'head'         : 'neckJoint',
    'upperLeftArm' : 'leftShoulder',
    'lowerLeftArm' : 'leftElbowJoint',
    'upperRightArm': 'rightShoulder',
    'lowerRightArm': 'rightElbowJoint',
    'upperLeftLeg' : 'leftHipJoint',   
    'lowerLeftLeg' : 'leftKneeJoint',  
    'upperRightLeg': 'rightHipJoint', 
    'lowerRightLeg': 'rightKneeJoint', 
    'pelvis'       : 'spineJoint',     
    'upperBody'    : 'spineJoint'
  }

  var jointName = joint[muscleName]
  var jointState = this.turnHistory[this.turnHistory.length-1][jointName]
  var action

  if(jointState === 'expand') action = 'contract'
  else if(jointState === 'contract') action = 'relax'
  else if(jointState === 'relax') action = 'expand'
  else action = 'expand'

  console.log(action, jointName)

  this.newAction({
  	jointName: jointName, 
  	type: action
  })

  textures = {
    'expand'  : 'redsquare',
    'contract': 'bluesquare',
    'relax'   : 'whitesquare'
  }

  this.shadowClone.children.filter(function (part) {
    return part.name === muscleName
  })[0].loadTexture(textures[action])

  this.isResetingPlayback = true
}

Player.prototype.resetPlayback = function () {
  if(this.isResetingPlayback === true) {
    this.isResetingPlayback = false
    return true
  }
  else return false
}

Player.prototype.ready = function(first_argument) {
  if(this.isReady === true) {
    this.isReady = false
    return true
  }
  else return false
}

// -todo
Player.prototype.method0 = function () {
  this.newTurn()
  this.savePosition()
  this.shadow()
}
// -todo
Player.prototype.method1 = function () {
	this.ragdoll.relaxAll()
  this.newTurn()
  this.savePosition()
  this.shadow()
}
// -todo
Player.prototype.method2 = function () {
	this.loadPosition()
  this.ragdoll.relaxAll()
  this.executeMoves(this.turnHistory[this.turnHistory.length-1], 0.5)
}


module.exports = Player
},{"./Ragdoll.js":3}],3:[function(require,module,exports){
module.exports = function(game, offsetX, offsetY) {

  var FORCE = 10000
  var M = 100 // scale

  var bodySprites = {}
  var bodyJoints = {}
  var bodyParts = {}

  // normalized scales
  var sizes = {}
  sizes.shouldersDistance = 0.4
  sizes.upperArmLength = 0.5
  sizes.lowerArmLength = 0.5
  sizes.upperArmSize = 0.2
  sizes.lowerArmSize = 0.2
  sizes.neckLength = 0.1
  sizes.headRadius = 0.15
  sizes.upperBodyLength = 0.6
  sizes.pelvisLength = 0.4
  sizes.upperLegLength = 0.6
  sizes.upperLegSize = 0.2
  sizes.lowerLegSize = 0.2
  sizes.lowerLegLength = 0.5

  // apply scale multiplier
  Object.keys(sizes).forEach(function(key) {
    sizes[key] *= M
  })

  // Lower legs
  bodyParts.lowerLeftLeg = {
    x: -sizes.shouldersDistance / 2,
    y: sizes.lowerLegLength / 2,
    w: sizes.lowerLegSize,
    h: sizes.lowerLegLength,
    mass: 0.2
  }
  bodyParts.lowerRightLeg = {
    x: sizes.shouldersDistance / 2,
    y: sizes.lowerLegLength / 2,
    w: sizes.lowerLegSize,
    h: sizes.lowerLegLength,
    mass: 0.2
  }
  // Upper legs
  bodyParts.upperLeftLeg = {
    x: -sizes.shouldersDistance / 2,
    y: bodyParts.lowerLeftLeg.y + sizes.lowerLegLength / 2 + sizes.upperLegLength / 2,
    w: sizes.upperLegSize,
    h: sizes.upperLegLength,
    mass: 1
  }
  bodyParts.upperRightLeg = {
    x: sizes.shouldersDistance / 2,
    y: bodyParts.lowerRightLeg.y + sizes.lowerLegLength / 2 + sizes.upperLegLength / 2,
    w: sizes.upperLegSize,
    h: sizes.upperLegLength,
    mass: 1
  }
  // Pelvis
  bodyParts.pelvis = {
    x: 0,
    y: bodyParts.upperLeftLeg.y + sizes.upperLegLength / 2 + sizes.pelvisLength / 2,
    w: sizes.shouldersDistance,
    h: sizes.pelvisLength,
    mass: 1
  }
  // Upper body
  bodyParts.upperBody = {
    x: 0,
    y: bodyParts.pelvis.y + sizes.pelvisLength / 2 + sizes.upperBodyLength / 2,
    w: sizes.shouldersDistance,
    h: sizes.upperBodyLength,
    mass: 1
  }
  // Head
  bodyParts.head = {
    x: 0,
    y: bodyParts.upperBody.y + sizes.upperBodyLength / 2 + sizes.headRadius + sizes.neckLength,
    w: sizes.headRadius * 2,
    h: sizes.headRadius * 2,
    mass: 1
  }
  // Upper arms
  bodyParts.upperLeftArm = {
    x: -sizes.shouldersDistance / 2 - sizes.upperArmLength / 2,
    y: bodyParts.upperBody.y + sizes.upperBodyLength / 2,
    w: sizes.upperArmLength,
    h: sizes.upperArmSize,
    mass: 1
  }
  bodyParts.upperRightArm = {
    x: sizes.shouldersDistance / 2 + sizes.upperArmLength / 2,
    y: bodyParts.upperBody.y + sizes.upperBodyLength / 2,
    w: sizes.upperArmLength,
    h: sizes.upperArmSize,
    mass: 1
  }
  // lower arms
  bodyParts.lowerLeftArm = {
    x: bodyParts.upperLeftArm.x - sizes.lowerArmLength / 2 - sizes.upperArmLength / 2,
    y: bodyParts.upperLeftArm.y,
    w: sizes.lowerArmLength,
    h: sizes.lowerArmSize,
    mass: 1
  }
  bodyParts.lowerRightArm = {
    x: bodyParts.upperRightArm.x + sizes.lowerArmLength / 2 + sizes.upperArmLength / 2,
    y: bodyParts.upperRightArm.y,
    w: sizes.lowerArmLength,
    h: sizes.lowerArmSize,
    mass: 1
  }
  // Neck
  bodyJoints.neckJoint = {
    a: 'head',
    b: 'upperBody',
    pivot_a: [0, -sizes.headRadius - sizes.neckLength / 2],
    pivot_b: [0, sizes.upperBodyLength / 2],
    limits: [-Math.PI/12, Math.PI/12]
  }
  // Knees
  bodyJoints.leftKneeJoint = {
    a: 'lowerLeftLeg',
    b: 'upperLeftLeg',
    pivot_a: [0, sizes.lowerLegLength / 2],
    pivot_b: [0, -sizes.upperLegLength / 2],
    limits: [-Math.PI/5, Math.PI/5]
  }
  bodyJoints.rightKneeJoint = {
    a: 'lowerRightLeg',
    b: 'upperRightLeg',
    pivot_a: [0, sizes.lowerLegLength / 2],
    pivot_b: [0, -sizes.upperLegLength / 2],
    limits: [-Math.PI/5, Math.PI/5]
  }
  // Hips
  bodyJoints.leftHipJoint = {
    a: 'upperLeftLeg',
    b: 'pelvis',
    pivot_a: [0, sizes.upperLegLength / 2],
    pivot_b: [-sizes.shouldersDistance / 2, -sizes.pelvisLength / 2],
    limits: [-Math.PI/6, Math.PI/4]
  }
  bodyJoints.rightHipJoint = {
    a: 'upperRightLeg',
    b: 'pelvis',
    pivot_a: [0, sizes.upperLegLength / 2],
    pivot_b: [sizes.shouldersDistance / 2, -sizes.pelvisLength / 2],
    limits: [-Math.PI/4, Math.PI/6]
  }
    // Spine
  bodyJoints.spineJoint = {
    a: 'pelvis',
    b: 'upperBody',
    pivot_a: [0, sizes.pelvisLength / 2],
    pivot_b: [0, -sizes.upperBodyLength / 2],
    limits: [-Math.PI/5, Math.PI/5]
  }
    // Shoulders
  bodyJoints.leftShoulder = {
    a: 'upperBody',
    b: 'upperLeftArm',
    pivot_a: [-sizes.shouldersDistance / 2, sizes.upperBodyLength / 2],
    pivot_b: [sizes.upperArmLength / 2, 0],
    limits: [-Math.PI/2, Math.PI/2]
  }
  bodyJoints.rightShoulder = {
    a: 'upperBody',
    b: 'upperRightArm',
    pivot_a: [sizes.shouldersDistance / 2, sizes.upperBodyLength / 2],
    pivot_b: [-sizes.upperArmLength / 2, 0],
    limits: [-Math.PI/2, Math.PI/2]
  }
    // Elbows
  bodyJoints.leftElbowJoint = {
    a: 'lowerLeftArm',
    b: 'upperLeftArm',
    pivot_a: [sizes.lowerArmLength / 2, 0],
    pivot_b: [-sizes.upperArmLength / 2, 0],
    limits: [-Math.PI/4, Math.PI/4]
  }
  bodyJoints.rightElbowJoint = {
    a: 'lowerRightArm',
    b: 'upperRightArm',
    pivot_a: [-sizes.lowerArmLength / 2, 0],
    pivot_b: [sizes.upperArmLength / 2, 0],
    limits: [-Math.PI/4, Math.PI/4]
  }

  //

  var ragdoll = game.add.group(null, null, 'ragdoll')

  /**
   * create muscles
   */
  Object.keys(bodyParts).forEach(function(key) {

    var x = bodyParts[key].x + offsetX
    var y = bodyParts[key].y + offsetY
    var w = bodyParts[key].w
    var h = bodyParts[key].h

    var part = ragdoll.create(x, y, 'whitesquare')

    part.width = w
    part.height = h

    part.name = key

    game.physics.p2.enable(part)

    bodySprites[key] = part
  })

  /**
   * create joints
   */
  Object.keys(bodyJoints).forEach(function(key) {

    var joint = bodyJoints[key]
    
    var constraint = game.physics.p2.createRevoluteConstraint
      (
        bodySprites[joint.a], 
        joint.pivot_a, 
        bodySprites[joint.b], 
        joint.pivot_b, 
        FORCE
      )

    constraint.setLimits(joint.limits[0], joint.limits[1])
    constraint.collideConnected = false

    if(!ragdoll.joints) ragdoll.joints = {}
    ragdoll.joints[key] = constraint
  })

  /**
   * enable joint motor
   * 
   * @method flex
   * @param {String} jointName
   */
  ragdoll.flex = function (jointName) {
    var joint = this.joints[jointName]
    joint.enableMotor()
    joint.setMotorSpeed(3)
  }

  /**
   * enable joint motor
   * 
   * @method contract
   * @param {String} jointName
   */
  ragdoll.contract = function (jointName) {
    var joint = this.joints[jointName]
    joint.enableMotor()
    joint.setMotorSpeed(-3)
  }

  /**
   * disabling motor on all joints
   *
   * @method relaxAll
   */
  ragdoll.relaxAll = function() {
    var _this = this
    Object.keys(_this.joints).forEach(function(joint) {
      _this.relax(joint)
    })
  }

  /**
   * disable joint motor
   *
   * @method relax
   * @param {String} jointName
   */
  ragdoll.relax = function(jointName) {
    var joint = ragdoll.joints[jointName]
    joint.disableMotor()
  }

  return ragdoll
}
},{}],4:[function(require,module,exports){

var properties = require('./properties')

var states = { 
	boot: require('./states/boot.js'),
	preloader: require('./states/preloader.js'),
	mainmenu: require('./states/mainmenu.js'),
	singleplayermenu: require('./states/singleplayermenu.js'),
	multiplayermenu: require('./states/multiplayermenu.js'),
	settingsmenu: require('./states/settingsmenu.js'),
	train: require('./states/train.js'),
	quickmatch: require('./states/quickmatch.js')
}

window.onload = function() {

	var Phaser = window.Phaser // hack
	var io = window.io // hack

	var game = new Phaser.Game(properties.size.x, properties.size.y, Phaser.AUTO, 'game')

	game.state.add('boot', states.boot(game))
	game.state.add('preloader', states.preloader(game))
	game.state.add('mainmenu', states.mainmenu(game))
	game.state.add('singleplayermenu', states.singleplayermenu(game))
	game.state.add('multiplayermenu', states.multiplayermenu(game))
	game.state.add('settingsmenu', states.settingsmenu(game))
	game.state.add('train', states.train(game))
	game.state.add('quickmatch', states.quickmatch(game))

	game.state.start('boot')
}
},{"./properties":5,"./states/boot.js":6,"./states/mainmenu.js":7,"./states/multiplayermenu.js":8,"./states/preloader.js":9,"./states/quickmatch.js":10,"./states/settingsmenu.js":11,"./states/singleplayermenu.js":12,"./states/train.js":13}],5:[function(require,module,exports){
var npmProperties = require('../../../package.json')

module.exports = { 

  title: 'Phaser JS Boilerplate',

  description: npmProperties.description,

  port: 3017,

  liveReloadPort: 3018,

  showStats: true,

  size: { 
    x: 800,
    y: 600
  }, 
  
  analyticsId: ''
}

},{"../../../package.json":1}],6:[function(require,module,exports){
var Stats = require('Stats')
  , properties = require('../properties')

module.exports = function(game) {

  // FPS counter
  function addStats() {
    var stats = new Stats()
    stats.setMode(0)
    stats.domElement.style.position = 'absolute'
    stats.domElement.style.left = '0px'
    stats.domElement.style.top = '0px'
    document.body.appendChild(stats.domElement)
    setInterval(function () {
      stats.begin()
      stats.end()
    }, 1000 / 60)
  }

  var boot = {}

  boot.create = function () {

    if (properties.showStats) addStats()

    game.scale.pageAlignHorizontally = true
    game.scale.pageAlignVertically = true
    game.scale.refresh()

    game.state.start('preloader')
  }

  return boot
}

},{"../properties":5,"Stats":14}],7:[function(require,module,exports){
module.exports = function(game) {

  var gameState = {}

  gameState.create = function () {

    var logo = game.add.sprite(game.world.centerX, 200, 'logo')
    logo.anchor.setTo(0.5, 0.5)

    var style = { font: '40px Arial', fill: '#ffffff', align: 'center'}

    var singlePlayerButton = game.add.text(game.world.centerX, 450, 'single player', style)
    singlePlayerButton.anchor.setTo(0.5, 0.5)
    singlePlayerButton.inputEnabled = true
    singlePlayerButton.events.onInputDown.add(function() {
			game.state.start('singleplayermenu')
    })

    var multiPlayerButton = game.add.text(game.world.centerX, 500, 'multi player', style)
    multiPlayerButton.anchor.setTo(0.5, 0.5)
    multiPlayerButton.inputEnabled = true
    multiPlayerButton.events.onInputDown.add(function() {
			game.state.start('multiplayermenu')
    })

    var settingsButton = game.add.text(game.world.centerX, 550, 'settings', style)
    settingsButton.anchor.setTo(0.5, 0.5)
    settingsButton.inputEnabled = true
    settingsButton.events.onInputDown.add(function() {
    	game.state.start('settingsmenu')
    })

  }

  gameState.update = function() {
  	
  }

  return gameState
}

},{}],8:[function(require,module,exports){
module.exports = function(game) {

  var gameState = {}

  gameState.create = function () {

  	var style = { font: '40px Arial', fill: '#ffffff', align: 'center'}
  	var mainMenuButton = game.add.text(100, 50, 'back', style)
    mainMenuButton.anchor.setTo(0.5, 0.5)
    mainMenuButton.inputEnabled = true
    mainMenuButton.events.onInputDown.add(function() {
			game.state.start('mainmenu')
    })

    var train = game.add.text(game.world.centerX, 300, 'quickmatch', style)
    train.anchor.setTo(0.5, 0.5)
    train.inputEnabled = true
    train.events.onInputDown.add(function() {
      game.state.start('quickmatch')
    })

  }

  return gameState
}
},{}],9:[function(require,module,exports){
module.exports = function(game) {

  var preloader = {}

  preloader.preload = function () {
    game.load.image('logo', 'images/phaser.png#grunt-cache-bust')
    game.load.image('redsquare', 'images/redsquare.png#grunt-cache-bust')
    game.load.image('bluesquare', 'images/bluesquare.jpg#grunt-cache-bust')
    game.load.image('whitesquare', 'images/whitesquare.png#grunt-cache-bust')
  }

  preloader.create = function () {
    game.state.start('mainmenu')
  }

  return preloader
}

},{}],10:[function(require,module,exports){
var Player = require('../Player.js')

var socket

module.exports = function(game) {

  var gameState = {}

  var p1, p2, isP1, isP2

  var isPlaying = false

  var id

  gameState.create = function () {

    socket = window.socket = io('http://localhost:9000')

  	var style = { font: '40px Arial', fill: '#ffffff', align: 'center'}
  	var mainMenuButton = game.add.text(100, 50, 'back', style)
    mainMenuButton.anchor.setTo(0.5, 0.5)
    mainMenuButton.inputEnabled = true
    mainMenuButton.events.onInputDown.add(function() {
      socket.emit('leave-lobby')
			game.state.start('multiplayermenu')

      if(p1&&p2) {
        p1.ragdoll.destroy()
        p2.ragdoll.destroy()
        p1 = null
        p2 = null
      }
    })

    socket.emit('join-lobby')
    socket.on('id', function(socketId) {
      console.log('id', socketId)
      id = id
    })

    game.physics.startSystem(Phaser.Physics.P2JS)
    game.physics.p2.gravity.y = 200

    socket.on('players-list', function (playerList) {
      console.log(playerList)
      playerList.forEach(function(player, i) {
        game.add.text(550, 20*(i+1), player, {fill: '#ffffff', font: '16px Arial'})
      })
    })

    socket.on('new-game', function (players) {

      isP1 = false
      isP2 = false

      if(p1 || p2) {
        p1.ragdoll.destroy()
        p1 = null
        p2.ragdoll.destroy()
        p2 = null
      }

      if(id === players.p1 || id === players.p2) {

        if(players.p1 === id) {
          isP1 = true
          p1 = new Player('me', game, 200, 200)
          p1.method0()
        } else {
          p1 = new Player('network', game, 200, 200)
        }

        if(players.p2 === id) {
          isP2 = true
          p2 = new Player('me', game, 600, 200)
          p2.method0()
        } else {
          p2 = new Player('network', game, 600, 200)
        }
      }

      console.log(players)
      var p1id = players.p1
      var p2id = players.p2

      socket.on('turn', function (turn) {
        p2.turnHistory.push(turn)
        console.log(turn)
      })
    })

    game.physics.startSystem(Phaser.Physics.P2JS)
    game.physics.p2.gravity.y = 200
    
    // debug
    window.game = game
    window.p1 = p1
    window.p2 = p2

  }

  var frameCount = 0
  var newTurn = false

  gameState.update = function () {

    if(p1 && p2) {

      frameCount++

      if(p1.resetPlayback() || p2.resetPlayback()) {
        p1.method2()
        p2.method2()
        frameCount = 0
      }

      if(frameCount === 100) {
        frameCount = 0

        if(p1.ready() && p2.ready()) {
          p1.method1()
          p2.method1()
        } else {
          p1.method2()
          p2.method2()
        }
      }

      if(game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR)) {
        p1.isReady = true
        p2.isReady = true
      }
    }
  }

  return gameState
}
},{"../Player.js":2}],11:[function(require,module,exports){
module.exports = function(game) {

  var gameState = {}

  gameState.create = function () {
  	
  	var style = { font: '40px Arial', fill: '#ffffff', align: 'center'}
  	var mainMenuButton = game.add.text(100, 50, 'back', style)
    mainMenuButton.anchor.setTo(0.5, 0.5)
    mainMenuButton.inputEnabled = true
    mainMenuButton.events.onInputDown.add(function() {
			game.state.start('mainmenu')
    })
  }

  return gameState
}
},{}],12:[function(require,module,exports){
module.exports = function(game) {

  var gameState = {}

  gameState.create = function () {

  	var style = { font: '40px Arial', fill: '#ffffff', align: 'center'}
  	var mainMenuButton = game.add.text(100, 50, 'back', style)
    mainMenuButton.anchor.setTo(0.5, 0.5)
    mainMenuButton.inputEnabled = true
    mainMenuButton.events.onInputDown.add(function() {
			game.state.start('mainmenu')
    })

  	var train = game.add.text(game.world.centerX, 300, 'train', style)
    train.anchor.setTo(0.5, 0.5)
    train.inputEnabled = true
    train.events.onInputDown.add(function() {
			game.state.start('train')
    })
  }

  return gameState
}

},{}],13:[function(require,module,exports){
var Player = require('../Player.js')

module.exports = function(game) {

  var gameState = {}

  var p1, p2

  gameState.create = function () {

  	var style = { font: '40px Arial', fill: '#ffffff', align: 'center'}
  	var mainMenuButton = game.add.text(100, 50, 'back', style)
    mainMenuButton.anchor.setTo(0.5, 0.5)
    mainMenuButton.inputEnabled = true
    mainMenuButton.events.onInputDown.add(function() {
			game.state.start('singleplayermenu')
      p1.ragdoll.destroy()
      p2.ragdoll.destroy()
    })

    game.physics.startSystem(Phaser.Physics.P2JS)
    game.physics.p2.gravity.y = 200

    p1 = new Player('me', game, 200, 200)
    p1.method0()

    p2 = new Player('dummy', game, 600, 200)
    p2.method0()
    
    // debug
    window.game = game
    window.p1 = p1
    window.p2 = p2
  }

  var frameCount = 0
  var newTurn = false

  gameState.update = function () {

    frameCount++

    if(p1.resetPlayback() || p2.resetPlayback()) {
      p1.method2()
      p2.method2()
      frameCount = 0
    }

    if(frameCount === 100) {
      frameCount = 0

      if(p1.ready() && p2.ready()) {
        p1.method1()
        p2.method1()
      } else {
        p1.method2()
        p2.method2()
      }
    }

    if(game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR)) {
      p1.isReady = true
      p2.isReady = true
    }
  }

  return gameState
}
},{"../Player.js":2}],14:[function(require,module,exports){
(function (global){
;__browserify_shim_require__=require;(function browserifyShim(module, exports, require, define, browserify_shim__define__module__export__) {
// stats.js - http://github.com/mrdoob/stats.js
var Stats=function(){var l=Date.now(),m=l,g=0,n=Infinity,o=0,h=0,p=Infinity,q=0,r=0,s=0,f=document.createElement("div");f.id="stats";f.addEventListener("mousedown",function(b){b.preventDefault();t(++s%2)},!1);f.style.cssText="width:80px;opacity:0.9;cursor:pointer";var a=document.createElement("div");a.id="fps";a.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002";f.appendChild(a);var i=document.createElement("div");i.id="fpsText";i.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";
i.innerHTML="FPS";a.appendChild(i);var c=document.createElement("div");c.id="fpsGraph";c.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(a.appendChild(c);74>c.children.length;){var j=document.createElement("span");j.style.cssText="width:1px;height:30px;float:left;background-color:#113";c.appendChild(j)}var d=document.createElement("div");d.id="ms";d.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";f.appendChild(d);var k=document.createElement("div");
k.id="msText";k.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";k.innerHTML="MS";d.appendChild(k);var e=document.createElement("div");e.id="msGraph";e.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";for(d.appendChild(e);74>e.children.length;)j=document.createElement("span"),j.style.cssText="width:1px;height:30px;float:left;background-color:#131",e.appendChild(j);var t=function(b){s=b;switch(s){case 0:a.style.display=
"block";d.style.display="none";break;case 1:a.style.display="none",d.style.display="block"}};return{REVISION:11,domElement:f,setMode:t,begin:function(){l=Date.now()},end:function(){var b=Date.now();g=b-l;n=Math.min(n,g);o=Math.max(o,g);k.textContent=g+" MS ("+n+"-"+o+")";var a=Math.min(30,30-30*(g/200));e.appendChild(e.firstChild).style.height=a+"px";r++;b>m+1E3&&(h=Math.round(1E3*r/(b-m)),p=Math.min(p,h),q=Math.max(q,h),i.textContent=h+" FPS ("+p+"-"+q+")",a=Math.min(30,30-30*(h/100)),c.appendChild(c.firstChild).style.height=
a+"px",m=b,r=0);return b},update:function(){l=this.end()}}};
; browserify_shim__define__module__export__(typeof Stats != "undefined" ? Stats : window.Stats);

}).call(global, undefined, undefined, undefined, undefined, function defineExport(ex) { module.exports = ex; });

}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}]},{},[4])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL29saXZpZXIvRG9jdW1lbnRzL3Byb2dyYW1pbmcvZ2FtZXMvbmFtZWxlc3MtZ2FtZS9ub2RlX21vZHVsZXMvYnJvd3NlcmlmeS9ub2RlX21vZHVsZXMvYnJvd3Nlci1wYWNrL19wcmVsdWRlLmpzIiwiL2hvbWUvb2xpdmllci9Eb2N1bWVudHMvcHJvZ3JhbWluZy9nYW1lcy9uYW1lbGVzcy1nYW1lL3BhY2thZ2UuanNvbiIsIi9ob21lL29saXZpZXIvRG9jdW1lbnRzL3Byb2dyYW1pbmcvZ2FtZXMvbmFtZWxlc3MtZ2FtZS9zcmMvanMvZ2FtZS9QbGF5ZXIuanMiLCIvaG9tZS9vbGl2aWVyL0RvY3VtZW50cy9wcm9ncmFtaW5nL2dhbWVzL25hbWVsZXNzLWdhbWUvc3JjL2pzL2dhbWUvUmFnZG9sbC5qcyIsIi9ob21lL29saXZpZXIvRG9jdW1lbnRzL3Byb2dyYW1pbmcvZ2FtZXMvbmFtZWxlc3MtZ2FtZS9zcmMvanMvZ2FtZS9hcHAuanMiLCIvaG9tZS9vbGl2aWVyL0RvY3VtZW50cy9wcm9ncmFtaW5nL2dhbWVzL25hbWVsZXNzLWdhbWUvc3JjL2pzL2dhbWUvcHJvcGVydGllcy5qcyIsIi9ob21lL29saXZpZXIvRG9jdW1lbnRzL3Byb2dyYW1pbmcvZ2FtZXMvbmFtZWxlc3MtZ2FtZS9zcmMvanMvZ2FtZS9zdGF0ZXMvYm9vdC5qcyIsIi9ob21lL29saXZpZXIvRG9jdW1lbnRzL3Byb2dyYW1pbmcvZ2FtZXMvbmFtZWxlc3MtZ2FtZS9zcmMvanMvZ2FtZS9zdGF0ZXMvbWFpbm1lbnUuanMiLCIvaG9tZS9vbGl2aWVyL0RvY3VtZW50cy9wcm9ncmFtaW5nL2dhbWVzL25hbWVsZXNzLWdhbWUvc3JjL2pzL2dhbWUvc3RhdGVzL211bHRpcGxheWVybWVudS5qcyIsIi9ob21lL29saXZpZXIvRG9jdW1lbnRzL3Byb2dyYW1pbmcvZ2FtZXMvbmFtZWxlc3MtZ2FtZS9zcmMvanMvZ2FtZS9zdGF0ZXMvcHJlbG9hZGVyLmpzIiwiL2hvbWUvb2xpdmllci9Eb2N1bWVudHMvcHJvZ3JhbWluZy9nYW1lcy9uYW1lbGVzcy1nYW1lL3NyYy9qcy9nYW1lL3N0YXRlcy9xdWlja21hdGNoLmpzIiwiL2hvbWUvb2xpdmllci9Eb2N1bWVudHMvcHJvZ3JhbWluZy9nYW1lcy9uYW1lbGVzcy1nYW1lL3NyYy9qcy9nYW1lL3N0YXRlcy9zZXR0aW5nc21lbnUuanMiLCIvaG9tZS9vbGl2aWVyL0RvY3VtZW50cy9wcm9ncmFtaW5nL2dhbWVzL25hbWVsZXNzLWdhbWUvc3JjL2pzL2dhbWUvc3RhdGVzL3NpbmdsZXBsYXllcm1lbnUuanMiLCIvaG9tZS9vbGl2aWVyL0RvY3VtZW50cy9wcm9ncmFtaW5nL2dhbWVzL25hbWVsZXNzLWdhbWUvc3JjL2pzL2dhbWUvc3RhdGVzL3RyYWluLmpzIiwiL2hvbWUvb2xpdmllci9Eb2N1bWVudHMvcHJvZ3JhbWluZy9nYW1lcy9uYW1lbGVzcy1nYW1lL3NyYy9qcy9saWIvc3RhdHMubWluLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6VEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaFNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKX12YXIgZj1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwoZi5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxmLGYuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwibW9kdWxlLmV4cG9ydHM9e1xuICBcIm5hbWVcIjogXCJuYW1lbGVzcy1nYW1lXCIsXG4gIFwidmVyc2lvblwiOiBcIjAuMS4wXCIsXG4gIFwiZGVzY3JpcHRpb25cIjogXCJuYW1lbGVzc1wiLFxuICBcIm1haW5cIjogXCJidWlsZC9qcy9hcHAubWluLmpzXCIsXG4gIFwic2NyaXB0c1wiOiB7XG4gICAgXCJ0ZXN0XCI6IFwiZWNobyBcXFwiRXJyb3I6IG5vIHRlc3Qgc3BlY2lmaWVkXFxcIiAmJiBleGl0IDFcIlxuICB9LFxuICBcInJlcG9zaXRvcnlcIjoge1xuICAgIFwidHlwZVwiOiBcImdpdFwiLFxuICAgIFwidXJsXCI6IFwiZ2l0QGdpdGh1Yi5jb206b2xpdmllcnJyL25hbWVsZXNzLWdhbWUuZ2l0XCJcbiAgfSxcbiAgXCJhdXRob3JcIjogXCJvbGl2aWVycnJcIixcbiAgXCJsaWNlbnNlXCI6IFwiTUlUXCIsXG4gIFwiYnJvd3NlclwiOiB7XG4gICAgXCJsb2Rhc2hcIjogXCIuL25vZGVfbW9kdWxlcy9sb2Rhc2gvZGlzdC9sb2Rhc2guY29tcGF0LmpzXCIsXG4gICAgXCJTdGF0c1wiOiBcIi4vc3JjL2pzL2xpYi9zdGF0cy5taW4uanNcIlxuICB9LFxuICBcImJyb3dzZXJpZnktc2hpbVwiOiB7XG4gICAgXCJsb2Rhc2hcIjoge1xuICAgICAgXCJleHBvcnRzXCI6IFwiX1wiXG4gICAgfSxcbiAgICBcIlN0YXRzXCI6IHtcbiAgICAgIFwiZXhwb3J0c1wiOiBcIlN0YXRzXCJcbiAgICB9XG4gIH0sXG4gIFwiZGV2RGVwZW5kZW5jaWVzXCI6IHtcbiAgICBcImJyb3dzZXJpZnlcIjogXCJeNC4xLjVcIixcbiAgICBcImJyb3dzZXJpZnktc2hpbVwiOiBcIl4zLjUuMFwiLFxuICAgIFwiZ3J1bnRcIjogXCJeMC40LjVcIixcbiAgICBcImdydW50LWJyb3dzZXJpZnlcIjogXCJeMi4xLjBcIixcbiAgICBcImdydW50LWNhY2hlLWJ1c3RcIjogXCJeMC4zLjZcIixcbiAgICBcImdydW50LWNvbnRyaWItY2xlYW5cIjogXCJeMC41LjBcIixcbiAgICBcImdydW50LWNvbnRyaWItY29ubmVjdFwiOiBcIl4wLjcuMVwiLFxuICAgIFwiZ3J1bnQtY29udHJpYi1jb3B5XCI6IFwiXjAuNS4wXCIsXG4gICAgXCJncnVudC1jb250cmliLWphZGVcIjogXCJeMC4xMS4wXCIsXG4gICAgXCJncnVudC1jb250cmliLWpzaGludFwiOiBcIl4wLjEwLjBcIixcbiAgICBcImdydW50LWNvbnRyaWItc3R5bHVzXCI6IFwiXjAuMTYuMFwiLFxuICAgIFwiZ3J1bnQtY29udHJpYi11Z2xpZnlcIjogXCJeMC40LjBcIixcbiAgICBcImdydW50LWNvbnRyaWItd2F0Y2hcIjogXCJeMC42LjFcIixcbiAgICBcImdydW50LW9wZW5cIjogXCJeMC4yLjNcIixcbiAgICBcImdydW50LXBuZ21pblwiOiBcIl4wLjYuMVwiXG4gIH0sXG4gIFwiZGVwZW5kZW5jaWVzXCI6IHtcbiAgICBcImdydW50LWNvbnRyaWItY29tcHJlc3NcIjogXCJeMC45LjFcIixcbiAgICBcImxvZGFzaFwiOiBcIl4yLjQuMVwiLFxuICAgIFwicGhhc2VyXCI6IFwiXjIuMS4xXCJcbiAgfVxufVxuIiwidmFyIFJhZ2RvbGwgPSByZXF1aXJlKCcuL1JhZ2RvbGwuanMnKVxuXG4vKlxuICogUGxheWVyIGNsYXNzXG4gKlxuICogQGV4dGVuZHMgUmFnZG9sbFxuICogQGNvbnN0cnVjdG9yIFBsYXllclxuICovXG52YXIgUGxheWVyID0gZnVuY3Rpb24gKGNvbnRyb2xsZXIsIGdhbWUsIHgsIHkpIHtcblxuICAvKipcbiAgICogYXZhaWxhYmxlIGNvbnRyb2xsZXJzOiBcbiAgICogICdtZScgICAgICAtIGNvbnRyb2xsZWQgYnkgdXNlcnMgaW5wdXRcbiAgICogICdkdW1teScgICAtIG5vIGNvbnJvbGxlclxuICAgKiAgJ25ldHdvcmsnIC0gY29udHJvbGxlciBvdmVyIG5ldHdvcmtcbiAgICpcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IGNvbnRyb2xsZXJcbiAgICogQGRlZmF1bHQgJ2R1bW15J1xuICAgKi9cbiAgdGhpcy5jb250cm9sbGVyID0gY29udHJvbGxlciB8fCAnZHVtbXknXG5cblx0LyoqXG5cdCAqIEByZWZlcmVuY2Uge1BoYXNlci5nYW1lfSBnYW1lXG5cdCAqL1xuXHR0aGlzLmdhbWUgPSBnYW1lXG5cblx0LyoqXG4gXHQgKiBAT2JqZWN0IHtQaGFzZXIuZ3JvdXB9IHJhZ2RvbGxcblx0ICovXG5cdHRoaXMucmFnZG9sbCA9IFJhZ2RvbGwoZ2FtZSwgeCwgeSlcblxuXHQvKipcblx0ICogQHByb3BlcnR5IHtCb29sZWFufSBpc1JlYWR5XG5cdCAqL1xuXHR0aGlzLmlzUmVhZHkgPSBmYWxzZVxuXG5cdC8qKiBcbiAgICogQHByb3BlcnR5IHtCb29sZW59IGlzQWxsb3dpbmdJbnB1dFxuICAgKi9cbiAgdGhpcy5pc0FsbG93aW5nSW5wdXQgPSB0cnVlXG5cbiAgLyoqXG4gICAqIGEgdHVybiBpcyBhbiBBcnJheSBvZiBhY3Rpb25zXG4gICAqIGFuICdhY3Rpb24nIGlzIGEgam9pbnQgZXZlbnQgLSBleDoge2pvaW50TmFtZTonbmVjaycsIHR5cGU6J3JlbGF4J31cbiAgICpcbiAgICogQHByb3BlcnR5IHtBcnJheX0gdHVybkhpc3RvcnlcbiAgICovXG4gIHRoaXMudHVybkhpc3RvcnkgPSBbXVxuXG4gIC8qKlxuICAgKiBAcHJvcGVydHkge0FycmF5fSBjdXJyZW50UG9zaXRpb25cbiAgICovXG4gIHRoaXMuY3VycmVudFBvc2l0aW9uID0gW11cblxuICAvKipcbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IGhlYWx0aFxuICAgKi9cbiAgdGhpcy5oZWFsdGggPSAxMDBcblxuICAvL1RFU1RcbiAgdGhpcy5pc1Jlc2V0aW5nUGxheWJhY2sgPSBmYWxzZVxuXG4gIGlmKGNvbnRyb2xsZXIgPT09ICdkdW1teScpIHtcbiAgICB0aGlzLmlzQWxsb3dpbmdJbnB1dCA9IGZhbHNlXG4gICAgdGhpcy5pc1JlYWR5ID0gdHJ1ZVxuICB9XG4gIGlmKGNvbnRyb2xsZXIgPT09ICduZXR3b3JrJykge1xuICAgIHRoaXMuaXNBbGxvd2luZ0lucHV0ID0gZmFsc2VcbiAgfVxuICBpZihjb250cm9sbGVyID09PSAnbWUnKSB7XG5cbiAgfVxufVxuXG4vKipcbiAqIHB1c2hlcyBhbiBlbXB0eSB0dXJuIE9iamVjdCB0byB0dXJuSGlzdG9yeVxuICogcmFnZG9sbC5uZXdBY3Rpb24gd2lsbCBwdXNoIG1vdmVzIHRvIG5ld2x5IHB1c2hlZCBPYmplY3RcbiAqXG4gKiBAbWV0aG9kIG5ld1R1cm5cbiAqL1xuUGxheWVyLnByb3RvdHlwZS5uZXdUdXJuID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLnR1cm5IaXN0b3J5LnB1c2goe30pXG5cbiAgLy8gdGhpcyBzaG91bGRuJ3QgYmUgaGVyZVxuICB0aGlzLnJhZ2RvbGwuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAocGFydCkge1xuICAgIHBhcnQubG9hZFRleHR1cmUoJ3doaXRlc3F1YXJlJylcbiAgfSlcblxuICB0aGlzLmlzUmVhZHkgPSBmYWxzZVxufVxuXG4vKipcbiAqIHJlZ2lzdGVyIGEgbmV3IG1vdmUgdG8gbGF0ZXN0IHR1cm4gb24gdHVybkhpc3RvcnlcbiAqXG4gKiBAbWV0aG9kIG5ld0FjdGlvblxuICogQHBhcmFtIHtPYmplY3R9IG1vdmVcbiAqL1xuUGxheWVyLnByb3RvdHlwZS5uZXdBY3Rpb24gPSBmdW5jdGlvbiAobW92ZSkge1xuICB0aGlzLnR1cm5IaXN0b3J5W3RoaXMudHVybkhpc3RvcnkubGVuZ3RoLTFdW21vdmUuam9pbnROYW1lXSA9IG1vdmUudHlwZVxufVxuXG4vKipcbiAqIHNhdmUgY3VycmVudCBwb3NpdGlvbiBhbmQgdmVsb2NpdHlcbiAqIFxuICogQG1ldGhvZCBzYXZlUG9zaXRpb25cbiovXG5QbGF5ZXIucHJvdG90eXBlLnNhdmVQb3NpdGlvbiA9IGZ1bmN0aW9uICgpIHtcblxuICB0aGlzLmN1cnJlbnRQb3NpdGlvbiA9IHRoaXMucmFnZG9sbC5jaGlsZHJlbi5tYXAoIGZ1bmN0aW9uIChwYXJ0KSB7XG4gICAgdmFyIGRhdGEgPSBwYXJ0LmJvZHkuZGF0YVxuICAgIHJldHVybiB7XG4gICAgICB4OiBkYXRhLnBvc2l0aW9uWzBdLCBcbiAgICAgIHk6IGRhdGEucG9zaXRpb25bMV0sXG4gICAgICB2eDogZGF0YS52ZWxvY2l0eVswXSxcbiAgICAgIHZ5OiBkYXRhLnZlbG9jaXR5WzFdLFxuICAgICAgYW5nbGU6IGRhdGEuYW5nbGUsXG4gICAgICBhbmd1bGFyVmVsb2NpdHk6IGRhdGEuYW5ndWxhclZlbG9jaXR5XG4gICAgfVxuICB9KVxufVxuXG4vKipcbiAqIG1vdmUgcmFnZG9sbCB0byBsYXN0IHBvc2l0aW9uIG9uIHBvc3Rpc2lvbiBoaXN0b3J5XG4gKiBcbiAqIEBtZXRob2QgbG9hZFBvc2l0aW9uXG4gKi9cblBsYXllci5wcm90b3R5cGUubG9hZFBvc2l0aW9uID0gZnVuY3Rpb24gKCkge1xuXG4gIHZhciBwb3MgPSB0aGlzLmN1cnJlbnRQb3NpdGlvblxuICB0aGlzLnJhZ2RvbGwuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbihwYXJ0LCBpKSB7XG4gICAgdmFyIGRhdGEgPSBwYXJ0LmJvZHkuZGF0YVxuICAgIGRhdGEucG9zaXRpb25bMF0gPSBwb3NbaV0ueFxuICAgIGRhdGEucG9zaXRpb25bMV0gPSBwb3NbaV0ueVxuICAgIGRhdGEuYW5nbGUgPSBwb3NbaV0uYW5nbGUsXG4gICAgZGF0YS5hbmd1bGFyVmVsb2NpdHkgPSBwb3NbaV0uYW5ndWxhclZlbG9jaXR5LFxuICAgIGRhdGEudmVsb2NpdHlbMF0gPSBwb3NbaV0udngsXG4gICAgZGF0YS52ZWxvY2l0eVsxXSA9IHBvc1tpXS52eVxuICB9KVxufVxuXG4vKipcbiAqIGNyZWF0ZSBzaGFsbG93IGNvcHkgb2YgcmFnZG9sbCB3aXRoIG5vIHBoeXNpY3NcbiAqXG4gKiBAbWV0aG9kIGNsb25lXG4gKiBAcmV0dXJuIHtQaGFzZXIuR3JvdXB9IGEgY29weSBvZiByYWdkb2xsXG4qL1xuUGxheWVyLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIHJhZ2RvbGxDbG9uZSA9IHRoaXMuZ2FtZS5hZGQuZ3JvdXAoKVxuXG4gIHZhciBwYXJ0cyA9IHRoaXMucmFnZG9sbC5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKHBhcnQpIHtcbiAgICB2YXIgY2xvbmUgPSByYWdkb2xsQ2xvbmUuY3JlYXRlKHBhcnQucG9zaXRpb24ueCwgcGFydC5wb3NpdGlvbi55LCBwYXJ0LmtleSlcbiAgICBjbG9uZS53aWR0aCA9IHBhcnQud2lkdGhcbiAgICBjbG9uZS5oZWlnaHQgPSBwYXJ0LmhlaWdodFxuICAgIGNsb25lLnJvdGF0aW9uID0gcGFydC5yb3RhdGlvblxuICAgIGNsb25lLmFuY2hvci54ID0gcGFydC5hbmNob3IueFxuICAgIGNsb25lLmFuY2hvci55ID0gcGFydC5hbmNob3IueVxuICAgIGNsb25lLm5hbWUgPSBwYXJ0Lm5hbWVcbiAgfSlcbiAgcmV0dXJuIHJhZ2RvbGxDbG9uZVxufVxuXG4vKipcbiAqIHNpbmdsZXRvbiBjbG9uZVxuICpcbiAqIEBtZXRob2Qgc2hhZG93XG4gKi9cblBsYXllci5wcm90b3R5cGUuc2hhZG93ID0gZnVuY3Rpb24gKCkge1xuXG4gIGlmKHRoaXMuc2hhZG93Q2xvbmUpIHRoaXMuc2hhZG93Q2xvbmUuZGVzdHJveSh0cnVlKVxuXG4gIHRoaXMuc2hhZG93Q2xvbmUgPSB0aGlzLmNsb25lKClcbiAgXG4gIC8vIFRPRE9cbiAgaWYodGhpcy5pc0FsbG93aW5nSW5wdXQpIGF0dGFjaEV2ZW50cyh0aGlzLnNoYWRvd0Nsb25lLCB0aGlzKVxufVxuXG4vKipcbiAqIG1vdmUgcmFnZG9sbFxuICpcbiAqIEBtZXRob2QgZXhlY3V0ZU1vdmVcbiAqIEBwYXJhbSB7U3RyaW5nfSBqb2ludE5hbWVcbiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlXG4gKi9cblBsYXllci5wcm90b3R5cGUuZXhlY3V0ZU1vdmUgPSBmdW5jdGlvbiAoam9pbnROYW1lLCB0eXBlKSB7XG4gIHN3aXRjaCAodHlwZSkge1xuICAgIGNhc2UgJ2V4cGFuZCcgIDogdGhpcy5yYWdkb2xsLmZsZXgoam9pbnROYW1lKSAgICAgO2JyZWFrIFxuICAgIGNhc2UgJ2NvbnRyYWN0JzogdGhpcy5yYWdkb2xsLmNvbnRyYWN0KGpvaW50TmFtZSkgO2JyZWFrIFxuICAgIGNhc2UgJ3JlbGF4JyAgIDogdGhpcy5yYWdkb2xsLnJlbGF4KGpvaW50TmFtZSkgICAgO2JyZWFrIFxuICAgIGNhc2UgJ3RlbnNlJyAgIDogdGhpcy5yYWdkb2xsLnRlbnNlKGpvaW50TmFtZSkgICAgO2JyZWFrIFxuICB9XG59XG5cbi8qKlxuICogYSB0dXJuIGlzIGFuIGFycmF5IG9mIG1vdmVzXG4gKlxuICogQG1ldGhvZCBleGVjdXRlTW92ZXNcbiAqIEBwYXJhbSB7QXJyYXl9IHR1cm5cbiAqL1xuUGxheWVyLnByb3RvdHlwZS5leGVjdXRlTW92ZXMgPSBmdW5jdGlvbiAodHVybiwgYWxwaGEpIHtcbiAgdmFyIF90aGlzID0gdGhpc1xuXG4gIF90aGlzLnJhZ2RvbGwuYWxwaGEgPSBhbHBoYSB8fCAxIFxuXG4gIE9iamVjdC5rZXlzKHR1cm4pLmZvckVhY2goZnVuY3Rpb24gKGpvaW50TmFtZSkge1xuICAgIF90aGlzLmV4ZWN1dGVNb3ZlKGpvaW50TmFtZSwgdHVybltqb2ludE5hbWVdKVxuICB9KVxufVxuXG4vKipcbiAqIC10b2RvXG4gKi9cblBsYXllci5wcm90b3R5cGUucmVwbGF5TGFzdE1vdmUgPSBmdW5jdGlvbiAodHVybikge1xuXG4gIHRoaXMuc2hhZG93Q2xvbmUuZGVzdHJveSgpXG5cbiAgdGhpcy5leGVjdXRlTW92ZSh0dXJuLCAxKVxufVxuXG4vLy8vIFRPRE8gLy8vL1xuXG4vLyBURU1QIC0gVE9ET1xuZnVuY3Rpb24gYXR0YWNoRXZlbnRzIChyYWdkb2xsLCBjdHgpIHtcblx0cmFnZG9sbC5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uKHBhcnQpe1xuICAgIHBhcnQuaW5wdXRFbmFibGVkID0gdHJ1ZVxuICAgIHBhcnQuZXZlbnRzLm9uSW5wdXREb3duLmFkZChmdW5jdGlvbihlKSB7XG4gICAgICBtdXNjbGVDbGljay5jYWxsKGN0eCwgZS5uYW1lKVxuICAgIH0pXG4gIH0pXG59XG5cbi8vIFRFTVAgLSBUT0RPXG5mdW5jdGlvbiBtdXNjbGVDbGljayAobXVzY2xlTmFtZSkge1xuXG4gIGpvaW50ID0ge1xuICAgICdoZWFkJyAgICAgICAgIDogJ25lY2tKb2ludCcsXG4gICAgJ3VwcGVyTGVmdEFybScgOiAnbGVmdFNob3VsZGVyJyxcbiAgICAnbG93ZXJMZWZ0QXJtJyA6ICdsZWZ0RWxib3dKb2ludCcsXG4gICAgJ3VwcGVyUmlnaHRBcm0nOiAncmlnaHRTaG91bGRlcicsXG4gICAgJ2xvd2VyUmlnaHRBcm0nOiAncmlnaHRFbGJvd0pvaW50JyxcbiAgICAndXBwZXJMZWZ0TGVnJyA6ICdsZWZ0SGlwSm9pbnQnLCAgIFxuICAgICdsb3dlckxlZnRMZWcnIDogJ2xlZnRLbmVlSm9pbnQnLCAgXG4gICAgJ3VwcGVyUmlnaHRMZWcnOiAncmlnaHRIaXBKb2ludCcsIFxuICAgICdsb3dlclJpZ2h0TGVnJzogJ3JpZ2h0S25lZUpvaW50JywgXG4gICAgJ3BlbHZpcycgICAgICAgOiAnc3BpbmVKb2ludCcsICAgICBcbiAgICAndXBwZXJCb2R5JyAgICA6ICdzcGluZUpvaW50J1xuICB9XG5cbiAgdmFyIGpvaW50TmFtZSA9IGpvaW50W211c2NsZU5hbWVdXG4gIHZhciBqb2ludFN0YXRlID0gdGhpcy50dXJuSGlzdG9yeVt0aGlzLnR1cm5IaXN0b3J5Lmxlbmd0aC0xXVtqb2ludE5hbWVdXG4gIHZhciBhY3Rpb25cblxuICBpZihqb2ludFN0YXRlID09PSAnZXhwYW5kJykgYWN0aW9uID0gJ2NvbnRyYWN0J1xuICBlbHNlIGlmKGpvaW50U3RhdGUgPT09ICdjb250cmFjdCcpIGFjdGlvbiA9ICdyZWxheCdcbiAgZWxzZSBpZihqb2ludFN0YXRlID09PSAncmVsYXgnKSBhY3Rpb24gPSAnZXhwYW5kJ1xuICBlbHNlIGFjdGlvbiA9ICdleHBhbmQnXG5cbiAgY29uc29sZS5sb2coYWN0aW9uLCBqb2ludE5hbWUpXG5cbiAgdGhpcy5uZXdBY3Rpb24oe1xuICBcdGpvaW50TmFtZTogam9pbnROYW1lLCBcbiAgXHR0eXBlOiBhY3Rpb25cbiAgfSlcblxuICB0ZXh0dXJlcyA9IHtcbiAgICAnZXhwYW5kJyAgOiAncmVkc3F1YXJlJyxcbiAgICAnY29udHJhY3QnOiAnYmx1ZXNxdWFyZScsXG4gICAgJ3JlbGF4JyAgIDogJ3doaXRlc3F1YXJlJ1xuICB9XG5cbiAgdGhpcy5zaGFkb3dDbG9uZS5jaGlsZHJlbi5maWx0ZXIoZnVuY3Rpb24gKHBhcnQpIHtcbiAgICByZXR1cm4gcGFydC5uYW1lID09PSBtdXNjbGVOYW1lXG4gIH0pWzBdLmxvYWRUZXh0dXJlKHRleHR1cmVzW2FjdGlvbl0pXG5cbiAgdGhpcy5pc1Jlc2V0aW5nUGxheWJhY2sgPSB0cnVlXG59XG5cblBsYXllci5wcm90b3R5cGUucmVzZXRQbGF5YmFjayA9IGZ1bmN0aW9uICgpIHtcbiAgaWYodGhpcy5pc1Jlc2V0aW5nUGxheWJhY2sgPT09IHRydWUpIHtcbiAgICB0aGlzLmlzUmVzZXRpbmdQbGF5YmFjayA9IGZhbHNlXG4gICAgcmV0dXJuIHRydWVcbiAgfVxuICBlbHNlIHJldHVybiBmYWxzZVxufVxuXG5QbGF5ZXIucHJvdG90eXBlLnJlYWR5ID0gZnVuY3Rpb24oZmlyc3RfYXJndW1lbnQpIHtcbiAgaWYodGhpcy5pc1JlYWR5ID09PSB0cnVlKSB7XG4gICAgdGhpcy5pc1JlYWR5ID0gZmFsc2VcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG4gIGVsc2UgcmV0dXJuIGZhbHNlXG59XG5cbi8vIC10b2RvXG5QbGF5ZXIucHJvdG90eXBlLm1ldGhvZDAgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMubmV3VHVybigpXG4gIHRoaXMuc2F2ZVBvc2l0aW9uKClcbiAgdGhpcy5zaGFkb3coKVxufVxuLy8gLXRvZG9cblBsYXllci5wcm90b3R5cGUubWV0aG9kMSA9IGZ1bmN0aW9uICgpIHtcblx0dGhpcy5yYWdkb2xsLnJlbGF4QWxsKClcbiAgdGhpcy5uZXdUdXJuKClcbiAgdGhpcy5zYXZlUG9zaXRpb24oKVxuICB0aGlzLnNoYWRvdygpXG59XG4vLyAtdG9kb1xuUGxheWVyLnByb3RvdHlwZS5tZXRob2QyID0gZnVuY3Rpb24gKCkge1xuXHR0aGlzLmxvYWRQb3NpdGlvbigpXG4gIHRoaXMucmFnZG9sbC5yZWxheEFsbCgpXG4gIHRoaXMuZXhlY3V0ZU1vdmVzKHRoaXMudHVybkhpc3RvcnlbdGhpcy50dXJuSGlzdG9yeS5sZW5ndGgtMV0sIDAuNSlcbn1cblxuXG5tb2R1bGUuZXhwb3J0cyA9IFBsYXllciIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZ2FtZSwgb2Zmc2V0WCwgb2Zmc2V0WSkge1xuXG4gIHZhciBGT1JDRSA9IDEwMDAwXG4gIHZhciBNID0gMTAwIC8vIHNjYWxlXG5cbiAgdmFyIGJvZHlTcHJpdGVzID0ge31cbiAgdmFyIGJvZHlKb2ludHMgPSB7fVxuICB2YXIgYm9keVBhcnRzID0ge31cblxuICAvLyBub3JtYWxpemVkIHNjYWxlc1xuICB2YXIgc2l6ZXMgPSB7fVxuICBzaXplcy5zaG91bGRlcnNEaXN0YW5jZSA9IDAuNFxuICBzaXplcy51cHBlckFybUxlbmd0aCA9IDAuNVxuICBzaXplcy5sb3dlckFybUxlbmd0aCA9IDAuNVxuICBzaXplcy51cHBlckFybVNpemUgPSAwLjJcbiAgc2l6ZXMubG93ZXJBcm1TaXplID0gMC4yXG4gIHNpemVzLm5lY2tMZW5ndGggPSAwLjFcbiAgc2l6ZXMuaGVhZFJhZGl1cyA9IDAuMTVcbiAgc2l6ZXMudXBwZXJCb2R5TGVuZ3RoID0gMC42XG4gIHNpemVzLnBlbHZpc0xlbmd0aCA9IDAuNFxuICBzaXplcy51cHBlckxlZ0xlbmd0aCA9IDAuNlxuICBzaXplcy51cHBlckxlZ1NpemUgPSAwLjJcbiAgc2l6ZXMubG93ZXJMZWdTaXplID0gMC4yXG4gIHNpemVzLmxvd2VyTGVnTGVuZ3RoID0gMC41XG5cbiAgLy8gYXBwbHkgc2NhbGUgbXVsdGlwbGllclxuICBPYmplY3Qua2V5cyhzaXplcykuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICBzaXplc1trZXldICo9IE1cbiAgfSlcblxuICAvLyBMb3dlciBsZWdzXG4gIGJvZHlQYXJ0cy5sb3dlckxlZnRMZWcgPSB7XG4gICAgeDogLXNpemVzLnNob3VsZGVyc0Rpc3RhbmNlIC8gMixcbiAgICB5OiBzaXplcy5sb3dlckxlZ0xlbmd0aCAvIDIsXG4gICAgdzogc2l6ZXMubG93ZXJMZWdTaXplLFxuICAgIGg6IHNpemVzLmxvd2VyTGVnTGVuZ3RoLFxuICAgIG1hc3M6IDAuMlxuICB9XG4gIGJvZHlQYXJ0cy5sb3dlclJpZ2h0TGVnID0ge1xuICAgIHg6IHNpemVzLnNob3VsZGVyc0Rpc3RhbmNlIC8gMixcbiAgICB5OiBzaXplcy5sb3dlckxlZ0xlbmd0aCAvIDIsXG4gICAgdzogc2l6ZXMubG93ZXJMZWdTaXplLFxuICAgIGg6IHNpemVzLmxvd2VyTGVnTGVuZ3RoLFxuICAgIG1hc3M6IDAuMlxuICB9XG4gIC8vIFVwcGVyIGxlZ3NcbiAgYm9keVBhcnRzLnVwcGVyTGVmdExlZyA9IHtcbiAgICB4OiAtc2l6ZXMuc2hvdWxkZXJzRGlzdGFuY2UgLyAyLFxuICAgIHk6IGJvZHlQYXJ0cy5sb3dlckxlZnRMZWcueSArIHNpemVzLmxvd2VyTGVnTGVuZ3RoIC8gMiArIHNpemVzLnVwcGVyTGVnTGVuZ3RoIC8gMixcbiAgICB3OiBzaXplcy51cHBlckxlZ1NpemUsXG4gICAgaDogc2l6ZXMudXBwZXJMZWdMZW5ndGgsXG4gICAgbWFzczogMVxuICB9XG4gIGJvZHlQYXJ0cy51cHBlclJpZ2h0TGVnID0ge1xuICAgIHg6IHNpemVzLnNob3VsZGVyc0Rpc3RhbmNlIC8gMixcbiAgICB5OiBib2R5UGFydHMubG93ZXJSaWdodExlZy55ICsgc2l6ZXMubG93ZXJMZWdMZW5ndGggLyAyICsgc2l6ZXMudXBwZXJMZWdMZW5ndGggLyAyLFxuICAgIHc6IHNpemVzLnVwcGVyTGVnU2l6ZSxcbiAgICBoOiBzaXplcy51cHBlckxlZ0xlbmd0aCxcbiAgICBtYXNzOiAxXG4gIH1cbiAgLy8gUGVsdmlzXG4gIGJvZHlQYXJ0cy5wZWx2aXMgPSB7XG4gICAgeDogMCxcbiAgICB5OiBib2R5UGFydHMudXBwZXJMZWZ0TGVnLnkgKyBzaXplcy51cHBlckxlZ0xlbmd0aCAvIDIgKyBzaXplcy5wZWx2aXNMZW5ndGggLyAyLFxuICAgIHc6IHNpemVzLnNob3VsZGVyc0Rpc3RhbmNlLFxuICAgIGg6IHNpemVzLnBlbHZpc0xlbmd0aCxcbiAgICBtYXNzOiAxXG4gIH1cbiAgLy8gVXBwZXIgYm9keVxuICBib2R5UGFydHMudXBwZXJCb2R5ID0ge1xuICAgIHg6IDAsXG4gICAgeTogYm9keVBhcnRzLnBlbHZpcy55ICsgc2l6ZXMucGVsdmlzTGVuZ3RoIC8gMiArIHNpemVzLnVwcGVyQm9keUxlbmd0aCAvIDIsXG4gICAgdzogc2l6ZXMuc2hvdWxkZXJzRGlzdGFuY2UsXG4gICAgaDogc2l6ZXMudXBwZXJCb2R5TGVuZ3RoLFxuICAgIG1hc3M6IDFcbiAgfVxuICAvLyBIZWFkXG4gIGJvZHlQYXJ0cy5oZWFkID0ge1xuICAgIHg6IDAsXG4gICAgeTogYm9keVBhcnRzLnVwcGVyQm9keS55ICsgc2l6ZXMudXBwZXJCb2R5TGVuZ3RoIC8gMiArIHNpemVzLmhlYWRSYWRpdXMgKyBzaXplcy5uZWNrTGVuZ3RoLFxuICAgIHc6IHNpemVzLmhlYWRSYWRpdXMgKiAyLFxuICAgIGg6IHNpemVzLmhlYWRSYWRpdXMgKiAyLFxuICAgIG1hc3M6IDFcbiAgfVxuICAvLyBVcHBlciBhcm1zXG4gIGJvZHlQYXJ0cy51cHBlckxlZnRBcm0gPSB7XG4gICAgeDogLXNpemVzLnNob3VsZGVyc0Rpc3RhbmNlIC8gMiAtIHNpemVzLnVwcGVyQXJtTGVuZ3RoIC8gMixcbiAgICB5OiBib2R5UGFydHMudXBwZXJCb2R5LnkgKyBzaXplcy51cHBlckJvZHlMZW5ndGggLyAyLFxuICAgIHc6IHNpemVzLnVwcGVyQXJtTGVuZ3RoLFxuICAgIGg6IHNpemVzLnVwcGVyQXJtU2l6ZSxcbiAgICBtYXNzOiAxXG4gIH1cbiAgYm9keVBhcnRzLnVwcGVyUmlnaHRBcm0gPSB7XG4gICAgeDogc2l6ZXMuc2hvdWxkZXJzRGlzdGFuY2UgLyAyICsgc2l6ZXMudXBwZXJBcm1MZW5ndGggLyAyLFxuICAgIHk6IGJvZHlQYXJ0cy51cHBlckJvZHkueSArIHNpemVzLnVwcGVyQm9keUxlbmd0aCAvIDIsXG4gICAgdzogc2l6ZXMudXBwZXJBcm1MZW5ndGgsXG4gICAgaDogc2l6ZXMudXBwZXJBcm1TaXplLFxuICAgIG1hc3M6IDFcbiAgfVxuICAvLyBsb3dlciBhcm1zXG4gIGJvZHlQYXJ0cy5sb3dlckxlZnRBcm0gPSB7XG4gICAgeDogYm9keVBhcnRzLnVwcGVyTGVmdEFybS54IC0gc2l6ZXMubG93ZXJBcm1MZW5ndGggLyAyIC0gc2l6ZXMudXBwZXJBcm1MZW5ndGggLyAyLFxuICAgIHk6IGJvZHlQYXJ0cy51cHBlckxlZnRBcm0ueSxcbiAgICB3OiBzaXplcy5sb3dlckFybUxlbmd0aCxcbiAgICBoOiBzaXplcy5sb3dlckFybVNpemUsXG4gICAgbWFzczogMVxuICB9XG4gIGJvZHlQYXJ0cy5sb3dlclJpZ2h0QXJtID0ge1xuICAgIHg6IGJvZHlQYXJ0cy51cHBlclJpZ2h0QXJtLnggKyBzaXplcy5sb3dlckFybUxlbmd0aCAvIDIgKyBzaXplcy51cHBlckFybUxlbmd0aCAvIDIsXG4gICAgeTogYm9keVBhcnRzLnVwcGVyUmlnaHRBcm0ueSxcbiAgICB3OiBzaXplcy5sb3dlckFybUxlbmd0aCxcbiAgICBoOiBzaXplcy5sb3dlckFybVNpemUsXG4gICAgbWFzczogMVxuICB9XG4gIC8vIE5lY2tcbiAgYm9keUpvaW50cy5uZWNrSm9pbnQgPSB7XG4gICAgYTogJ2hlYWQnLFxuICAgIGI6ICd1cHBlckJvZHknLFxuICAgIHBpdm90X2E6IFswLCAtc2l6ZXMuaGVhZFJhZGl1cyAtIHNpemVzLm5lY2tMZW5ndGggLyAyXSxcbiAgICBwaXZvdF9iOiBbMCwgc2l6ZXMudXBwZXJCb2R5TGVuZ3RoIC8gMl0sXG4gICAgbGltaXRzOiBbLU1hdGguUEkvMTIsIE1hdGguUEkvMTJdXG4gIH1cbiAgLy8gS25lZXNcbiAgYm9keUpvaW50cy5sZWZ0S25lZUpvaW50ID0ge1xuICAgIGE6ICdsb3dlckxlZnRMZWcnLFxuICAgIGI6ICd1cHBlckxlZnRMZWcnLFxuICAgIHBpdm90X2E6IFswLCBzaXplcy5sb3dlckxlZ0xlbmd0aCAvIDJdLFxuICAgIHBpdm90X2I6IFswLCAtc2l6ZXMudXBwZXJMZWdMZW5ndGggLyAyXSxcbiAgICBsaW1pdHM6IFstTWF0aC5QSS81LCBNYXRoLlBJLzVdXG4gIH1cbiAgYm9keUpvaW50cy5yaWdodEtuZWVKb2ludCA9IHtcbiAgICBhOiAnbG93ZXJSaWdodExlZycsXG4gICAgYjogJ3VwcGVyUmlnaHRMZWcnLFxuICAgIHBpdm90X2E6IFswLCBzaXplcy5sb3dlckxlZ0xlbmd0aCAvIDJdLFxuICAgIHBpdm90X2I6IFswLCAtc2l6ZXMudXBwZXJMZWdMZW5ndGggLyAyXSxcbiAgICBsaW1pdHM6IFstTWF0aC5QSS81LCBNYXRoLlBJLzVdXG4gIH1cbiAgLy8gSGlwc1xuICBib2R5Sm9pbnRzLmxlZnRIaXBKb2ludCA9IHtcbiAgICBhOiAndXBwZXJMZWZ0TGVnJyxcbiAgICBiOiAncGVsdmlzJyxcbiAgICBwaXZvdF9hOiBbMCwgc2l6ZXMudXBwZXJMZWdMZW5ndGggLyAyXSxcbiAgICBwaXZvdF9iOiBbLXNpemVzLnNob3VsZGVyc0Rpc3RhbmNlIC8gMiwgLXNpemVzLnBlbHZpc0xlbmd0aCAvIDJdLFxuICAgIGxpbWl0czogWy1NYXRoLlBJLzYsIE1hdGguUEkvNF1cbiAgfVxuICBib2R5Sm9pbnRzLnJpZ2h0SGlwSm9pbnQgPSB7XG4gICAgYTogJ3VwcGVyUmlnaHRMZWcnLFxuICAgIGI6ICdwZWx2aXMnLFxuICAgIHBpdm90X2E6IFswLCBzaXplcy51cHBlckxlZ0xlbmd0aCAvIDJdLFxuICAgIHBpdm90X2I6IFtzaXplcy5zaG91bGRlcnNEaXN0YW5jZSAvIDIsIC1zaXplcy5wZWx2aXNMZW5ndGggLyAyXSxcbiAgICBsaW1pdHM6IFstTWF0aC5QSS80LCBNYXRoLlBJLzZdXG4gIH1cbiAgICAvLyBTcGluZVxuICBib2R5Sm9pbnRzLnNwaW5lSm9pbnQgPSB7XG4gICAgYTogJ3BlbHZpcycsXG4gICAgYjogJ3VwcGVyQm9keScsXG4gICAgcGl2b3RfYTogWzAsIHNpemVzLnBlbHZpc0xlbmd0aCAvIDJdLFxuICAgIHBpdm90X2I6IFswLCAtc2l6ZXMudXBwZXJCb2R5TGVuZ3RoIC8gMl0sXG4gICAgbGltaXRzOiBbLU1hdGguUEkvNSwgTWF0aC5QSS81XVxuICB9XG4gICAgLy8gU2hvdWxkZXJzXG4gIGJvZHlKb2ludHMubGVmdFNob3VsZGVyID0ge1xuICAgIGE6ICd1cHBlckJvZHknLFxuICAgIGI6ICd1cHBlckxlZnRBcm0nLFxuICAgIHBpdm90X2E6IFstc2l6ZXMuc2hvdWxkZXJzRGlzdGFuY2UgLyAyLCBzaXplcy51cHBlckJvZHlMZW5ndGggLyAyXSxcbiAgICBwaXZvdF9iOiBbc2l6ZXMudXBwZXJBcm1MZW5ndGggLyAyLCAwXSxcbiAgICBsaW1pdHM6IFstTWF0aC5QSS8yLCBNYXRoLlBJLzJdXG4gIH1cbiAgYm9keUpvaW50cy5yaWdodFNob3VsZGVyID0ge1xuICAgIGE6ICd1cHBlckJvZHknLFxuICAgIGI6ICd1cHBlclJpZ2h0QXJtJyxcbiAgICBwaXZvdF9hOiBbc2l6ZXMuc2hvdWxkZXJzRGlzdGFuY2UgLyAyLCBzaXplcy51cHBlckJvZHlMZW5ndGggLyAyXSxcbiAgICBwaXZvdF9iOiBbLXNpemVzLnVwcGVyQXJtTGVuZ3RoIC8gMiwgMF0sXG4gICAgbGltaXRzOiBbLU1hdGguUEkvMiwgTWF0aC5QSS8yXVxuICB9XG4gICAgLy8gRWxib3dzXG4gIGJvZHlKb2ludHMubGVmdEVsYm93Sm9pbnQgPSB7XG4gICAgYTogJ2xvd2VyTGVmdEFybScsXG4gICAgYjogJ3VwcGVyTGVmdEFybScsXG4gICAgcGl2b3RfYTogW3NpemVzLmxvd2VyQXJtTGVuZ3RoIC8gMiwgMF0sXG4gICAgcGl2b3RfYjogWy1zaXplcy51cHBlckFybUxlbmd0aCAvIDIsIDBdLFxuICAgIGxpbWl0czogWy1NYXRoLlBJLzQsIE1hdGguUEkvNF1cbiAgfVxuICBib2R5Sm9pbnRzLnJpZ2h0RWxib3dKb2ludCA9IHtcbiAgICBhOiAnbG93ZXJSaWdodEFybScsXG4gICAgYjogJ3VwcGVyUmlnaHRBcm0nLFxuICAgIHBpdm90X2E6IFstc2l6ZXMubG93ZXJBcm1MZW5ndGggLyAyLCAwXSxcbiAgICBwaXZvdF9iOiBbc2l6ZXMudXBwZXJBcm1MZW5ndGggLyAyLCAwXSxcbiAgICBsaW1pdHM6IFstTWF0aC5QSS80LCBNYXRoLlBJLzRdXG4gIH1cblxuICAvL1xuXG4gIHZhciByYWdkb2xsID0gZ2FtZS5hZGQuZ3JvdXAobnVsbCwgbnVsbCwgJ3JhZ2RvbGwnKVxuXG4gIC8qKlxuICAgKiBjcmVhdGUgbXVzY2xlc1xuICAgKi9cbiAgT2JqZWN0LmtleXMoYm9keVBhcnRzKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuXG4gICAgdmFyIHggPSBib2R5UGFydHNba2V5XS54ICsgb2Zmc2V0WFxuICAgIHZhciB5ID0gYm9keVBhcnRzW2tleV0ueSArIG9mZnNldFlcbiAgICB2YXIgdyA9IGJvZHlQYXJ0c1trZXldLndcbiAgICB2YXIgaCA9IGJvZHlQYXJ0c1trZXldLmhcblxuICAgIHZhciBwYXJ0ID0gcmFnZG9sbC5jcmVhdGUoeCwgeSwgJ3doaXRlc3F1YXJlJylcblxuICAgIHBhcnQud2lkdGggPSB3XG4gICAgcGFydC5oZWlnaHQgPSBoXG5cbiAgICBwYXJ0Lm5hbWUgPSBrZXlcblxuICAgIGdhbWUucGh5c2ljcy5wMi5lbmFibGUocGFydClcblxuICAgIGJvZHlTcHJpdGVzW2tleV0gPSBwYXJ0XG4gIH0pXG5cbiAgLyoqXG4gICAqIGNyZWF0ZSBqb2ludHNcbiAgICovXG4gIE9iamVjdC5rZXlzKGJvZHlKb2ludHMpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG5cbiAgICB2YXIgam9pbnQgPSBib2R5Sm9pbnRzW2tleV1cbiAgICBcbiAgICB2YXIgY29uc3RyYWludCA9IGdhbWUucGh5c2ljcy5wMi5jcmVhdGVSZXZvbHV0ZUNvbnN0cmFpbnRcbiAgICAgIChcbiAgICAgICAgYm9keVNwcml0ZXNbam9pbnQuYV0sIFxuICAgICAgICBqb2ludC5waXZvdF9hLCBcbiAgICAgICAgYm9keVNwcml0ZXNbam9pbnQuYl0sIFxuICAgICAgICBqb2ludC5waXZvdF9iLCBcbiAgICAgICAgRk9SQ0VcbiAgICAgIClcblxuICAgIGNvbnN0cmFpbnQuc2V0TGltaXRzKGpvaW50LmxpbWl0c1swXSwgam9pbnQubGltaXRzWzFdKVxuICAgIGNvbnN0cmFpbnQuY29sbGlkZUNvbm5lY3RlZCA9IGZhbHNlXG5cbiAgICBpZighcmFnZG9sbC5qb2ludHMpIHJhZ2RvbGwuam9pbnRzID0ge31cbiAgICByYWdkb2xsLmpvaW50c1trZXldID0gY29uc3RyYWludFxuICB9KVxuXG4gIC8qKlxuICAgKiBlbmFibGUgam9pbnQgbW90b3JcbiAgICogXG4gICAqIEBtZXRob2QgZmxleFxuICAgKiBAcGFyYW0ge1N0cmluZ30gam9pbnROYW1lXG4gICAqL1xuICByYWdkb2xsLmZsZXggPSBmdW5jdGlvbiAoam9pbnROYW1lKSB7XG4gICAgdmFyIGpvaW50ID0gdGhpcy5qb2ludHNbam9pbnROYW1lXVxuICAgIGpvaW50LmVuYWJsZU1vdG9yKClcbiAgICBqb2ludC5zZXRNb3RvclNwZWVkKDMpXG4gIH1cblxuICAvKipcbiAgICogZW5hYmxlIGpvaW50IG1vdG9yXG4gICAqIFxuICAgKiBAbWV0aG9kIGNvbnRyYWN0XG4gICAqIEBwYXJhbSB7U3RyaW5nfSBqb2ludE5hbWVcbiAgICovXG4gIHJhZ2RvbGwuY29udHJhY3QgPSBmdW5jdGlvbiAoam9pbnROYW1lKSB7XG4gICAgdmFyIGpvaW50ID0gdGhpcy5qb2ludHNbam9pbnROYW1lXVxuICAgIGpvaW50LmVuYWJsZU1vdG9yKClcbiAgICBqb2ludC5zZXRNb3RvclNwZWVkKC0zKVxuICB9XG5cbiAgLyoqXG4gICAqIGRpc2FibGluZyBtb3RvciBvbiBhbGwgam9pbnRzXG4gICAqXG4gICAqIEBtZXRob2QgcmVsYXhBbGxcbiAgICovXG4gIHJhZ2RvbGwucmVsYXhBbGwgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzXG4gICAgT2JqZWN0LmtleXMoX3RoaXMuam9pbnRzKS5mb3JFYWNoKGZ1bmN0aW9uKGpvaW50KSB7XG4gICAgICBfdGhpcy5yZWxheChqb2ludClcbiAgICB9KVxuICB9XG5cbiAgLyoqXG4gICAqIGRpc2FibGUgam9pbnQgbW90b3JcbiAgICpcbiAgICogQG1ldGhvZCByZWxheFxuICAgKiBAcGFyYW0ge1N0cmluZ30gam9pbnROYW1lXG4gICAqL1xuICByYWdkb2xsLnJlbGF4ID0gZnVuY3Rpb24oam9pbnROYW1lKSB7XG4gICAgdmFyIGpvaW50ID0gcmFnZG9sbC5qb2ludHNbam9pbnROYW1lXVxuICAgIGpvaW50LmRpc2FibGVNb3RvcigpXG4gIH1cblxuICByZXR1cm4gcmFnZG9sbFxufSIsIlxudmFyIHByb3BlcnRpZXMgPSByZXF1aXJlKCcuL3Byb3BlcnRpZXMnKVxuXG52YXIgc3RhdGVzID0geyBcblx0Ym9vdDogcmVxdWlyZSgnLi9zdGF0ZXMvYm9vdC5qcycpLFxuXHRwcmVsb2FkZXI6IHJlcXVpcmUoJy4vc3RhdGVzL3ByZWxvYWRlci5qcycpLFxuXHRtYWlubWVudTogcmVxdWlyZSgnLi9zdGF0ZXMvbWFpbm1lbnUuanMnKSxcblx0c2luZ2xlcGxheWVybWVudTogcmVxdWlyZSgnLi9zdGF0ZXMvc2luZ2xlcGxheWVybWVudS5qcycpLFxuXHRtdWx0aXBsYXllcm1lbnU6IHJlcXVpcmUoJy4vc3RhdGVzL211bHRpcGxheWVybWVudS5qcycpLFxuXHRzZXR0aW5nc21lbnU6IHJlcXVpcmUoJy4vc3RhdGVzL3NldHRpbmdzbWVudS5qcycpLFxuXHR0cmFpbjogcmVxdWlyZSgnLi9zdGF0ZXMvdHJhaW4uanMnKSxcblx0cXVpY2ttYXRjaDogcmVxdWlyZSgnLi9zdGF0ZXMvcXVpY2ttYXRjaC5qcycpXG59XG5cbndpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHtcblxuXHR2YXIgUGhhc2VyID0gd2luZG93LlBoYXNlciAvLyBoYWNrXG5cdHZhciBpbyA9IHdpbmRvdy5pbyAvLyBoYWNrXG5cblx0dmFyIGdhbWUgPSBuZXcgUGhhc2VyLkdhbWUocHJvcGVydGllcy5zaXplLngsIHByb3BlcnRpZXMuc2l6ZS55LCBQaGFzZXIuQVVUTywgJ2dhbWUnKVxuXG5cdGdhbWUuc3RhdGUuYWRkKCdib290Jywgc3RhdGVzLmJvb3QoZ2FtZSkpXG5cdGdhbWUuc3RhdGUuYWRkKCdwcmVsb2FkZXInLCBzdGF0ZXMucHJlbG9hZGVyKGdhbWUpKVxuXHRnYW1lLnN0YXRlLmFkZCgnbWFpbm1lbnUnLCBzdGF0ZXMubWFpbm1lbnUoZ2FtZSkpXG5cdGdhbWUuc3RhdGUuYWRkKCdzaW5nbGVwbGF5ZXJtZW51Jywgc3RhdGVzLnNpbmdsZXBsYXllcm1lbnUoZ2FtZSkpXG5cdGdhbWUuc3RhdGUuYWRkKCdtdWx0aXBsYXllcm1lbnUnLCBzdGF0ZXMubXVsdGlwbGF5ZXJtZW51KGdhbWUpKVxuXHRnYW1lLnN0YXRlLmFkZCgnc2V0dGluZ3NtZW51Jywgc3RhdGVzLnNldHRpbmdzbWVudShnYW1lKSlcblx0Z2FtZS5zdGF0ZS5hZGQoJ3RyYWluJywgc3RhdGVzLnRyYWluKGdhbWUpKVxuXHRnYW1lLnN0YXRlLmFkZCgncXVpY2ttYXRjaCcsIHN0YXRlcy5xdWlja21hdGNoKGdhbWUpKVxuXG5cdGdhbWUuc3RhdGUuc3RhcnQoJ2Jvb3QnKVxufSIsInZhciBucG1Qcm9wZXJ0aWVzID0gcmVxdWlyZSgnLi4vLi4vLi4vcGFja2FnZS5qc29uJylcblxubW9kdWxlLmV4cG9ydHMgPSB7IFxuXG4gIHRpdGxlOiAnUGhhc2VyIEpTIEJvaWxlcnBsYXRlJyxcblxuICBkZXNjcmlwdGlvbjogbnBtUHJvcGVydGllcy5kZXNjcmlwdGlvbixcblxuICBwb3J0OiAzMDE3LFxuXG4gIGxpdmVSZWxvYWRQb3J0OiAzMDE4LFxuXG4gIHNob3dTdGF0czogdHJ1ZSxcblxuICBzaXplOiB7IFxuICAgIHg6IDgwMCxcbiAgICB5OiA2MDBcbiAgfSwgXG4gIFxuICBhbmFseXRpY3NJZDogJydcbn1cbiIsInZhciBTdGF0cyA9IHJlcXVpcmUoJ1N0YXRzJylcbiAgLCBwcm9wZXJ0aWVzID0gcmVxdWlyZSgnLi4vcHJvcGVydGllcycpXG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZ2FtZSkge1xuXG4gIC8vIEZQUyBjb3VudGVyXG4gIGZ1bmN0aW9uIGFkZFN0YXRzKCkge1xuICAgIHZhciBzdGF0cyA9IG5ldyBTdGF0cygpXG4gICAgc3RhdHMuc2V0TW9kZSgwKVxuICAgIHN0YXRzLmRvbUVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnXG4gICAgc3RhdHMuZG9tRWxlbWVudC5zdHlsZS5sZWZ0ID0gJzBweCdcbiAgICBzdGF0cy5kb21FbGVtZW50LnN0eWxlLnRvcCA9ICcwcHgnXG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzdGF0cy5kb21FbGVtZW50KVxuICAgIHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAgICAgIHN0YXRzLmJlZ2luKClcbiAgICAgIHN0YXRzLmVuZCgpXG4gICAgfSwgMTAwMCAvIDYwKVxuICB9XG5cbiAgdmFyIGJvb3QgPSB7fVxuXG4gIGJvb3QuY3JlYXRlID0gZnVuY3Rpb24gKCkge1xuXG4gICAgaWYgKHByb3BlcnRpZXMuc2hvd1N0YXRzKSBhZGRTdGF0cygpXG5cbiAgICBnYW1lLnNjYWxlLnBhZ2VBbGlnbkhvcml6b250YWxseSA9IHRydWVcbiAgICBnYW1lLnNjYWxlLnBhZ2VBbGlnblZlcnRpY2FsbHkgPSB0cnVlXG4gICAgZ2FtZS5zY2FsZS5yZWZyZXNoKClcblxuICAgIGdhbWUuc3RhdGUuc3RhcnQoJ3ByZWxvYWRlcicpXG4gIH1cblxuICByZXR1cm4gYm9vdFxufVxuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihnYW1lKSB7XG5cbiAgdmFyIGdhbWVTdGF0ZSA9IHt9XG5cbiAgZ2FtZVN0YXRlLmNyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgIHZhciBsb2dvID0gZ2FtZS5hZGQuc3ByaXRlKGdhbWUud29ybGQuY2VudGVyWCwgMjAwLCAnbG9nbycpXG4gICAgbG9nby5hbmNob3Iuc2V0VG8oMC41LCAwLjUpXG5cbiAgICB2YXIgc3R5bGUgPSB7IGZvbnQ6ICc0MHB4IEFyaWFsJywgZmlsbDogJyNmZmZmZmYnLCBhbGlnbjogJ2NlbnRlcid9XG5cbiAgICB2YXIgc2luZ2xlUGxheWVyQnV0dG9uID0gZ2FtZS5hZGQudGV4dChnYW1lLndvcmxkLmNlbnRlclgsIDQ1MCwgJ3NpbmdsZSBwbGF5ZXInLCBzdHlsZSlcbiAgICBzaW5nbGVQbGF5ZXJCdXR0b24uYW5jaG9yLnNldFRvKDAuNSwgMC41KVxuICAgIHNpbmdsZVBsYXllckJ1dHRvbi5pbnB1dEVuYWJsZWQgPSB0cnVlXG4gICAgc2luZ2xlUGxheWVyQnV0dG9uLmV2ZW50cy5vbklucHV0RG93bi5hZGQoZnVuY3Rpb24oKSB7XG5cdFx0XHRnYW1lLnN0YXRlLnN0YXJ0KCdzaW5nbGVwbGF5ZXJtZW51JylcbiAgICB9KVxuXG4gICAgdmFyIG11bHRpUGxheWVyQnV0dG9uID0gZ2FtZS5hZGQudGV4dChnYW1lLndvcmxkLmNlbnRlclgsIDUwMCwgJ211bHRpIHBsYXllcicsIHN0eWxlKVxuICAgIG11bHRpUGxheWVyQnV0dG9uLmFuY2hvci5zZXRUbygwLjUsIDAuNSlcbiAgICBtdWx0aVBsYXllckJ1dHRvbi5pbnB1dEVuYWJsZWQgPSB0cnVlXG4gICAgbXVsdGlQbGF5ZXJCdXR0b24uZXZlbnRzLm9uSW5wdXREb3duLmFkZChmdW5jdGlvbigpIHtcblx0XHRcdGdhbWUuc3RhdGUuc3RhcnQoJ211bHRpcGxheWVybWVudScpXG4gICAgfSlcblxuICAgIHZhciBzZXR0aW5nc0J1dHRvbiA9IGdhbWUuYWRkLnRleHQoZ2FtZS53b3JsZC5jZW50ZXJYLCA1NTAsICdzZXR0aW5ncycsIHN0eWxlKVxuICAgIHNldHRpbmdzQnV0dG9uLmFuY2hvci5zZXRUbygwLjUsIDAuNSlcbiAgICBzZXR0aW5nc0J1dHRvbi5pbnB1dEVuYWJsZWQgPSB0cnVlXG4gICAgc2V0dGluZ3NCdXR0b24uZXZlbnRzLm9uSW5wdXREb3duLmFkZChmdW5jdGlvbigpIHtcbiAgICBcdGdhbWUuc3RhdGUuc3RhcnQoJ3NldHRpbmdzbWVudScpXG4gICAgfSlcblxuICB9XG5cbiAgZ2FtZVN0YXRlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICBcdFxuICB9XG5cbiAgcmV0dXJuIGdhbWVTdGF0ZVxufVxuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihnYW1lKSB7XG5cbiAgdmFyIGdhbWVTdGF0ZSA9IHt9XG5cbiAgZ2FtZVN0YXRlLmNyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcblxuICBcdHZhciBzdHlsZSA9IHsgZm9udDogJzQwcHggQXJpYWwnLCBmaWxsOiAnI2ZmZmZmZicsIGFsaWduOiAnY2VudGVyJ31cbiAgXHR2YXIgbWFpbk1lbnVCdXR0b24gPSBnYW1lLmFkZC50ZXh0KDEwMCwgNTAsICdiYWNrJywgc3R5bGUpXG4gICAgbWFpbk1lbnVCdXR0b24uYW5jaG9yLnNldFRvKDAuNSwgMC41KVxuICAgIG1haW5NZW51QnV0dG9uLmlucHV0RW5hYmxlZCA9IHRydWVcbiAgICBtYWluTWVudUJ1dHRvbi5ldmVudHMub25JbnB1dERvd24uYWRkKGZ1bmN0aW9uKCkge1xuXHRcdFx0Z2FtZS5zdGF0ZS5zdGFydCgnbWFpbm1lbnUnKVxuICAgIH0pXG5cbiAgICB2YXIgdHJhaW4gPSBnYW1lLmFkZC50ZXh0KGdhbWUud29ybGQuY2VudGVyWCwgMzAwLCAncXVpY2ttYXRjaCcsIHN0eWxlKVxuICAgIHRyYWluLmFuY2hvci5zZXRUbygwLjUsIDAuNSlcbiAgICB0cmFpbi5pbnB1dEVuYWJsZWQgPSB0cnVlXG4gICAgdHJhaW4uZXZlbnRzLm9uSW5wdXREb3duLmFkZChmdW5jdGlvbigpIHtcbiAgICAgIGdhbWUuc3RhdGUuc3RhcnQoJ3F1aWNrbWF0Y2gnKVxuICAgIH0pXG5cbiAgfVxuXG4gIHJldHVybiBnYW1lU3RhdGVcbn0iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGdhbWUpIHtcblxuICB2YXIgcHJlbG9hZGVyID0ge31cblxuICBwcmVsb2FkZXIucHJlbG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBnYW1lLmxvYWQuaW1hZ2UoJ2xvZ28nLCAnaW1hZ2VzL3BoYXNlci5wbmcjZ3J1bnQtY2FjaGUtYnVzdCcpXG4gICAgZ2FtZS5sb2FkLmltYWdlKCdyZWRzcXVhcmUnLCAnaW1hZ2VzL3JlZHNxdWFyZS5wbmcjZ3J1bnQtY2FjaGUtYnVzdCcpXG4gICAgZ2FtZS5sb2FkLmltYWdlKCdibHVlc3F1YXJlJywgJ2ltYWdlcy9ibHVlc3F1YXJlLmpwZyNncnVudC1jYWNoZS1idXN0JylcbiAgICBnYW1lLmxvYWQuaW1hZ2UoJ3doaXRlc3F1YXJlJywgJ2ltYWdlcy93aGl0ZXNxdWFyZS5wbmcjZ3J1bnQtY2FjaGUtYnVzdCcpXG4gIH1cblxuICBwcmVsb2FkZXIuY3JlYXRlID0gZnVuY3Rpb24gKCkge1xuICAgIGdhbWUuc3RhdGUuc3RhcnQoJ21haW5tZW51JylcbiAgfVxuXG4gIHJldHVybiBwcmVsb2FkZXJcbn1cbiIsInZhciBQbGF5ZXIgPSByZXF1aXJlKCcuLi9QbGF5ZXIuanMnKVxuXG52YXIgc29ja2V0XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZ2FtZSkge1xuXG4gIHZhciBnYW1lU3RhdGUgPSB7fVxuXG4gIHZhciBwMSwgcDIsIGlzUDEsIGlzUDJcblxuICB2YXIgaXNQbGF5aW5nID0gZmFsc2VcblxuICB2YXIgaWRcblxuICBnYW1lU3RhdGUuY3JlYXRlID0gZnVuY3Rpb24gKCkge1xuXG4gICAgc29ja2V0ID0gd2luZG93LnNvY2tldCA9IGlvKCdodHRwOi8vbG9jYWxob3N0OjkwMDAnKVxuXG4gIFx0dmFyIHN0eWxlID0geyBmb250OiAnNDBweCBBcmlhbCcsIGZpbGw6ICcjZmZmZmZmJywgYWxpZ246ICdjZW50ZXInfVxuICBcdHZhciBtYWluTWVudUJ1dHRvbiA9IGdhbWUuYWRkLnRleHQoMTAwLCA1MCwgJ2JhY2snLCBzdHlsZSlcbiAgICBtYWluTWVudUJ1dHRvbi5hbmNob3Iuc2V0VG8oMC41LCAwLjUpXG4gICAgbWFpbk1lbnVCdXR0b24uaW5wdXRFbmFibGVkID0gdHJ1ZVxuICAgIG1haW5NZW51QnV0dG9uLmV2ZW50cy5vbklucHV0RG93bi5hZGQoZnVuY3Rpb24oKSB7XG4gICAgICBzb2NrZXQuZW1pdCgnbGVhdmUtbG9iYnknKVxuXHRcdFx0Z2FtZS5zdGF0ZS5zdGFydCgnbXVsdGlwbGF5ZXJtZW51JylcblxuICAgICAgaWYocDEmJnAyKSB7XG4gICAgICAgIHAxLnJhZ2RvbGwuZGVzdHJveSgpXG4gICAgICAgIHAyLnJhZ2RvbGwuZGVzdHJveSgpXG4gICAgICAgIHAxID0gbnVsbFxuICAgICAgICBwMiA9IG51bGxcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgc29ja2V0LmVtaXQoJ2pvaW4tbG9iYnknKVxuICAgIHNvY2tldC5vbignaWQnLCBmdW5jdGlvbihzb2NrZXRJZCkge1xuICAgICAgY29uc29sZS5sb2coJ2lkJywgc29ja2V0SWQpXG4gICAgICBpZCA9IGlkXG4gICAgfSlcblxuICAgIGdhbWUucGh5c2ljcy5zdGFydFN5c3RlbShQaGFzZXIuUGh5c2ljcy5QMkpTKVxuICAgIGdhbWUucGh5c2ljcy5wMi5ncmF2aXR5LnkgPSAyMDBcblxuICAgIHNvY2tldC5vbigncGxheWVycy1saXN0JywgZnVuY3Rpb24gKHBsYXllckxpc3QpIHtcbiAgICAgIGNvbnNvbGUubG9nKHBsYXllckxpc3QpXG4gICAgICBwbGF5ZXJMaXN0LmZvckVhY2goZnVuY3Rpb24ocGxheWVyLCBpKSB7XG4gICAgICAgIGdhbWUuYWRkLnRleHQoNTUwLCAyMCooaSsxKSwgcGxheWVyLCB7ZmlsbDogJyNmZmZmZmYnLCBmb250OiAnMTZweCBBcmlhbCd9KVxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgc29ja2V0Lm9uKCduZXctZ2FtZScsIGZ1bmN0aW9uIChwbGF5ZXJzKSB7XG5cbiAgICAgIGlzUDEgPSBmYWxzZVxuICAgICAgaXNQMiA9IGZhbHNlXG5cbiAgICAgIGlmKHAxIHx8IHAyKSB7XG4gICAgICAgIHAxLnJhZ2RvbGwuZGVzdHJveSgpXG4gICAgICAgIHAxID0gbnVsbFxuICAgICAgICBwMi5yYWdkb2xsLmRlc3Ryb3koKVxuICAgICAgICBwMiA9IG51bGxcbiAgICAgIH1cblxuICAgICAgaWYoaWQgPT09IHBsYXllcnMucDEgfHwgaWQgPT09IHBsYXllcnMucDIpIHtcblxuICAgICAgICBpZihwbGF5ZXJzLnAxID09PSBpZCkge1xuICAgICAgICAgIGlzUDEgPSB0cnVlXG4gICAgICAgICAgcDEgPSBuZXcgUGxheWVyKCdtZScsIGdhbWUsIDIwMCwgMjAwKVxuICAgICAgICAgIHAxLm1ldGhvZDAoKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHAxID0gbmV3IFBsYXllcignbmV0d29yaycsIGdhbWUsIDIwMCwgMjAwKVxuICAgICAgICB9XG5cbiAgICAgICAgaWYocGxheWVycy5wMiA9PT0gaWQpIHtcbiAgICAgICAgICBpc1AyID0gdHJ1ZVxuICAgICAgICAgIHAyID0gbmV3IFBsYXllcignbWUnLCBnYW1lLCA2MDAsIDIwMClcbiAgICAgICAgICBwMi5tZXRob2QwKClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwMiA9IG5ldyBQbGF5ZXIoJ25ldHdvcmsnLCBnYW1lLCA2MDAsIDIwMClcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZyhwbGF5ZXJzKVxuICAgICAgdmFyIHAxaWQgPSBwbGF5ZXJzLnAxXG4gICAgICB2YXIgcDJpZCA9IHBsYXllcnMucDJcblxuICAgICAgc29ja2V0Lm9uKCd0dXJuJywgZnVuY3Rpb24gKHR1cm4pIHtcbiAgICAgICAgcDIudHVybkhpc3RvcnkucHVzaCh0dXJuKVxuICAgICAgICBjb25zb2xlLmxvZyh0dXJuKVxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgZ2FtZS5waHlzaWNzLnN0YXJ0U3lzdGVtKFBoYXNlci5QaHlzaWNzLlAySlMpXG4gICAgZ2FtZS5waHlzaWNzLnAyLmdyYXZpdHkueSA9IDIwMFxuICAgIFxuICAgIC8vIGRlYnVnXG4gICAgd2luZG93LmdhbWUgPSBnYW1lXG4gICAgd2luZG93LnAxID0gcDFcbiAgICB3aW5kb3cucDIgPSBwMlxuXG4gIH1cblxuICB2YXIgZnJhbWVDb3VudCA9IDBcbiAgdmFyIG5ld1R1cm4gPSBmYWxzZVxuXG4gIGdhbWVTdGF0ZS51cGRhdGUgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICBpZihwMSAmJiBwMikge1xuXG4gICAgICBmcmFtZUNvdW50KytcblxuICAgICAgaWYocDEucmVzZXRQbGF5YmFjaygpIHx8IHAyLnJlc2V0UGxheWJhY2soKSkge1xuICAgICAgICBwMS5tZXRob2QyKClcbiAgICAgICAgcDIubWV0aG9kMigpXG4gICAgICAgIGZyYW1lQ291bnQgPSAwXG4gICAgICB9XG5cbiAgICAgIGlmKGZyYW1lQ291bnQgPT09IDEwMCkge1xuICAgICAgICBmcmFtZUNvdW50ID0gMFxuXG4gICAgICAgIGlmKHAxLnJlYWR5KCkgJiYgcDIucmVhZHkoKSkge1xuICAgICAgICAgIHAxLm1ldGhvZDEoKVxuICAgICAgICAgIHAyLm1ldGhvZDEoKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHAxLm1ldGhvZDIoKVxuICAgICAgICAgIHAyLm1ldGhvZDIoKVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmKGdhbWUuaW5wdXQua2V5Ym9hcmQuaXNEb3duKFBoYXNlci5LZXlib2FyZC5TUEFDRUJBUikpIHtcbiAgICAgICAgcDEuaXNSZWFkeSA9IHRydWVcbiAgICAgICAgcDIuaXNSZWFkeSA9IHRydWVcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gZ2FtZVN0YXRlXG59IiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihnYW1lKSB7XG5cbiAgdmFyIGdhbWVTdGF0ZSA9IHt9XG5cbiAgZ2FtZVN0YXRlLmNyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgXHRcbiAgXHR2YXIgc3R5bGUgPSB7IGZvbnQ6ICc0MHB4IEFyaWFsJywgZmlsbDogJyNmZmZmZmYnLCBhbGlnbjogJ2NlbnRlcid9XG4gIFx0dmFyIG1haW5NZW51QnV0dG9uID0gZ2FtZS5hZGQudGV4dCgxMDAsIDUwLCAnYmFjaycsIHN0eWxlKVxuICAgIG1haW5NZW51QnV0dG9uLmFuY2hvci5zZXRUbygwLjUsIDAuNSlcbiAgICBtYWluTWVudUJ1dHRvbi5pbnB1dEVuYWJsZWQgPSB0cnVlXG4gICAgbWFpbk1lbnVCdXR0b24uZXZlbnRzLm9uSW5wdXREb3duLmFkZChmdW5jdGlvbigpIHtcblx0XHRcdGdhbWUuc3RhdGUuc3RhcnQoJ21haW5tZW51JylcbiAgICB9KVxuICB9XG5cbiAgcmV0dXJuIGdhbWVTdGF0ZVxufSIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZ2FtZSkge1xuXG4gIHZhciBnYW1lU3RhdGUgPSB7fVxuXG4gIGdhbWVTdGF0ZS5jcmVhdGUgPSBmdW5jdGlvbiAoKSB7XG5cbiAgXHR2YXIgc3R5bGUgPSB7IGZvbnQ6ICc0MHB4IEFyaWFsJywgZmlsbDogJyNmZmZmZmYnLCBhbGlnbjogJ2NlbnRlcid9XG4gIFx0dmFyIG1haW5NZW51QnV0dG9uID0gZ2FtZS5hZGQudGV4dCgxMDAsIDUwLCAnYmFjaycsIHN0eWxlKVxuICAgIG1haW5NZW51QnV0dG9uLmFuY2hvci5zZXRUbygwLjUsIDAuNSlcbiAgICBtYWluTWVudUJ1dHRvbi5pbnB1dEVuYWJsZWQgPSB0cnVlXG4gICAgbWFpbk1lbnVCdXR0b24uZXZlbnRzLm9uSW5wdXREb3duLmFkZChmdW5jdGlvbigpIHtcblx0XHRcdGdhbWUuc3RhdGUuc3RhcnQoJ21haW5tZW51JylcbiAgICB9KVxuXG4gIFx0dmFyIHRyYWluID0gZ2FtZS5hZGQudGV4dChnYW1lLndvcmxkLmNlbnRlclgsIDMwMCwgJ3RyYWluJywgc3R5bGUpXG4gICAgdHJhaW4uYW5jaG9yLnNldFRvKDAuNSwgMC41KVxuICAgIHRyYWluLmlucHV0RW5hYmxlZCA9IHRydWVcbiAgICB0cmFpbi5ldmVudHMub25JbnB1dERvd24uYWRkKGZ1bmN0aW9uKCkge1xuXHRcdFx0Z2FtZS5zdGF0ZS5zdGFydCgndHJhaW4nKVxuICAgIH0pXG4gIH1cblxuICByZXR1cm4gZ2FtZVN0YXRlXG59XG4iLCJ2YXIgUGxheWVyID0gcmVxdWlyZSgnLi4vUGxheWVyLmpzJylcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihnYW1lKSB7XG5cbiAgdmFyIGdhbWVTdGF0ZSA9IHt9XG5cbiAgdmFyIHAxLCBwMlxuXG4gIGdhbWVTdGF0ZS5jcmVhdGUgPSBmdW5jdGlvbiAoKSB7XG5cbiAgXHR2YXIgc3R5bGUgPSB7IGZvbnQ6ICc0MHB4IEFyaWFsJywgZmlsbDogJyNmZmZmZmYnLCBhbGlnbjogJ2NlbnRlcid9XG4gIFx0dmFyIG1haW5NZW51QnV0dG9uID0gZ2FtZS5hZGQudGV4dCgxMDAsIDUwLCAnYmFjaycsIHN0eWxlKVxuICAgIG1haW5NZW51QnV0dG9uLmFuY2hvci5zZXRUbygwLjUsIDAuNSlcbiAgICBtYWluTWVudUJ1dHRvbi5pbnB1dEVuYWJsZWQgPSB0cnVlXG4gICAgbWFpbk1lbnVCdXR0b24uZXZlbnRzLm9uSW5wdXREb3duLmFkZChmdW5jdGlvbigpIHtcblx0XHRcdGdhbWUuc3RhdGUuc3RhcnQoJ3NpbmdsZXBsYXllcm1lbnUnKVxuICAgICAgcDEucmFnZG9sbC5kZXN0cm95KClcbiAgICAgIHAyLnJhZ2RvbGwuZGVzdHJveSgpXG4gICAgfSlcblxuICAgIGdhbWUucGh5c2ljcy5zdGFydFN5c3RlbShQaGFzZXIuUGh5c2ljcy5QMkpTKVxuICAgIGdhbWUucGh5c2ljcy5wMi5ncmF2aXR5LnkgPSAyMDBcblxuICAgIHAxID0gbmV3IFBsYXllcignbWUnLCBnYW1lLCAyMDAsIDIwMClcbiAgICBwMS5tZXRob2QwKClcblxuICAgIHAyID0gbmV3IFBsYXllcignZHVtbXknLCBnYW1lLCA2MDAsIDIwMClcbiAgICBwMi5tZXRob2QwKClcbiAgICBcbiAgICAvLyBkZWJ1Z1xuICAgIHdpbmRvdy5nYW1lID0gZ2FtZVxuICAgIHdpbmRvdy5wMSA9IHAxXG4gICAgd2luZG93LnAyID0gcDJcbiAgfVxuXG4gIHZhciBmcmFtZUNvdW50ID0gMFxuICB2YXIgbmV3VHVybiA9IGZhbHNlXG5cbiAgZ2FtZVN0YXRlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgIGZyYW1lQ291bnQrK1xuXG4gICAgaWYocDEucmVzZXRQbGF5YmFjaygpIHx8IHAyLnJlc2V0UGxheWJhY2soKSkge1xuICAgICAgcDEubWV0aG9kMigpXG4gICAgICBwMi5tZXRob2QyKClcbiAgICAgIGZyYW1lQ291bnQgPSAwXG4gICAgfVxuXG4gICAgaWYoZnJhbWVDb3VudCA9PT0gMTAwKSB7XG4gICAgICBmcmFtZUNvdW50ID0gMFxuXG4gICAgICBpZihwMS5yZWFkeSgpICYmIHAyLnJlYWR5KCkpIHtcbiAgICAgICAgcDEubWV0aG9kMSgpXG4gICAgICAgIHAyLm1ldGhvZDEoKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcDEubWV0aG9kMigpXG4gICAgICAgIHAyLm1ldGhvZDIoKVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmKGdhbWUuaW5wdXQua2V5Ym9hcmQuaXNEb3duKFBoYXNlci5LZXlib2FyZC5TUEFDRUJBUikpIHtcbiAgICAgIHAxLmlzUmVhZHkgPSB0cnVlXG4gICAgICBwMi5pc1JlYWR5ID0gdHJ1ZVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBnYW1lU3RhdGVcbn0iLCIoZnVuY3Rpb24gKGdsb2JhbCl7XG47X19icm93c2VyaWZ5X3NoaW1fcmVxdWlyZV9fPXJlcXVpcmU7KGZ1bmN0aW9uIGJyb3dzZXJpZnlTaGltKG1vZHVsZSwgZXhwb3J0cywgcmVxdWlyZSwgZGVmaW5lLCBicm93c2VyaWZ5X3NoaW1fX2RlZmluZV9fbW9kdWxlX19leHBvcnRfXykge1xuLy8gc3RhdHMuanMgLSBodHRwOi8vZ2l0aHViLmNvbS9tcmRvb2Ivc3RhdHMuanNcbnZhciBTdGF0cz1mdW5jdGlvbigpe3ZhciBsPURhdGUubm93KCksbT1sLGc9MCxuPUluZmluaXR5LG89MCxoPTAscD1JbmZpbml0eSxxPTAscj0wLHM9MCxmPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7Zi5pZD1cInN0YXRzXCI7Zi5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsZnVuY3Rpb24oYil7Yi5wcmV2ZW50RGVmYXVsdCgpO3QoKytzJTIpfSwhMSk7Zi5zdHlsZS5jc3NUZXh0PVwid2lkdGg6ODBweDtvcGFjaXR5OjAuOTtjdXJzb3I6cG9pbnRlclwiO3ZhciBhPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7YS5pZD1cImZwc1wiO2Euc3R5bGUuY3NzVGV4dD1cInBhZGRpbmc6MCAwIDNweCAzcHg7dGV4dC1hbGlnbjpsZWZ0O2JhY2tncm91bmQtY29sb3I6IzAwMlwiO2YuYXBwZW5kQ2hpbGQoYSk7dmFyIGk9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtpLmlkPVwiZnBzVGV4dFwiO2kuc3R5bGUuY3NzVGV4dD1cImNvbG9yOiMwZmY7Zm9udC1mYW1pbHk6SGVsdmV0aWNhLEFyaWFsLHNhbnMtc2VyaWY7Zm9udC1zaXplOjlweDtmb250LXdlaWdodDpib2xkO2xpbmUtaGVpZ2h0OjE1cHhcIjtcbmkuaW5uZXJIVE1MPVwiRlBTXCI7YS5hcHBlbmRDaGlsZChpKTt2YXIgYz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO2MuaWQ9XCJmcHNHcmFwaFwiO2Muc3R5bGUuY3NzVGV4dD1cInBvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOjc0cHg7aGVpZ2h0OjMwcHg7YmFja2dyb3VuZC1jb2xvcjojMGZmXCI7Zm9yKGEuYXBwZW5kQ2hpbGQoYyk7NzQ+Yy5jaGlsZHJlbi5sZW5ndGg7KXt2YXIgaj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtqLnN0eWxlLmNzc1RleHQ9XCJ3aWR0aDoxcHg7aGVpZ2h0OjMwcHg7ZmxvYXQ6bGVmdDtiYWNrZ3JvdW5kLWNvbG9yOiMxMTNcIjtjLmFwcGVuZENoaWxkKGopfXZhciBkPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7ZC5pZD1cIm1zXCI7ZC5zdHlsZS5jc3NUZXh0PVwicGFkZGluZzowIDAgM3B4IDNweDt0ZXh0LWFsaWduOmxlZnQ7YmFja2dyb3VuZC1jb2xvcjojMDIwO2Rpc3BsYXk6bm9uZVwiO2YuYXBwZW5kQ2hpbGQoZCk7dmFyIGs9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbmsuaWQ9XCJtc1RleHRcIjtrLnN0eWxlLmNzc1RleHQ9XCJjb2xvcjojMGYwO2ZvbnQtZmFtaWx5OkhlbHZldGljYSxBcmlhbCxzYW5zLXNlcmlmO2ZvbnQtc2l6ZTo5cHg7Zm9udC13ZWlnaHQ6Ym9sZDtsaW5lLWhlaWdodDoxNXB4XCI7ay5pbm5lckhUTUw9XCJNU1wiO2QuYXBwZW5kQ2hpbGQoayk7dmFyIGU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtlLmlkPVwibXNHcmFwaFwiO2Uuc3R5bGUuY3NzVGV4dD1cInBvc2l0aW9uOnJlbGF0aXZlO3dpZHRoOjc0cHg7aGVpZ2h0OjMwcHg7YmFja2dyb3VuZC1jb2xvcjojMGYwXCI7Zm9yKGQuYXBwZW5kQ2hpbGQoZSk7NzQ+ZS5jaGlsZHJlbi5sZW5ndGg7KWo9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIiksai5zdHlsZS5jc3NUZXh0PVwid2lkdGg6MXB4O2hlaWdodDozMHB4O2Zsb2F0OmxlZnQ7YmFja2dyb3VuZC1jb2xvcjojMTMxXCIsZS5hcHBlbmRDaGlsZChqKTt2YXIgdD1mdW5jdGlvbihiKXtzPWI7c3dpdGNoKHMpe2Nhc2UgMDphLnN0eWxlLmRpc3BsYXk9XG5cImJsb2NrXCI7ZC5zdHlsZS5kaXNwbGF5PVwibm9uZVwiO2JyZWFrO2Nhc2UgMTphLnN0eWxlLmRpc3BsYXk9XCJub25lXCIsZC5zdHlsZS5kaXNwbGF5PVwiYmxvY2tcIn19O3JldHVybntSRVZJU0lPTjoxMSxkb21FbGVtZW50OmYsc2V0TW9kZTp0LGJlZ2luOmZ1bmN0aW9uKCl7bD1EYXRlLm5vdygpfSxlbmQ6ZnVuY3Rpb24oKXt2YXIgYj1EYXRlLm5vdygpO2c9Yi1sO249TWF0aC5taW4obixnKTtvPU1hdGgubWF4KG8sZyk7ay50ZXh0Q29udGVudD1nK1wiIE1TIChcIituK1wiLVwiK28rXCIpXCI7dmFyIGE9TWF0aC5taW4oMzAsMzAtMzAqKGcvMjAwKSk7ZS5hcHBlbmRDaGlsZChlLmZpcnN0Q2hpbGQpLnN0eWxlLmhlaWdodD1hK1wicHhcIjtyKys7Yj5tKzFFMyYmKGg9TWF0aC5yb3VuZCgxRTMqci8oYi1tKSkscD1NYXRoLm1pbihwLGgpLHE9TWF0aC5tYXgocSxoKSxpLnRleHRDb250ZW50PWgrXCIgRlBTIChcIitwK1wiLVwiK3ErXCIpXCIsYT1NYXRoLm1pbigzMCwzMC0zMCooaC8xMDApKSxjLmFwcGVuZENoaWxkKGMuZmlyc3RDaGlsZCkuc3R5bGUuaGVpZ2h0PVxuYStcInB4XCIsbT1iLHI9MCk7cmV0dXJuIGJ9LHVwZGF0ZTpmdW5jdGlvbigpe2w9dGhpcy5lbmQoKX19fTtcbjsgYnJvd3NlcmlmeV9zaGltX19kZWZpbmVfX21vZHVsZV9fZXhwb3J0X18odHlwZW9mIFN0YXRzICE9IFwidW5kZWZpbmVkXCIgPyBTdGF0cyA6IHdpbmRvdy5TdGF0cyk7XG5cbn0pLmNhbGwoZ2xvYmFsLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGZ1bmN0aW9uIGRlZmluZUV4cG9ydChleCkgeyBtb2R1bGUuZXhwb3J0cyA9IGV4OyB9KTtcblxufSkuY2FsbCh0aGlzLHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSkiXX0=
